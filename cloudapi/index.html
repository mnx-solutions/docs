



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.0">
    
    
      
        <title>Joyent CloudAPI</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.0284f74d.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.01803549.css">
      
      
        
        
        <meta name="theme-color" content="#3f51b5">
      
    
    
      <script src="../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#joyent-cloudapi" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="MNX.io Docs" class="md-header-nav__button md-logo">
          
            <img src="../images/logo.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              MNX.io Docs
            </span>
            <span class="md-header-nav__topic">
              
                Joyent CloudAPI
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="MNX.io Docs" class="md-nav__button md-logo">
      
        <img src="../images/logo.png" width="48" height="48">
      
    </a>
    MNX.io Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="/cloudapi/index.md" title="CloudAPI" class="md-nav__link">
      CloudAPI
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="https://mnx.io/security" title="Security" class="md-nav__link">
      Security
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#conventions" title="Conventions" class="md-nav__link">
    Conventions
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <!--
    This Source Code Form is subject to the terms of the Mozilla Public
    License, v. 2.0. If a copy of the MPL was not distributed with this
    file, You can obtain one at http://mozilla.org/MPL/2.0/.
-->

<!--
    Copyright 2019 Joyent, Inc.
-->

<h1 id="joyent-cloudapi">Joyent CloudAPI</h1>
<p>CloudAPI is one of the public APIs for a Triton cloud: it allows end users of
the cloud to manage their accounts, instances, networks, images, and to
inquire about other relevant details.  CloudAPI provides a single view of
docker containers, infrastructure containers and hardware virtual machines
owned by the user.</p>
<p>This is the reference documentation for the CloudAPI that is part of Joyent's
Triton stack.  This guide provides descriptions of the APIs available, as well
as supporting information -- such as how to use the software developer kits
(SDK), command line interface (CLI), and where to find more information.</p>
<p>Triton also provides a Docker API, which Docker clients can use, but this
documentation does not cover. For more information about Triton visit
<a href="https://www.joyent.com/private-cloud">Joyent Triton</a>.</p>
<h2 id="conventions">Conventions</h2>
<p>Any content formatted as follows is a command-line example that you can run from
a shell:</p>
<pre><code>$ sdc-listmachines
</code></pre>
<p>All other examples and information are formatted like so:</p>
<pre><code>GET /my/machines HTTP/1.1
</code></pre>
<h1 id="introduction-to-cloudapi">Introduction to CloudAPI</h1>
<h2 id="what-is-cloudapi">What is CloudAPI?</h2>
<p>CloudAPI is one of the two public APIs you can use to interact with Triton.
Using CloudAPI, you can:</p>
<ul>
<li>Create and manage containers and hardware virtual machines (collectively known as instances)</li>
<li>Manage your account credentials</li>
<li>Create and modify virtual private networks for your instances</li>
<li>Manage snapshots of instances</li>
<li>Manage sub-users and their permissions using RBAC</li>
<li>And more! Oh yes!</li>
</ul>
<p>While CloudAPI provides visibility into Docker containers, the regular
<a href="https://docs.docker.com/installation/#installation">Docker CLI</a> should be used
for provisioning and managing Docker containers; Triton provides an endpoint
that represents the entire datacenter as a single <code>DOCKER_HOST</code>, which Docker
clients can communicate with.  Refer to Joyent's
<a href="https://apidocs.joyent.com/docker">Docker documentation</a> for more information.</p>
<h2 id="how-do-i-access-cloudapi">How do I access CloudAPI?</h2>
<p>CloudAPI is available as a REST API, and you can access it using:</p>
<ul>
<li>Triton Customer Portal</li>
<li><a href="https://github.com/joyent/node-triton">node-triton CLI</a></li>
<li><a href="https://github.com/joyent/node-smartdc">node-smartdc CLI</a></li>
<li><a href="https://github.com/joyent/node-smartdc">node.js SDK</a></li>
<li>REST API</li>
</ul>
<p>If you don't want to write any code, use one of the two CLIs. The CLIs let you
use command-line tools to perform every action available in the SDK and REST
API.</p>
<p>There are two CLIs available for calling CloudAPI: node-triton and node-smartdc.
node-triton is newer and easier to use, while node-smartdc is more stable and
complete, but both CLIs are supported. These docs will provide examples for
both, although node-triton will be omitted where it does not yet support that
functionality.</p>
<h1 id="getting-started">Getting Started</h1>
<p>If you choose to use node-triton or node-smartdc, be aware that they both
require Node.js.</p>
<p>You can get Node.js from <a href="http://nodejs.org">nodejs.org</a> as source code, and as
precompiled packages for Windows, Macintosh, Linux and Illumos distributions.
Alternatively, when using a *nix, you can usually install Node.js using a
package manager as well (e.g. pkgsrc, brew, apt-get, yum).  The version of
Node.js should be at least v0.10, so npm (Node.js's package manager) should come
with it as well.</p>
<p>Once you've installed Node.js, to install node-triton invoke:</p>
<pre><code>$ npm install -g triton
</code></pre>
<p>or, to install node-smartdc:</p>
<pre><code>$ npm install -g smartdc
</code></pre>
<p>You will probably want to install <a href="https://www.npmjs.org/package/json">json</a> as
well. It is a tool that makes it easier to work with JSON-formatted output.  You
can install it like this:</p>
<pre><code>$ npm install -g json
</code></pre>
<p>In all cases above, the <code>-g</code> switch installs the tools globally, usually in
<code>/usr/local/bin</code>, so that you can use them easily from the command line.  Omit
this switch if you'd rather the tools be installed in your home hierarchy, but
you'll need to set your PATH appropriately.</p>
<h2 id="generate-an-ssh-key">Generate an SSH key</h2>
<p>Both CLIs require an SSH key to communicate with CloudAPI, as well as logging-in
to many instances.</p>
<p>If you haven't already generated an SSH key (required to use both SSH and HTTP
Signing), run the following command:</p>
<pre><code>$ ssh-keygen -b 2048 -t rsa -m PEM
</code></pre>
<p>This will prompt you with a place to save the key.  You should probably just
accept the defaults, as many programs (SSH and CloudAPI CLIs) will first look
for a file called ~/.ssh/id_rsa. Before running the above command, ensure that
~/.ssh/id_rsa does not already exist; overwriting it may have unintended
consequences.</p>
<h2 id="set-up-your-cli">Set Up your CLI</h2>
<p>You need to set the following environment variables information in order to
interact with CloudAPI using either node-triton or node-smartdc:</p>
<ul>
<li><code>SDC_URL</code>: The URL of the CloudAPI endpoint.</li>
<li><code>SDC_KEY_ID</code>: Fingerprint for the key you uploaded to Triton.</li>
<li><code>SDC_ACCOUNT</code>: Your username; the login you use for Triton.</li>
<li><code>SDC_USER</code>: If authenticating as a subuser, the username of the subuser.
  See <a href="#rbac-users-roles-policies">Role Based Access Control</a>.</li>
<li><code>SDC_TESTING</code>: If using a self-signed SSL certificate, set this to 1.</li>
</ul>
<p>An example for <code>SDC_URL</code> is <code>https://us-west-1.api.joyent.com</code>.  Each
datacenter in a cloud has its own CloudAPI endpoint; a different cloud that uses
Triton would have a different URL.</p>
<p>In this document, we'll use <code>api.example.com</code> as the <code>SDC_URL</code> endpoint; please
replace it with the URL of your datacenter(s).  Note that CloudAPI always uses
SSL/TLS, which means that the endpoint URL must begin with <code>https</code>.</p>
<p>You can quickly get your key fingerprint for <code>SDC_KEY_ID</code> by running:</p>
<pre><code>$ ssh-keygen -l -f ~/.ssh/id_rsa.pub | awk '{print $2}' | tr -d '\n'
</code></pre>
<p>where you replace <code>~/.ssh/id_rsa.pub</code> with the path to the public key you want
to use for signing requests.</p>
<h2 id="working-with-the-cli">Working with the CLI</h2>
<p>For a complete list of CloudAPI CLI commands available, please see
<a href="#appendix-c-cloudapi-cli-commands">Appendix C: CloudAPI CLI Commands</a>.</p>
<p>To get help on a command, use the <code>--help</code> flag.  For example:</p>
<pre><code>$ triton datacenters --help
Show datacenters in this cloud.
A "cloud" is a set of related datacenters that share account
information.

Usage:
     triton datacenters

Options:
    -h, --help                Show this help.

  Output options:
    -H                        Omit table header row.
    -o field1,...             Specify fields (columns) to output.
    -s field1,...             Sort on the given fields. Default is "name".
    -j, --json                JSON output.
</code></pre>
<p>or</p>
<pre><code>$ sdc-listdatacenters --help
sdc-listdatacenters [--account string] [--api-version string] [--debug boolean] [--help boolean] [--keyId string] [--url url] [--version boolean] [--verbose boolean] [--user string] [--role string]
</code></pre>
<p>You can set environment variables for the following flags so that you don't have
to type them for each request (e.g. in your .bash_profile).  All the examples in
this document assume that these variables have been set:</p>
<table>
<thead>
<tr>
<th><strong>CLI Flags</strong></th>
<th><strong>Description</strong></th>
<th><strong>Environment Variable</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>--account<br/>-a</td>
<td>Login name (account)</td>
<td>SDC_ACCOUNT</td>
</tr>
<tr>
<td>--user</td>
<td>Subuser name when using <a href="#rbac-users-roles-policies">Role Based Access Control</a></td>
<td>SDC_USER</td>
</tr>
<tr>
<td>--keyId<br/>-k</td>
<td>Fingerprint of key to use for signing</td>
<td>SDC_KEY_ID</td>
</tr>
<tr>
<td>--url<br/>-u</td>
<td>URL of the CloudAPI endpoint</td>
<td>SDC_URL</td>
</tr>
</tbody>
</table>
<h2 id="provision-a-new-instance">Provision a new instance</h2>
<p>To provision a new instance, you first need to get the <code>id</code>s for the image and
package you want to use as the base for your instance.</p>
<p>An image is a snapshot of a filesystem and its software (for some types of
container), or a disk image (for hardware virtual machines).  You can get the
list of available images using the <code>triton image list</code> or <code>sdc-listimages</code>
commands; see the <a href="#ListImages">ListImages</a> section below for a detailed
explanation of these commands.</p>
<p>A package is a set of dimensions for the new instance, such as RAM and disk
size.  You can get the list of available packages using the
<code>triton package list</code> or <code>sdc-listpackages</code> commands; see the
<a href="#ListPackages">ListPackages</a> section below for a detailed explanation of these
commands.</p>
<p>Once you have the package and image ids, to provision a new instance:</p>
<pre><code>$ triton instance create $image $package
</code></pre>
<p>or</p>
<pre><code>$ sdc-createmachine --image=$image --package=$package
</code></pre>
<p>For example:</p>
<pre><code>$ triton instance create 2b683a82-a066-11e3-97ab-2faa44701c5a 64e23114-d502-c171-967f-b0e0cfb2009a
Creating instance 61dc8be (9205af5b-f2c0-ef07-e1f3-94bf1ff8fb93, base@13.4.0, test_128)
</code></pre>
<p>You can use the <code>--name</code> flag to name your instance; if you do not specify a
name,  Triton will generate one for you.  <code>--image</code> is the <code>id</code> of the image
you'd like to use as the new instance's base.  <code>--package</code> is the <code>id</code> of the
package to use to set instance dimensions. For the <code>triton</code> command, you can
also pass the name of the image or the package instead of their id.</p>
<p>Retrieve the status of your new instance by:</p>
<pre><code>$ triton instance get $instance_id
</code></pre>
<p>or</p>
<pre><code>$ sdc-getmachine $instance_id
</code></pre>
<p>For example:</p>
<pre><code>$ triton instance get 9205af5b-f2c0-ef07-e1f3-94bf1ff8fb93
{
    "id": "9205af5b-f2c0-ef07-e1f3-94bf1ff8fb93",
    "name": "61dc8be",
    "type": "smartmachine",
    "brand": "joyent",
    "state": "running",
    "image": "2b683a82-a066-11e3-97ab-2faa44701c5a",
    "ips": [
        "10.88.88.56",
        "192.168.128.5"
    ],
    "memory": 128,
    "disk": 12288,
    "metadata": {
        "root_authorized_keys": "&lt;...&gt;"
    },
    "tags": {},
    "created": "2015-12-06T04:31:17.053Z",
    "updated": "2015-12-06T04:31:26.000Z",
    "networks": [
        "67f1232c-5b40-4693-8b55-560245984233",
        "05dcc9e2-8ae6-48d9-8222-25f64465693f"
    ],
    "primaryIp": "10.88.88.56",
    "firewall_enabled": false,
    "compute_node": "564d0b8e-6099-7648-351e-877faf6c56f6",
    "package": "test_128"
}
</code></pre>
<p>When you provision a new instance, the instance will take time to be initialized
and booted; the <code>state</code> attribute will reflect this.  Once the <code>state</code> attribute
"running", you can login to your new instance (assuming it's a Unix-based
instance), with the following:</p>
<pre><code>$ ssh-add ~/.ssh/&lt;key file&gt;
$ ssh -A root@&lt;new instance IP address&gt;
</code></pre>
<p>These two commands set up your SSH agent (which has some magical properties,
so you need to handle your SSH keys less often), and logs you in as the <code>admin</code>
user on an instance.  Note that the <code>admin</code> user has password-less sudo
capabilities, so you may want to set up some less privileged users.  The SSH
keys on your account will allow you to login as <code>root</code> or <code>admin</code> on your new
instance.</p>
<p>An alternative of using SSH directly is:</p>
<pre><code>$ triton ssh &lt;name of instance&gt;
</code></pre>
<p>Now that we've done some basics with an instance, let's introduce a few
concepts:</p>
<p><a name="image-description"></a></p>
<h3 id="images">Images</h3>
<p>By default, SmartOS images should be available to your for use.  Your Triton
cloud may have other images available as well, such as Linux or Windows images.
The list of available images can be obtained with:</p>
<pre><code>$ triton image list
</code></pre>
<p>or</p>
<pre><code>$ sdc-listimages
</code></pre>
<p>For example:</p>
<pre><code>$ triton image list
SHORTID   NAME            VERSION  FLAGS  OS       TYPE          PUBDATE
e1faace4  minimal-64-lts  15.4.1   P      smartos  zone-dataset  2016-03-03
</code></pre>
<p><a name="packages-description"></a></p>
<h3 id="packages">Packages</h3>
<p>You can list packages available in your cloud with:</p>
<pre><code>$ triton package list
</code></pre>
<p>or</p>
<pre><code>$ sdc-listpackages
</code></pre>
<p>For example:</p>
<pre><code>$  ./triton package list
SHORTID   NAME      DEFAULT  MEMORY  SWAP  DISK  VCPUS
64e23114  test_128  false      128M  256M   12G      1
</code></pre>
<p>Packages are the Triton name for the dimensions of an instance (how much CPU will
be available, how much RAM, disk and swap, and so forth).  Packages are provided
so that you do not need to select individual settings, such as RAM or disk size.</p>
<h2 id="managing-ssh-keys">Managing SSH keys</h2>
<p>For instances which don't have a <code>brand</code> of <code>kvm</code> or <code>bhyve</code> (see
<code>triton instance list -o id,brand</code> or <code>sdc-listmachines</code>), you can manage the
SSH keys that allow logging into the instance via CloudAPI.  For example, to
rotate keys:</p>
<pre><code>$ triton key add --name=my-other-rsa-key ~/.ssh/my_other_rsa_key.pub
</code></pre>
<p>or</p>
<pre><code>$ sdc-createkey --name=my-other-rsa-key ~/.ssh/my_other_rsa_key.pub
</code></pre>
<p>The <code>--name</code> option sets the name of the key.  If you don't provide one,
CloudAPI sets it to the name of the file; in this case <code>my_other_rsa_key.pub</code>.</p>
<p>To use the new key, you will need to update the environment variables:</p>
<pre><code>$ export SDC_KEY_ID=`ssh-keygen -l -f ~/.ssh/my_other_rsa_key.pub | awk '{print $2}' | tr -d '\n'`
</code></pre>
<p>At this point you could delete your other key from the system; see
<a href="#cleaning-up">Cleaning Up</a> for a quick example.</p>
<p>You cannot manage the SSH keys of instances with a <code>brand</code> of <code>kvm</code> or <code>bhyve</code>.
Hardware virtual machines are static, and whatever keys were in your account at
instance creation time are used, provided the OS inside KVM is a *nix.</p>
<h2 id="cleaning-up">Cleaning up</h2>
<p>After going through this <code>Getting Started</code> section, you should now have at least
one SSH key and one instance.  The rest of the commands
assume you have <a href="https://www.npmjs.org/package/json">json</a> installed.</p>
<h3 id="deleting-machines">Deleting Machines</h3>
<p>To clean up an instance, you can use either:</p>
<pre><code>$ triton instance delete $instance_id
</code></pre>
<p>or</p>
<pre><code>$ sdc-deletemachine $instance_id
</code></pre>
<p>For example:</p>
<pre><code>$ triton instance delete 9205af5b
Delete (async) instance 9205af5b (9205af5b-f2c0-ef07-e1f3-94bf1ff8fb93)
</code></pre>
<h3 id="deleting-keys">Deleting keys</h3>
<p>Finally, you probably have one or two SSH keys uploaded to Triton after going
through the guide, so to delete the one we setup:</p>
<pre><code>$ triton key delete id_rsa
</code></pre>
<p>or</p>
<pre><code>$ sdc-deletekey id_rsa
</code></pre>
<h1 id="rbac-users-roles-policies">RBAC: Users, Roles &amp; Policies</h1>
<p>Starting at version 7.2.0, CloudAPI supports Role Based Access Control (RBAC),
which means that <a href="#account">accounts</a> can have multiple users and roles
associated with them.</p>
<p>While the behaviour of the <a href="#GetAccount">main account</a> remains the same,
including the <a href="#keys">SSH keys</a> associated with it, it's now possible to have
multiple <a href="#users">Users</a> subordinate to the main account.  Each of these
users have a different set of <a href="#sshKeys">SSH Keys</a>.  Both the users and their
associated SSH keys have the same format as the main account object (and the
keys associated with it).</p>
<p>It's worth mentioning that the <code>login</code> for an account's users must be different
only between the users of that account, not globally.  We could have an account
with login <em>"mark"</em>, another account "exampleOne" with a user with login "mark",
another account "exampleTwo" with another user with login "mark", and so
forth.</p>
<p>These account users can additionally be organized using <a href="#roles">Roles</a>:</p>
<pre><code>{
  "id": "ff578c1f-bad5-4d3c-8880-2f76745f2511",
  "name": "devs",
  "members": [
    {
      "type": "subuser",
      "id": "985e0ed4-9994-4303-8c43-6c92b7988167",
      "login": "bob",
      "default": true
    },
    {
      "type": "subuser",
      "id": "0cc38461-787a-4c05-a3f3-352a4d55541f",
      "login": "fred",
      "default": false
    }
  ],
  "policies": [
    {
      "id": "2104c53f-2e33-4393-9320-a6521d5ef2dc",
      "name": "createMachine"
    },
    {
      "id": "e8bdd555-eef0-4c1c-83be-93c443b59e3e",
      "name": "restart instances"
    }
  ]
}
</code></pre>
<p>Each role can have an arbitrary set of <a href="#policies">Policies</a>:</p>
<pre><code>{
  "name": "restart instances",
  "id": "e8bdd555-eef0-4c1c-83be-93c443b59e3e",
  "rules": [
    "CAN rebootmachine if requesttime::time &gt; 07:30:00 and requesttime::time &lt; 18:30:00 and requesttime::day in (Mon, Tue, Wed, THu, Fri)",
    "CAN stopmachine",
    "CAN startmachine"
  ],
  "description": "This is completely optional"
}
</code></pre>
<p>The <code>rules</code> in policies are used for the access control of an account's users.
These rules use <a href="https://github.com/joyent/node-aperture">Aperture</a> as the
policy language, and are described in detail in the next section.</p>
<p>Our recommendation is to limit each policy's set of rules to a very scoped
collection, and then add one or more of these policies to each group.  This aids
easily reusing existing policies for one or more roles, allowing fine-grained
definition of each role's abilities.</p>
<h2 id="rules-definition-for-access-control">Rules definition for access control</h2>
<p>As mentioned earlier, the policies' rules use
<a href="https://github.com/joyent/node-aperture#policy-language">Aperture Policy Language</a>,
with the following <em>basic format</em>:</p>
<p><code>&lt;principals&gt; CAN &lt;actions&gt; &lt;resources&gt; WHEN &lt;conditions&gt;</code>.</p>
<p>You should refer to the
<a href="https://github.com/joyent/node-aperture">Aperture documentation</a> for the
complete details about the different possibilities when defining new rules.
This section will only cover a limited set strictly related to CloudAPI's usage.</p>
<p>In the case of CloudAPI, <code>&lt;principal&gt;</code> will be always the user performing the
HTTP request. Likewise, <code>&lt;resource&gt;</code> will always be the URL of such request,
for example <code>/:account/machines/:instance_id</code>.</p>
<p>We add one or more roles to a resource to explicitly define the active roles a
user trying to access a given resource must have. Therefore, we don't need to
specify <code>&lt;principal&gt;</code> in our rules, since it'll always be defined by the
role-tags of the resource the user is trying to get access to. For the same
reason, we don't need to specify <code>&lt;resource&gt;</code> in our rules.</p>
<p>Therefore, CloudAPI's Aperture rules have the format:</p>
<pre><code>    CAN &lt;actions&gt; WHEN &lt;conditions&gt;
</code></pre>
<p>By default, the access policy will <code>DENY</code> any attempt made by any account user
to access a given resource, unless:</p>
<ul>
<li>that resource is tagged with a role</li>
<li>that role is active</li>
<li>that role has a policy</li>
<li>that policy contains a rule which explicity <code>GRANTS</code> access to that resource</li>
</ul>
<p>For example, a user with an active role <code>read</code>, which includes a policy rule
like <code>CAN listmachines and getmachines</code> will not get access to resources like
<code>/:account/machines</code> or <code>/:account/machines/:instance_id</code> unless these resources
are <em>role-tagged</em> with the role <code>read</code> too.</p>
<p>Additionally, given that the <code>&lt;actions&gt;</code> included in the policy rule are just
<code>listmachines</code> and <code>getmachine</code>, the user will be able to retrieve an instance's
details provided by the <a href="#GetMachine">GetMachine</a> action, but will not be able
to perform any other instance actions (like <a href="#StopMachine">StopMachine</a>).
However, if the role has a rule including that <code>&lt;action&gt;</code> (like StopMachine), or
the user has an additional role which includes that rule, then the user can
invoke that action too.</p>
<p>As an aside, the active roles of a user are set by the <code>default_members</code>
attribute in a role. If three different roles contain the "john" user (amongst
others) in their default-members list, then the "john" user will have those
three roles as active roles by default. This can be overridden by passing in
<code>?as-role=&lt;comma-separated list of role names&gt;</code> as part of the URL, or adding a
--role flag when using a node-smartdc command; provided that each role contains
that user in their <code>members</code> list, then those roles are set as the
currently-active roles for a request instead.</p>
<p>For more details on how Access Control works for both CloudAPI and Manta,
please refer to <a href="https://docs.joyent.com/jpc/rbac/">Role Based Access Control</a>
documentation.</p>
<h3 id="an-important-note-about-rbac-and-certain-reads-after-writes">An important note about RBAC and certain reads after writes</h3>
<p>CloudAPI uses replication and caching behind the scenes for user, role and
policy data. This implies that API reads after a write on these particular
objects can be up to several seconds out of date.</p>
<p>For example, when a user is created, CloudAPI returns both a user object
(which is up to date), and a location header indicating where that new user
object actually lives. Following that location header may result in a 404 for
a short period.</p>
<p>As another example, if a policy is updated, the API call will return a policy
object (which is up to date), but GETing that URL again may temporarily return
a outdated object with old object details.</p>
<p>For the time being, please keep in mind that user, role and policy
creation/updates/deletion may potentially take several seconds to settle. They
have eventual consistency, not read-after-write.</p>
<h1 id="api-introduction">API Introduction</h1>
<p>CloudAPI exposes a REST API over HTTPS.  You can work with the REST API by
either calling it directly via tooling you already know about (such as curl, et
al), or by using the CloudAPI CLIs and SDKs from Joyent.  The node-triton
CloudAPI SDK &amp; CLI is available as an npm module, which you can install with:</p>
<pre><code>$ npm install triton
</code></pre>
<p>Alternatively, there is the more stable and feature-complete node-smartdc:</p>
<pre><code>$ npm install smartdc
</code></pre>
<p>Although node-triton has fewer features -- for now -- it will continue to
receive the most development effort and future support. node-smartdc is in
maintenance.</p>
<p>The rest of this document will show all APIs in terms of both the raw HTTP
specification, the CLI commands, and sometimes the node-smartdc SDK.</p>
<h2 id="issuing-requests">Issuing Requests</h2>
<p>All HTTP calls to CloudAPI must be made over TLS, and requests must carry at
least two headers (in addition to standard HTTP headers): <code>Authorization</code> and
<code>Api-Version</code>.  The details are explained below.  In addition to these headers,
any requests requiring content must be sent in an acceptable scheme to
CloudAPI.  Details are also below.</p>
<h3 id="content-type">Content-Type</h3>
<p>For requests requiring content, you can send parameters encoded with
<code>application/json</code>, <code>application/x-www-form-urlencoded</code> or
<code>multipart/form-data</code>.  Joyent recommends <code>application/json</code>.  The value of the
<code>Accept</code> header determines the encoding of content returned in responses.
CloudAPI supports <code>application/json</code> response encodings only.</p>
<p>For example, all of the following are valid calls:</p>
<p>Query String (on the uri):</p>
<pre><code>POST /my/keys?name=rsa&amp;key=... HTTP/1.1
Host: joyent.com
Authorization: ...
Content-Length: 0
</code></pre>
<p>Form encoded in the body:</p>
<pre><code>POST /my/keys HTTP/1.1
Host: joyent.com
Authorization: ...
Content-Type: application/x-www-form-urlencoded
Content-Length: 123

name=rsa&amp;key=...
</code></pre>
<p>JSON in the body:</p>
<pre><code>POST /my/keys HTTP/1.1
Host: joyent.com
Authorization: ...
Content-Type: application/json
Content-Length: 123

{"name":"rsa","key":"..."}
</code></pre>
<h3 id="authorization">Authorization</h3>
<p>All API calls to CloudAPI require an Authorization header, which supports
multiple <a href="http://tools.ietf.org/html/rfc2617">"schemes"</a>.  Currently CloudAPI
supports only one Authentication mechanism due to PCI compliance restrictions:</p>
<ul>
<li>HTTP Signature Authentication Scheme.  This Scheme is outlined in
<a href="#appendix-b-http-signature-authentication">Appendix B</a>.</li>
</ul>
<p>In order to leverage HTTP Signature Authentication, only RSA signing mechanisms
are supported, and your keyId must be equal to the path returned from a
<a href="#ListKeys">ListKeys</a> API call.  For example, if your Triton login is <code>demo</code>,
and you've uploaded an RSA SSH key with the name <code>foo</code>, an Authorization
header would look like:</p>
<pre><code>Authorization: Signature keyId=/demo/keys/foo,algorithm="rsa-sha256" ${Base64(sign($Date))}
</code></pre>
<p>The default value to sign for CloudAPI requests is simply the value of the HTTP
<code>Date</code> header.  For more information on the Date header value, see
<a href="http://tools.ietf.org/html/rfc2616#section-14.18">RFC 2616</a>.  All requests to
CloudAPI using the Signature authentication scheme <em>must</em> send a Date header.
Note that clock skew will be enforced to within 300 seconds (positive or
negative) from the value sent.</p>
<p>Full support for the HTTP Signature Authentication scheme is provided in both
CloudAPI SDKs; an additional reference implementation for Node.js is available
in the npm <code>http-signature</code> module, which you can install with:</p>
<pre><code>npm install http-signature
</code></pre>
<h3 id="using-curl-with-cloudapi">Using cURL with CloudAPI</h3>
<p>Since <a href="http://curl.haxx.se/">cURL</a> is commonly used to script requests to web
services, here's a simple Bash function you can use to wrap cURL when
communicating with CloudAPI:</p>
<pre><code>$ function cloudapi() {
    local now=$(date -u '+%a, %d %h %Y %H:%M:%S GMT')
    local signature=$(echo -n "$now" | openssl dgst -sha256 -sign ~/.ssh/id_rsa | openssl enc -e -a | tr -d '\n')
    local url="$SDC_URL$1"
    shift

    curl -s -k -i \
        -H 'Accept: application/json' \
        -H "accept-version: ~8" \
        -H "Date: $now" \
        -H "Authorization: Signature keyId=\"/$SDC_ACCOUNT/keys/id_rsa\",algorithm=\"rsa-sha256\" $signature" \
        "$@" "$url"
    echo
}
</code></pre>
<p>You may need to alter the path to your SSH key in the above function, as well as
the path its public-key is saved under in Triton.</p>
<p>With that function, you could just do:</p>
<pre><code>$ cloudapi /my/machines
</code></pre>
<h2 id="cloudapi-http-responses">CloudAPI HTTP Responses</h2>
<p>CloudAPI returns all response objects as <code>application/json</code> encoded HTTP bodies.
In addition to the JSON body, all responses have the following headers:</p>
<table>
<thead>
<tr>
<th><strong>Header</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>Date</td>
<td>When the response was sent (RFC 1123 format)</td>
</tr>
<tr>
<td>Api-Version</td>
<td>The exact version of the CloudAPI server you spoke with</td>
</tr>
<tr>
<td>Request-Id</td>
<td>A unique id for this request; you should log this</td>
</tr>
<tr>
<td>Response-Time</td>
<td>How long the server took to process your request (ms)</td>
</tr>
</tbody>
</table>
<p>If there is content, you can expect:</p>
<table>
<thead>
<tr>
<th><strong>Header</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>Content-Length</td>
<td>How much content, in bytes</td>
</tr>
<tr>
<td>Content-Type</td>
<td>Formatting of the response (almost always application/json)</td>
</tr>
<tr>
<td>Content-MD5</td>
<td>An MD5 checksum of the response; you should check this</td>
</tr>
</tbody>
</table>
<h3 id="http-status-codes">HTTP Status Codes</h3>
<p>Your client should check for each of the following status codes from any API
request:</p>
<table>
<thead>
<tr>
<th><strong>Code</strong></th>
<th><strong>Description</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>400</td>
<td>Bad Request</td>
<td>Invalid HTTP Request</td>
</tr>
<tr>
<td>401</td>
<td>Unauthorized</td>
<td>Either no Authorization header was sent, or invalid credentials were used</td>
</tr>
<tr>
<td>403</td>
<td>Forbidden</td>
<td>No permissions to the specified resource</td>
</tr>
<tr>
<td>404</td>
<td>Not Found</td>
<td>Resource was not found</td>
</tr>
<tr>
<td>405</td>
<td>Method Not Allowed</td>
<td>Method not supported for the given resource</td>
</tr>
<tr>
<td>406</td>
<td>Not Acceptable</td>
<td>Try sending a different Accept header</td>
</tr>
<tr>
<td>409</td>
<td>Conflict</td>
<td>Most likely invalid or missing parameters</td>
</tr>
<tr>
<td>413</td>
<td>Request Entity Too Large</td>
<td>You sent too much data</td>
</tr>
<tr>
<td>415</td>
<td>Unsupported Media Type</td>
<td>Request was encoded in a format CloudAPI does not understand</td>
</tr>
<tr>
<td>420</td>
<td>Slow Down</td>
<td>You're sending too many requests too quickly</td>
</tr>
<tr>
<td>449</td>
<td>Retry With</td>
<td>Invalid Version header; try with a different Api-Version string</td>
</tr>
<tr>
<td>500</td>
<td>Internal Error</td>
<td>An unexpected error occurred; see returned message for more details.</td>
</tr>
<tr>
<td>503</td>
<td>Service Unavailable</td>
<td>Either there's no capacity in this datacenter, or it's in a maintenance window</td>
</tr>
</tbody>
</table>
<h3 id="error-responses">Error Responses</h3>
<p>In the event of an error, CloudAPI will return a standard JSON error response
object in the body with the scheme:</p>
<pre><code>{
  "code": "CODE",
  "message": "human readable string"
}
</code></pre>
<p>Where the code element is one of:</p>
<table>
<thead>
<tr>
<th><strong>Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>BadRequest</td>
<td>You sent bad HTTP</td>
</tr>
<tr>
<td>InternalError</td>
<td>Something went wrong in Triton</td>
</tr>
<tr>
<td>InUseError</td>
<td>The object is in use and cannot be operated on</td>
</tr>
<tr>
<td>InvalidArgument</td>
<td>You sent bad arguments or a bad value for an argument</td>
</tr>
<tr>
<td>InvalidCredentials</td>
<td>Authentication failed</td>
</tr>
<tr>
<td>InvalidHeader</td>
<td>You sent a bad HTTP header</td>
</tr>
<tr>
<td>InvalidVersion</td>
<td>You sent a bad Api-Version string</td>
</tr>
<tr>
<td>MissingParameter</td>
<td>You didn't send a required parameter</td>
</tr>
<tr>
<td>NotAuthorized</td>
<td>You don't have access to the requested resource</td>
</tr>
<tr>
<td>RequestThrottled</td>
<td>You were throttled</td>
</tr>
<tr>
<td>RequestTooLarge</td>
<td>You sent too much request data</td>
</tr>
<tr>
<td>RequestMoved</td>
<td>HTTP Redirect</td>
</tr>
<tr>
<td>ResourceNotFound</td>
<td>What you asked for wasn't found</td>
</tr>
<tr>
<td>UnknownError</td>
<td>Something completely unexpected happened!</td>
</tr>
</tbody>
</table>
<p>Clients are expected to check HTTP status code first, and if it's in the 4xx
range, they can leverage the codes above.</p>
<h1 id="api-versions">API Versions</h1>
<p>A CloudAPI endpoint has two relevant version values: the code version and the
"API version". The former includes the full <code>major.minor.patch</code> version value
of the deployed server and, as of CloudAPI v8.3.0, is available in the "Server"
header of all responses:</p>
<pre><code>Server: cloudapi/8.3.1
</code></pre>
<p>The <em>API</em> version is only changed for major versions, e.g. API version "8.0.0"
is used for all 8.x code versions. (Older CloudAPI v7 would bump the API version
at the minor version level.)</p>
<p>All requests to CloudAPI must specify an acceptable API <a href="https://github.com/npm/node-semver#ranges">version
range</a> via the 'Accept-Version' (or
for backward compatibility the 'Api-Version') header. For example:</p>
<pre><code>Accept-Version: ~8              // accept any 8.x version
Accept-Version: 7.0.0           // require exactly this version
Accept-Version: ~8||~7          // accept 8.x or 7.x
Accept-Version: *               // the latest version (wild west)
</code></pre>
<p>For new applications using CloudAPI SDKs, it is recommended that one explicitly
accept a particular major version, e.g. <code>Accept-Version: ~8</code>, so that
future CloudAPI backward incompatible changes (always done with a <em>major</em>
version bump) don't break your application.</p>
<p>The <a href="https://github.com/joyent/node-triton"><code>triton</code> tool</a> uses
<code>Accept-Version: ~9||~8</code> by default. Users can restrict the API version via the
<code>triton --accept-version=RANGE ...</code> option. The older <code>sdc-*</code> tools from
node-smartdc use <code>~8||~7</code> by default, and users can restrict the API
version via the <code>SDC_API_VERSION=RANGE</code> environment variable or the
<code>--api-version=RANGE</code> option to each command.</p>
<h1 id="ping">Ping</h1>
<p>The set of supported <em>API versions</em> is given in the ping endpoint:</p>
<pre><code>GET /--ping
accept: application/json
accept-version: ~8
...

HTTPS/1.1 200 OK
server: cloudapi/9.2.0
content-type: application/json
...
api-version: 8.0.0
Triton-Datacenter-Name: us-west-1

{
    "ping": "pong",
    "cloudapi": {
        "versions": [
            "7.0.0",
            "7.1.0",
            "7.2.0",
            "7.3.0",
            "8.0.0",
            "9.0.0"
        ]
    }
}
</code></pre>
<p>Note that a <code>Triton-Datacenter-Name</code> response header was added in 9.2.0.</p>
<h1 id="versions">Versions</h1>
<p>The section describes API changes in CloudAPI versions.</p>
<h2 id="960">9.6.0</h2>
<ul>
<li>Added support for user-driven machine <a href="#migrations">Migrations</a>,
  allowing the movement of machines between servers.</li>
</ul>
<h2 id="950">9.5.0</h2>
<ul>
<li>Remove Cloud Analytics endpoints. Cloud Analytics has been removed from
  Triton. See <a href="https://smartos.org/bugview/TRITON-884">TRITON-884</a> for details.</li>
<li><a href="#CreateMachine">CreateMachine</a>'s <code>affinity</code> rules now work with concurrent
  provisions.</li>
</ul>
<h2 id="943">9.4.3</h2>
<ul>
<li><a href="#ListPackages">ListPackages</a> and <a href="#GetPackage">GetPackage</a> include the
  <code>flexible_disk</code> and <code>disks</code> attributes if they exist</li>
</ul>
<h2 id="942">9.4.2</h2>
<ul>
<li>The disks.*.uuid parameter was renamed to disks.*.id. This change impacts
  <a href="#CreateMachine">CreateMachine</a>, <a href="#GetMachine">GetMachine</a>, and
  <a href="#ListMachines">ListMachines</a>. Backwards incompatible with versions 9.4.0
  and 9.4.1.</li>
</ul>
<h2 id="941">9.4.1</h2>
<ul>
<li>Added support for <a href="#CreateMachineDisk">CreateMachineDisk</a>,
  <a href="#ResizeMachineDisk">ResizeMachineDisk</a> and
  <a href="#DeleteMachineDisk">DeleteMachineDisk</a> for bhyve VMs; this only applies to
  bhyve VMs that have flexible disk space enabled.
  <a href="#GetMachineDisk">GetMachineDisk</a> and <a href="#ListMachineDisks">ListMachineDisks</a>
  are also provided.</li>
</ul>
<h2 id="940">9.4.0</h2>
<ul>
<li><a href="#CreateMachine">CreateMachine</a> may pass disk quantity and size for bhyve
  instances. <a href="#GetMachine">GetMachine</a> and <a href="#ListMachines">ListMachines</a>
  returns information about these disks. <a href="#GetMachineSnapshot">GetMachineSnapshot</a>
  and <a href="#ListMachineSnapshots">ListMachineSnapshots</a> includes snapshot size.</li>
</ul>
<h2 id="920">9.2.0</h2>
<ul>
<li>Added new ImportImageFromDatacenter API method to allow an image to be copied
  to another datacenter in the same cloud.</li>
<li>Added a <code>Triton-Datacenter-Name</code> response header to <a href="#Ping">Ping</a> and
  <a href="#ListDatacenters">ListDatacenters</a> responses.</li>
</ul>
<h2 id="910">9.1.0</h2>
<ul>
<li>
<p>Added <a href="#CloneImage">Clone Image</a>. This can be used to create a your own copy
  of an image owned by another account that has been shared with you (via
  <code>triton image share</code>).</p>
</li>
<li>
<p>[Backward incompatible] Shared images will no longer be provisioned by default
  when an <code>Accept-Version</code> of <code>~9</code> or higher is used. You will need to
  explicitly add the <code>allow_shared_images</code> param to CreateMachine (which is what
  <code>triton create --allow-shared-images</code> does). Older versions of the
  CreateMachine interface will allow the provisioning of shared images.</p>
</li>
</ul>
<h2 id="900">9.0.0</h2>
<ul>
<li>New object-based format for Roles: the "members" and "policies" properties
  are now arrays of objects describing their values, rather than arrays of
  strings as they were before. The "default_members" array is replaced by the
  "default" boolean property on the objects. You can still elect to use the old
  interface by using a lower <code>Accept-Version</code> than <code>9.0.0</code>.</li>
</ul>
<h2 id="8110">8.11.0</h2>
<ul>
<li>Added a new API method to the plugin interface: modifyProvisionNetworks. This
  can be used to modify network arguments sent in the vmapi provision call.</li>
</ul>
<h2 id="8100">8.10.0</h2>
<ul>
<li>GetImage now includes information about the brand requirements in the
  <code>requirements.brand</code> member of the returned JSON.</li>
</ul>
<h2 id="890">8.9.0</h2>
<ul>
<li>The plugin interface has changed. preProvision/postProvision hooks have been
  replaced with allowProvision/postProvision and an expanded API. This is a
  change invisible to CloudAPI REST consumers.</li>
</ul>
<h2 id="880">8.8.0</h2>
<ul>
<li>CreateMachine now takes brand from the package's <code>brand</code> parameter if brand is
  not specified by the image, and ensures that package and image brand
  requirements do not conflict.</li>
<li>Fixed some bugs in the <code>brand</code> handling for packages.</li>
</ul>
<h2 id="870">8.7.0</h2>
<ul>
<li>CreateMachine no longer accepts the <code>brand</code> field for specifying the brand
  of the instance to create.</li>
</ul>
<h2 id="860">8.6.0</h2>
<ul>
<li>CreateMachine now accepts the <code>brand</code> field for specifying the brand of the
  instance to create. This is currently only useful when provisioning a
  virtualmachine in a datacenter that supports both kvm (default) and bhyve.</li>
<li>Added <a href="#deletion-protection">Deletion Protection</a>. Setting
  deletion_protection to true when creating or updating an instances will stop
  stop both <a href="#DeleteMachine">DeleteMachine</a> and SDC Docker from destroying an
  instance. This remains true until that attribute is set to false.</li>
</ul>
<h2 id="850">8.5.0</h2>
<ul>
<li>CreateMachine and AddNic now accept specifying a <a href="#network-objects">network
  object</a> instead of just a network UUID. The network object
  extends functionality by allowing a machine to be provisioned with specific
  IPs. It's also now possible to add a NIC to an instance with a specific IP.
  It's worth noting that it's still possible to pass in just the UUID of a
  network, however you cannot mix the new and old formats in the same request.</li>
</ul>
<h2 id="840">8.4.0</h2>
<ul>
<li>This version adds support for the following new endpoints:
  <a href="#ListNetworkIPs">ListNetworkIPs</a>, <a href="#GetNetworkIP">GetNetworkIP</a>,
  and <a href="#UpdateNetworkIP">UpdateNetworkIP</a>.</li>
</ul>
<h2 id="830">8.3.0</h2>
<ul>
<li>CreateMachine supports a new <code>affinity</code> field for specifying affinity rules.
  Affinity rules (inspired by Docker Swarm affinity filters) allow a more
  powerful mechanism for controlling server placement of instances.
  This deprecates the <code>locality</code> field for "locality hints" on CreateMachine.</li>
</ul>
<p>This CloudAPI feature is comparable to <a href="https://apidocs.joyent.com/docker/features/placement">Triton's Docker placement affinity
  rules</a>.</p>
<h2 id="821">8.2.1</h2>
<ul>
<li>GetMachine works with machines that do not have a package or a network. Such
  machines cannot be created through CloudAPI, so this isn't applicable to most
  people unless they have an operator do this for them. ListMachines no longer
  breaks for such machines either.</li>
</ul>
<h2 id="820">8.2.0</h2>
<ul>
<li>This version adds support for {{shortId}} tags in the 'name' parameter when
  creating a machine using <a href="#CreateMachine">CreateMachine</a> machine. Any
  instances of {{shortId}} in the name will be replaced with the shortened
  version (first 8 characters) of the machine's id.</li>
</ul>
<h2 id="811">8.1.1</h2>
<ul>
<li>It's now possible to query packages using wildcards. See the
<a href="#ListPackages">ListPackages</a> section.</li>
</ul>
<h2 id="810">8.1.0</h2>
<ul>
<li>This version should have no visible API changes, but updates a lot of
  libraries that Cloudapi depends on, as well as the nodejs major version.
  Visible differences with 8.0.0 are bugs, but it's possible some might have
  crept through.</li>
</ul>
<h2 id="800">8.0.0</h2>
<ul>
<li>
<p>Instance/machine objects (from GetMachine, ListMachines) now has a <code>brand</code>
  attribute, which is more granular than the existing <code>type</code> (now deprecated).
  Also a <code>docker</code> boolean attribute, which indicates whether the instance
  is a Docker container.</p>
</li>
<li>
<p>[Backward incompatible] This version also makes a breaking change to the
  attribute <code>type</code> on images. In API versions 7 and earlier, <code>&lt;image&gt;.type</code>
  was either "virtualmachine" (for zvol images) or "smartmachine" for other
  image types. In version 8, <code>&lt;image&gt;.type</code> is the untranslated <a href="https://images.joyent.com/docs/#manifest-type">type value
  from the image in the IMGAPI</a>.</p>
</li>
<li>
<p>[Backward incompatible] ListDatasets and GetDataset have been removed.
  Use ListImages and GetImage, respectively.</p>
</li>
<li>
<p>[Backward incompatible] The long deprecated support for API version 6.5
  has been dropped. The <code>default</code> attribute on package objects is deprecated,
  since it only had meaning in 6.5.</p>
</li>
</ul>
<h2 id="730">7.3.0</h2>
<ul>
<li>Network fabrics (software-defined networking) support.
  This allows the creation of virtual LANs and layer-three networks.</li>
</ul>
<h2 id="720">7.2.0</h2>
<ul>
<li>RBAC v1 has been made available on the CloudAPI interface. Accounts can create
  users, rules can be created and combined to make policies, policies and users
  can be associated together using roles, and role tags can be applied to
  CloudAPI resources.</li>
</ul>
<h2 id="710">7.1.0</h2>
<ul>
<li>
<p>Starting with version 7.1.0, customer image management is made available,
  allowing <a href="#CreateImageFromMachine">Machine Creation from Images</a>,
  <a href="#ExportImage">exporting images to the specified manta path</a> and
  <a href="#DeleteImage">custom images deletion</a>.</p>
</li>
<li>
<p>Instance objects (from GetMachine, ListMachines) now have a <code>networks</code> array
  of IDs (UUIDs) of the networks on which the instance has NICs.</p>
</li>
<li>
<p>Image objects (from GetImage, ListImages) now have a <code>files</code> array (containing
  <code>compression</code>, <code>sha1</code> and <code>size</code>), <code>owner</code>, <code>public</code>, <code>state</code>, <code>tags</code>, <code>eula</code>,
  and <code>acl</code> attributes.</p>
</li>
<li>
<p>Firewall rules include information regarding rules being global or not
  (<code>global</code> attribute), and will optionally include a human-readable
  <code>description</code> attribute for the rules (which can be modified except for global
  rules).</p>
</li>
</ul>
<h2 id="700">7.0.0</h2>
<ul>
<li>HTTP signature auth.</li>
</ul>
<h1 id="account">Account</h1>
<p>You can obtain your account details and update them through CloudAPI, although
<code>login</code> cannot be changed, and <code>password</code> can not be retrieved.</p>
<h2 id="getaccount-get-login">GetAccount (GET /:login)</h2>
<p>Retrieves your account details. Instead of providing your login name, you can
also provide 'my' (i.e. GET /my).</p>
<h3 id="inputs">Inputs</h3>
<ul>
<li>None</li>
</ul>
<h3 id="returns">Returns</h3>
<p>Account object:</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>Unique id for this account</td>
</tr>
<tr>
<td>login</td>
<td>String</td>
<td>Your login name</td>
</tr>
<tr>
<td>email</td>
<td>String</td>
<td>Email address</td>
</tr>
<tr>
<td>companyName</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>firstName</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>lastName</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>address</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>postalCode</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>city</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>state</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>country</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>phone</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>created</td>
<td>ISO8601 date</td>
<td>When this account was created</td>
</tr>
<tr>
<td>updated</td>
<td>ISO8601 date</td>
<td>When this account's details was last updated</td>
</tr>
<tr>
<td>triton_cns_enabled</td>
<td>Boolean</td>
<td><code>true</code> if Triton CNS is enabled for account</td>
</tr>
</tbody>
</table>
<h3 id="errors">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command">CLI Command</h3>
<pre><code>$ triton account get
</code></pre>
<p>or</p>
<pre><code>$ sdc-getaccount
</code></pre>
<h3 id="example-request">Example Request</h3>
<pre><code>GET /my HTTP/1.1
authorization: Signature keyId="..."
accept: application/json
accept-version: ~8
host: api.example.com
</code></pre>
<h3 id="example-response">Example Response</h3>
<pre><code>HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 285
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: GET, HEAD, POST, PUT
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Content-MD5: Sz+3BJ3EKDxL3MLQQumPgg==
Date: Tue, 22 Dec 2015 05:06:33 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: c3d496f0-a869-11e5-8662-47ccf5717dbf
Response-Time: 2122

{
  "id": "b89d9dd3-62ce-4f6f-eb0d-f78e57d515d9",
  "login": "barbar",
  "email": "barbar@example.com",
  "companyName": "Example Inc",
  "firstName": "BarBar",
  "lastName": "Jinks",
  "phone": "123-456-7890",
  "updated": "2015-12-21T11:48:54.884Z",
  "created": "2015-12-21T11:48:54.884Z"
}
</code></pre>
<h2 id="updateaccount-post-login">UpdateAccount (POST /:login)</h2>
<p>Update your account details with the given parameters.</p>
<h3 id="inputs_1">Inputs</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>email</td>
<td>String</td>
<td>Email address</td>
</tr>
<tr>
<td>companyName</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>firstName</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>lastName</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>address</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>postalCode</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>city</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>state</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>country</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>phone</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>triton_cns_enabled</td>
<td>Boolean</td>
<td>Enable or disable the Triton CNS</td>
</tr>
</tbody>
</table>
<h3 id="returns_1">Returns</h3>
<p>Account object:</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>Unique id for this account</td>
</tr>
<tr>
<td>login</td>
<td>String</td>
<td>Your login name</td>
</tr>
<tr>
<td>email</td>
<td>String</td>
<td>Email address</td>
</tr>
<tr>
<td>companyName</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>firstName</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>lastName</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>address</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>postalCode</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>city</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>state</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>country</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>phone</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>created</td>
<td>ISO8601 date</td>
<td>When this account was created</td>
</tr>
<tr>
<td>updated</td>
<td>ISO8601 date</td>
<td>When this account's details was last updated</td>
</tr>
<tr>
<td>triton_cns_enabled</td>
<td>Boolean</td>
<td><code>true</code> if Triton CNS is enabled for account</td>
</tr>
</tbody>
</table>
<h3 id="errors_1">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_1">CLI Command</h3>
<pre><code>$ triton account update postalCode=12345 phone='1 (234) 567 890'
</code></pre>
<p>or</p>
<pre><code>$ sdc-updateaccount --postal-code=12345 --phone='1 (234) 567 890'
</code></pre>
<h3 id="example-request_1">Example Request</h3>
<pre><code>POST /my HTTP/1.1
authorization: Signature keyId="...
accept: application/json
content-type: application/json
accept-version: ~8
content-length: 48
content-md5: 6kCHdE651hsI9N82TUkU/g==
host: api.example.com
connection: keep-alive

postal-code=12345&amp;phone=1%20(234)%20567%20890
</code></pre>
<h3 id="example-response_1">Example Response</h3>
<pre><code>HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 309
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: GET, HEAD, POST, PUT
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Content-MD5: xxJ5ppNDrEyAf5VIlt4GZw==
Date: Tue, 22 Dec 2015 12:16:37 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: d8db9e90-a8a5-11e5-90c9-4dcf4848c834
Response-Time: 1244

{
  "id": "b89d9dd3-62ce-4f6f-eb0d-f78e57d515d9",
  "login": "barbar",
  "email": "barbar@example.com",
  "companyName": "Example Inc",
  "firstName": "BarBar",
  "lastName": "Jinks",
  "postalCode": "12345",
  "phone": "1 (234) 567 890",
  "updated": "2015-12-22T12:16:37.781Z",
  "created": "2015-12-21T11:48:54.884Z"
}
</code></pre>
<h1 id="keys">Keys</h1>
<p>This part of the API is the means by which you operate on your SSH/signing keys.
These keys are needed in order to login to instances over SSH, as well as signing
requests to this API (see the HTTP Signature Authentication Scheme outlined in
<a href="#appendix-b-http-signature-authentication">Appendix B</a> for more details).</p>
<p>Currently CloudAPI supports uploads of public keys in the OpenSSH format.</p>
<p>Note that while it's possible to provide a <code>name</code> attribute for an SSH key in
order to use it as a human-friendly alias, this attribute's presence is
optional.  When it's not provided, the ssh key fingerprint will be used as the
<code>name</code> instead.</p>
<p>Keys can optionally be submitted along with a hardware attestation certificate
signed by a trusted hardware manufacturer, which will be validated and
processed. Keys generated in hardware devices which require some form of
multi-factor authentication to sign requests (e.g. the device requires a PIN or
Touch input) are marked by this mechanism and may be specially treated by
Triton and Manta as providing a kind of 2-factor authentication (depending on
administrator policy).</p>
<p>For the following routes, the parameter placeholder <code>:key</code> can be replaced with
with either the key's <code>name</code> or its <code>fingerprint</code>.  It's strongly recommended to
use <code>fingerprint</code> when possible, since the <code>name</code> attribute does not have any
uniqueness constraints.</p>
<h2 id="listkeys-get-loginkeys">ListKeys (GET /:login/keys)</h2>
<p>Lists all public keys we have on record for the specified account.</p>
<h3 id="inputs_2">Inputs</h3>
<ul>
<li>None</li>
</ul>
<h3 id="returns_2">Returns</h3>
<p>Array of key objects.  Each key object has the following fields:</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>String</td>
<td>Name for this key</td>
</tr>
<tr>
<td>fingerprint</td>
<td>String</td>
<td>Key fingerprint</td>
</tr>
<tr>
<td>key</td>
<td>String</td>
<td>Public key in OpenSSH format</td>
</tr>
<tr>
<td>attested</td>
<td>Boolean</td>
<td>Indicates if the key has a hardware device attestation</td>
</tr>
<tr>
<td>multifactor</td>
<td>Array[String]</td>
<td>Lists any additional factors required to use (if attested)</td>
</tr>
</tbody>
</table>
<p>Possible <code>multifactor</code> values:</p>
<table>
<thead>
<tr>
<th><strong>Value</strong></th>
<th><strong>Meaning</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>pin</td>
<td>Input of a PIN or password is required for key use</td>
</tr>
<tr>
<td>touch</td>
<td>Touch input (not authenticated -- i.e. not a fingerprint) is required for key use</td>
</tr>
</tbody>
</table>
<h3 id="errors_2">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_2">CLI Command</h3>
<pre><code>$ triton key list

or

$ sdc-listkeys
</code></pre>
<h3 id="example-request_2">Example Request</h3>
<pre><code>GET /my/keys HTTP/1.1
Host: api.example.com
Authorization: ...
Accept: application/json
Api-Version: ~8
</code></pre>
<h3 id="example-response_2">Example Response</h3>
<pre><code>HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 832
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: POST, GET, HEAD
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Content-MD5: u4xmk+MgKzzIvrRt09k4sg==
Date: Tue, 22 Dec 2015 12:23:12 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: c44e2000-a8a6-11e5-9030-479dc847c4b2
Response-Time: 1041

[
  {
    "name": "barbar",
    "fingerprint": "03:7f:8e:ef:da:3d:3b:9e:a4:82:67:71:8c:35:2c:aa",
    "key": "&lt;...&gt;"
  }
]
</code></pre>
<h2 id="getkey-get-loginkeyskey">GetKey (GET /:login/keys/:key)</h2>
<p>Retrieves the record for an individual key.</p>
<h3 id="inputs_3">Inputs</h3>
<ul>
<li>None</li>
</ul>
<h3 id="returns_3">Returns</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>String</td>
<td>Name for this key</td>
</tr>
<tr>
<td>fingerprint</td>
<td>String</td>
<td>Key fingerprint</td>
</tr>
<tr>
<td>key</td>
<td>String</td>
<td>OpenSSH formatted public key</td>
</tr>
<tr>
<td>attested</td>
<td>Boolean</td>
<td>Indicates if the key has a hardware device attestation</td>
</tr>
<tr>
<td>multifactor</td>
<td>Array[String]</td>
<td>Lists any additional factors required to use (if attested)</td>
</tr>
</tbody>
</table>
<p>Possible <code>multifactor</code> values:</p>
<table>
<thead>
<tr>
<th><strong>Value</strong></th>
<th><strong>Meaning</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>pin</td>
<td>Input of a PIN or password is required for key use</td>
</tr>
<tr>
<td>touch</td>
<td>Touch input (not authenticated -- i.e. not a fingerprint) is required for key use</td>
</tr>
</tbody>
</table>
<h3 id="errors_3">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> or <code>:key</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_3">CLI Command</h3>
<pre><code>$ triton key get barbar
</code></pre>
<p>or</p>
<pre><code>$ sdc-getkey barbar
</code></pre>
<h3 id="example-request_3">Example Request</h3>
<pre><code>GET /my/keys/barbar HTTP/1.1
Authorization: ...
Host: api.example.com
Accept: application/json
Api-Version: ~8
</code></pre>
<h3 id="example-response_3">Example Response</h3>
<pre><code>HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 830
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: GET, HEAD, DELETE
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Content-MD5: p8gjrCZqMiZbD15TA9ymEQ==
Date: Tue, 22 Dec 2015 13:26:17 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: 94423be0-a8af-11e5-a95f-e74285cfeb5b
Response-Time: 999

{
  "name": "barbar",
  "fingerprint": "03:7f:8e:ef:da:3d:3b:9e:a4:82:67:71:8c:35:2c:aa",
  "key": "&lt;...&gt;",
  "attested": true,
  "multifactor": ["pin"]
}
</code></pre>
<h2 id="createkey-post-loginkeys">CreateKey (POST /:login/keys)</h2>
<p>Uploads a new OpenSSH key to Triton for use in HTTP signing and SSH.</p>
<h3 id="inputs_4">Inputs</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>String</td>
<td>Name for this key (optional)</td>
</tr>
<tr>
<td>key</td>
<td>String</td>
<td>OpenSSH formatted public key</td>
</tr>
<tr>
<td>attestation</td>
<td>Array of String</td>
<td>PEM formatted attestation certificates</td>
</tr>
</tbody>
</table>
<h3 id="returns_4">Returns</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>String</td>
<td>Name for this key</td>
</tr>
<tr>
<td>fingerprint</td>
<td>String</td>
<td>Key fingerprint</td>
</tr>
<tr>
<td>key</td>
<td>String</td>
<td>OpenSSH formatted public key</td>
</tr>
<tr>
<td>attested</td>
<td>Boolean</td>
<td>Indicates if the key has a hardware device attestation</td>
</tr>
<tr>
<td>multifactor</td>
<td>Array[String]</td>
<td>Lists any additional factors required to use (if attested)</td>
</tr>
</tbody>
</table>
<h3 id="errors_4">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>InvalidArgument</td>
<td>If name or key is invalid (usually key)</td>
</tr>
<tr>
<td>MissingParameter</td>
<td>If you didn't send a key</td>
</tr>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_4">CLI Command</h3>
<pre><code>$ triton key add --name=barbardos ~/.ssh/id_rsa.pub
</code></pre>
<p>or</p>
<pre><code>$ sdc-createkey --name=barbardos ~/.ssh/id_rsa.pub
</code></pre>
<h3 id="example-request_4">Example Request</h3>
<pre><code>POST /my/keys HTTP/1.1
Authorization: ...
Host: api.example.com
Accept: application/json
Content-Length: 455
Content-Type: application/json
Api-Version: ~8

{
  "name": "barbardos",
  "fingerprint": "03:7f:8e:ef:da:3d:3b:9e:a4:82:67:71:8c:35:2c:aa",
  "key": "ssh-rsa AAA..."
}
</code></pre>
<h3 id="example-response_4">Example Response</h3>
<pre><code>HTTP/1.1 201 Created
Content-Type: application/json
Content-Length: 830
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: GET, HEAD, DELETE
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Content-MD5: p8gjrCZqMiZbD15TA9ymEQ==
Date: Tue, 22 Dec 2015 13:26:17 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: 94423be0-a8af-11e5-a95f-e74285cfeb5b
Response-Time: 999

{
  "name": "barbardos",
  "fingerprint": "03:7f:8e:ef:da:3d:3b:9e:a4:82:67:71:8c:35:2c:aa",
  "key": "&lt;...&gt;"
}
</code></pre>
<h2 id="deletekey-delete-loginkeyskey">DeleteKey (DELETE /:login/keys/:key)</h2>
<p>Deletes a single SSH key, by name or fingerprint.</p>
<h3 id="inputs_5">Inputs</h3>
<ul>
<li>None</li>
</ul>
<h3 id="returns_5">Returns</h3>
<ul>
<li>None</li>
</ul>
<h3 id="errors_5">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> or <code>:key</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_5">CLI Command</h3>
<pre><code>$ triton key delete barbados
</code></pre>
<p>or</p>
<pre><code>$ sdc-deletekey barbados
</code></pre>
<h4 id="example-request_5">Example Request</h4>
<pre><code>DELETE /my/keys/barbardos HTTP/1.1
Host: api.example.com
Accept: application/json
Api-Version: ~8
Content-Length: 0
</code></pre>
<h4 id="example-response_5">Example Response</h4>
<pre><code>HTTP/1.1 204 No Content
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: GET, HEAD, DELETE
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Date: Tue, 22 Dec 2015 13:31:43 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: 5677a420-a8b0-11e5-8702-0daf2c627de5
Response-Time: 829
</code></pre>
<h1 id="users">Users</h1>
<p>These are users (also known as sub-users); additional users who are authorized
to use the same account, but are subject to the RBAC system. See the
<a href="#rbac-users-roles-policies">RBAC</a> section for more details.</p>
<h2 id="listusers-get-accountusers">ListUsers (GET /:account/users)</h2>
<p>Returns a list of an account's user objects.  These have the same format as the
main <a href="#account">account</a> object.</p>
<h3 id="inputs_6">Inputs</h3>
<ul>
<li>None</li>
</ul>
<h3 id="returns_6">Returns</h3>
<p>Array of user objects.  Each user object has the following fields:</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>Unique id for this user</td>
</tr>
<tr>
<td>login</td>
<td>String</td>
<td>Sub-user login name</td>
</tr>
<tr>
<td>email</td>
<td>String</td>
<td>Email address</td>
</tr>
<tr>
<td>companyName</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>firstName</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>lastName</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>address</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>postalCode</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>city</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>state</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>country</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>phone</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>created</td>
<td>ISO8601 date</td>
<td>When this user was created</td>
</tr>
<tr>
<td>updated</td>
<td>ISO8601 date</td>
<td>When this user's details was last updated</td>
</tr>
</tbody>
</table>
<h3 id="errors_6">Errors</h3>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:account</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_6">CLI Command:</h3>
<pre><code>$ sdc-user list
</code></pre>
<h3 id="example-request_6">Example Request</h3>
<pre><code>GET /my/users HTTP/1.1
Accept: application/json
Host: api.example.com
Api-Version: ~8
Authorization: Signature keyId...
</code></pre>
<h3 id="example-response_6">Example Response</h3>
<pre><code>HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 503
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: POST, GET, HEAD
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Content-MD5: 6csVzj9aNZWB5/ZW9JsD8w==
Date: Wed, 23 Dec 2015 06:42:20 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: 50182970-a940-11e5-af28-0b661ec813b9
Response-Time: 1051

[
  {
    "id": "4fc13ac6-1e7d-cd79-f3d2-96276af0d638",
    "login": "barbar",
    "email": "barbar@example.com",
    "companyName": "Example",
    "firstName": "BarBar",
    "lastName": "Jinks",
    "phone": "(123)457-6890",
    "updated": "2015-12-23T06:41:11.032Z",
    "created": "2015-12-23T06:41:11.032Z"
  },
  {
    "id": "332ce629-fcc5-45c3-e34f-e7cfbeab1327",
    "login": "san",
    "email": "san@example.com",
    "companyName": "Example Inc",
    "firstName": "San",
    "lastName": "Holo",
    "phone": "(123)456-0987",
    "updated": "2015-12-23T06:41:56.102Z",
    "created": "2015-12-23T06:41:56.102Z"
  }
]
</code></pre>
<h2 id="getuser-get-accountusersuser">GetUser (GET /:account/users/:user)</h2>
<p>Get one user for an account.</p>
<h3 id="inputs_7">Inputs</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>membership</td>
<td>Boolean</td>
<td>When given, the user roles will also be returned</td>
</tr>
</tbody>
</table>
<h3 id="returns_7">Returns</h3>
<p>An array of user objects.  Each user object has the following fields:</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>Unique id for this user</td>
</tr>
<tr>
<td>login</td>
<td>String</td>
<td>Sub-user login name</td>
</tr>
<tr>
<td>email</td>
<td>String</td>
<td>Email address</td>
</tr>
<tr>
<td>companyName</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>firstName</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>lastName</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>address</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>postalCode</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>city</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>state</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>country</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>phone</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>roles</td>
<td>Array</td>
<td>User role names (only when <code>membership</code> option is present in request)</td>
</tr>
<tr>
<td>default_roles</td>
<td>Array</td>
<td>User active role names (only when <code>membership</code> option is present in request)</td>
</tr>
<tr>
<td>created</td>
<td>ISO8601 date</td>
<td>When this user was created</td>
</tr>
<tr>
<td>updated</td>
<td>ISO8601 date</td>
<td>When this user's details was last updated</td>
</tr>
</tbody>
</table>
<h3 id="errors_7">Errors</h3>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>When <code>:account</code> or <code>:user</code> do not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_7">CLI Command:</h3>
<pre><code>$ sdc-user get 4fc13ac6-1e7d-cd79-f3d2-96276af0d638
</code></pre>
<h3 id="example-request_7">Example Request</h3>
<pre><code>GET /my/users/4fc13ac6-1e7d-cd79-f3d2-96276af0d638 HTTP/1.1
Accept: application/json
Host: api.example.com
Api-Version: ~8
Authorization: Signature keyId...
</code></pre>
<h3 id="example-response_7">Example Response</h3>
<pre><code>HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 253
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: GET, HEAD, POST, DELETE
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Content-MD5: p4/N2pQwLkNuvKTjaKJPOw==
Date: Wed, 23 Dec 2015 07:07:44 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: dc761fa0-a943-11e5-842f-87950f2a2edd
Response-Time: 961

{
  "id": "4fc13ac6-1e7d-cd79-f3d2-96276af0d638",
  "login": "barbar",
  "email": "barbar@example.com",
  "companyName": "Example",
  "firstName": "BarBar",
  "lastName": "Jinks",
  "phone": "(123)457-6890",
  "updated": "2015-12-23T06:41:11.032Z",
  "created": "2015-12-23T06:41:11.032Z"
}
</code></pre>
<h2 id="createuser-post-accountusers">CreateUser (POST /:account/users)</h2>
<p>Creates a new user under an account.</p>
<h3 id="inputs_8">Inputs</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>email</td>
<td>String</td>
<td>(Required) Email address</td>
</tr>
<tr>
<td>login</td>
<td>String</td>
<td>(Required) Login</td>
</tr>
<tr>
<td>password</td>
<td>String</td>
<td>(Required) Password</td>
</tr>
<tr>
<td>companyName</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>firstName</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>lastName</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>address</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>postalCode</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>city</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>state</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>country</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>phone</td>
<td>String</td>
<td>...</td>
</tr>
</tbody>
</table>
<h3 id="returns_8">Returns</h3>
<p>User object:</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>Unique id for this user</td>
</tr>
<tr>
<td>login</td>
<td>String</td>
<td>Sub-user <code>login</code> name</td>
</tr>
<tr>
<td>email</td>
<td>String</td>
<td>Email address</td>
</tr>
<tr>
<td>companyName</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>firstName</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>lastName</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>address</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>postalCode</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>city</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>state</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>country</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>phone</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>created</td>
<td>ISO8601 date</td>
<td>When this user was created</td>
</tr>
<tr>
<td>updated</td>
<td>ISO8601 date</td>
<td>When this user's details was last updated</td>
</tr>
</tbody>
</table>
<h3 id="errors_8">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>InvalidArgument</td>
<td>If any of the parameters are invalid, e.g. you try to add a login name already taken by another user of your account</td>
</tr>
<tr>
<td>MissingParameter</td>
<td>If you didn't send a <code>login</code>, <code>email</code> or <code>password</code></td>
</tr>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:account</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_8">CLI Command:</h3>
<pre><code>$ sdc-user create --login=bob --email=bob@test.joyent.com --password=123secret
</code></pre>
<h3 id="request">Request:</h3>
<pre><code>POST /my/users HTTP/1.1
Host: api.example.com
accept: application/json
content-type: application/json
user-agent: restify/2.6.1 (x64-darwin; v8/3.14.5.9; OpenSSL/1.0.1e) node/0.10.26
accept-version: *
date: Thu, 01 May 2014 15:35:21 GMT
content-length: 79
content-md5: E9EmDJjKXMfIsi2mKbwoZA==

{
  "login": "varth",
  "email": "varth@example.com",
  "password": "123secret"
}
</code></pre>
<h3 id="response">Response:</h3>
<pre><code>HTTP/1.1 201 Created
Location: /my/users/varth
Content-Type: application/json
Content-Length: 163
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: POST, GET, HEAD
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Content-MD5: qC9LnijSqZ1I+zea5GQXvQ==
Date: Wed, 23 Dec 2015 09:42:36 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: 7f1193b0-a959-11e5-9cdd-eb0b10bce309
Response-Time: 1229

{
  "id": "b5c9cf06-b7de-4c11-9b66-8ace6cb92ee8",
  "login": "varth",
  "email": "varth@example.com",
  "updated": "2015-12-23T09:42:36.517Z",
  "created": "2015-12-23T09:42:36.517Z"
}
</code></pre>
<h2 id="updateuser-post-accountusersid">UpdateUser (POST /:account/users/:id)</h2>
<p>Update a user's modifiable properties.</p>
<p>Note: Password changes are not allowed using this endpoint; there is an
additional endpoint (<a href="ChangeUserPassword">ChangeUserPassword</a>) for password
changes so it can be selectively allowed/disallowed for users using policies.</p>
<h3 id="inputs_9">Inputs</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>login</td>
<td>String</td>
<td></td>
</tr>
<tr>
<td>email</td>
<td>String</td>
<td></td>
</tr>
<tr>
<td>companyName</td>
<td>String</td>
<td></td>
</tr>
<tr>
<td>firstName</td>
<td>String</td>
<td></td>
</tr>
<tr>
<td>lastName</td>
<td>String</td>
<td></td>
</tr>
<tr>
<td>address</td>
<td>String</td>
<td></td>
</tr>
<tr>
<td>postalCode</td>
<td>String</td>
<td></td>
</tr>
<tr>
<td>city</td>
<td>String</td>
<td></td>
</tr>
<tr>
<td>state</td>
<td>String</td>
<td></td>
</tr>
<tr>
<td>country</td>
<td>String</td>
<td></td>
</tr>
<tr>
<td>phone</td>
<td>String</td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="returns_9">Returns</h3>
<p>User object:</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>Unique id for this user</td>
</tr>
<tr>
<td>login</td>
<td>String</td>
<td>User login name</td>
</tr>
<tr>
<td>email</td>
<td>String</td>
<td>Email address</td>
</tr>
<tr>
<td>companyName</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>firstName</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>lastName</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>address</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>postalCode</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>city</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>state</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>country</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>phone</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>created</td>
<td>ISO8601 date</td>
<td>When this user was created</td>
</tr>
<tr>
<td>updated</td>
<td>ISO8601 date</td>
<td>When this user's details was last updated</td>
</tr>
</tbody>
</table>
<h3 id="errors_9">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>InvalidArgument</td>
<td>If any of the parameters are invalid, e.g. you try to add a <code>login</code> name already taken by another user of your account</td>
</tr>
<tr>
<td>MissingParameter</td>
<td>If you didn't send a <code>login</code> or <code>email</code></td>
</tr>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:account</code> or <code>:user</code> do not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_9">CLI Command:</h3>
<pre><code>$ sdc-user update b5c9cf06-b7de-4c11-9b66-8ace6cb92ee8 --login=joe
</code></pre>
<h3 id="request_1">Request:</h3>
<pre><code>POST /my/users/b5c9cf06-b7de-4c11-9b66-8ace6cb92ee8 HTTP/1.1
Host: api.example.com
Api-Version: ~8
accept: application/json
content-type: application/json
user-agent: restify/2.6.1 (x64-darwin; v8/3.14.5.9; OpenSSL/1.0.1e) node/0.10.26
date: Thu, 24 Dec 2015 10:30:44 GMT
content-length: 79
content-md5: E9EmDJjKXMfIsi2mKbwoZA==

{
  "login": "joe",
}
</code></pre>
<h3 id="response_1">Response:</h3>
<pre><code>HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 161
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: GET, HEAD, POST, DELETE
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Content-MD5: 4Sn7xQHfoc1+LvLkA2KbNA==
Date: Thu, 24 Dec 2015 10:30:45 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: 63a27380-aa29-11e5-ace8-d79496f2469d
Response-Time: 1148

{
  "id": "b5c9cf06-b7de-4c11-9b66-8ace6cb92ee8",
  "login": "joe",
  "email": "varth@example.com",
  "updated": "2015-12-24T10:28:59.634Z",
  "created": "2015-12-23T09:42:36.517Z"
}
</code></pre>
<h2 id="changeuserpassword-post-accountusersuserchange_password">ChangeUserPassword (POST /:account/users/:user/change_password)</h2>
<p>This is a separate rule for password changes, so different policies can be used
for an user trying to modify other data, or only their own password.</p>
<h3 id="inputs_10">Inputs</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>password</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>password_confirmation</td>
<td>String</td>
<td>string must match <code>password</code></td>
</tr>
</tbody>
</table>
<h3 id="returns_10">Returns</h3>
<p>User object:</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>Unique id for the user</td>
</tr>
<tr>
<td>login</td>
<td>String</td>
<td>User login name</td>
</tr>
<tr>
<td>email</td>
<td>String</td>
<td>Email address</td>
</tr>
<tr>
<td>companyName</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>firstName</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>lastName</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>address</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>postalCode</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>city</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>state</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>country</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>phone</td>
<td>String</td>
<td>...</td>
</tr>
<tr>
<td>created</td>
<td>Date (ISO8601)</td>
<td>When this user was created</td>
</tr>
<tr>
<td>updated</td>
<td>Date (ISO8601)</td>
<td>When this user's details was last updated</td>
</tr>
</tbody>
</table>
<h3 id="errors_10">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>InvalidArgument</td>
<td>The provided <code>password</code> and <code>password\_confirmation</code> didn't match</td>
</tr>
<tr>
<td>MissingParameter</td>
<td>Either <code>password</code> or <code>password\_confirmation</code> parameters are missing</td>
</tr>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:account</code> or <code>:user</code> do not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_10">CLI Command:</h3>
<pre><code>$ sdc-user change-password b5c9cf06-b7de-4c11-9b66-8ace6cb92ee8 --password=foo123bar --password-confirmation=foo123bar
</code></pre>
<h3 id="example-request_8">Example Request</h3>
<pre><code>POST /my/users/b5c9cf06-b7de-4c11-9b66-8ace6cb92ee8/change_password HTTP/1.1
Accept: application/json
Content-Type: application/json
Host: api.example.com
Api-Version: ~8
Content-Length: 40
Authorization: Signature keyId...

{
    "password": "foo123bar",
    "password_confirmation": "foo123bar"
}
</code></pre>
<h3 id="example-response_8">Example Response</h3>
<pre><code>HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 161
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: POST
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Content-MD5: qU6CaBlWpuehWaj0IdtPCw==
Date: Thu, 24 Dec 2015 10:34:51 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: f6338220-aa29-11e5-8484-a9b10ef4e687
Response-Time: 1297

{
  "id": "b5c9cf06-b7de-4c11-9b66-8ace6cb92ee8",
  "login": "joe",
  "email": "varth@example.com",
  "updated": "2015-12-24T10:34:51.790Z",
  "created": "2015-12-23T09:42:36.517Z"
}
</code></pre>
<h2 id="deleteuser-delete-accountusersuser">DeleteUser (DELETE /:account/users/:user)</h2>
<p>Remove a user. They will no longer be able to use this API.</p>
<h3 id="inputs_11">Inputs</h3>
<ul>
<li>None</li>
</ul>
<h3 id="returns_11">Returns</h3>
<ul>
<li>None</li>
</ul>
<h3 id="errors_11">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:account</code> does not exist or there isn't a user with either the <code>login</code> or <code>id</code> given as <code>:user</code> value</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_11">CLI Command:</h3>
<pre><code>$ sdc-user delete b5c9cf06-b7de-4c11-9b66-8ace6cb92ee8
</code></pre>
<h4 id="example-request_9">Example Request</h4>
<pre><code>DELETE /my/users/b5c9cf06-b7de-4c11-9b66-8ace6cb92ee8 HTTP/1.1
Host: api.example.com
Accept: application/json
Api-Version: ~8
Content-Length: 0
</code></pre>
<h4 id="example-response_9">Example Response</h4>
<pre><code>HTTP/1.1 204 No Content
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: GET, HEAD, POST, DELETE
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Date: Thu, 24 Dec 2015 10:36:18 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: 29bcb710-aa2a-11e5-b9f6-05ee86f81e61
Response-Time: 997
</code></pre>
<h1 id="roles">Roles</h1>
<p>Roles a sub-users can adopt when attempting to access a resource. See the
<a href="#rbac-users-roles-policies">RBAC</a> section for more details.</p>
<h2 id="listroles-get-accountroles">ListRoles (GET /:account/roles)</h2>
<p>Returns an array of account roles.</p>
<h3 id="inputs_12">Inputs</h3>
<ul>
<li>None</li>
</ul>
<h3 id="returns_12">Returns</h3>
<p>Array of role objects.  Each role object has the following fields:</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>Unique id for this role</td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td>The role name</td>
</tr>
<tr>
<td>policies</td>
<td>Array</td>
<td>This account's policies which this role obeys (Optional)</td>
</tr>
<tr>
<td>members</td>
<td>Array</td>
<td>This account's users this role applies to (Optional)</td>
</tr>
</tbody>
</table>
<p>The <code>policies</code> Array contains objects with the following fields:</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>Unique id for this policy</td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td>The policy name</td>
</tr>
</tbody>
</table>
<p>The <code>members</code> Array contains objects with the following fields:</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>type</td>
<td>String</td>
<td>Either <code>"subuser"</code> or <code>"account"</code></td>
</tr>
<tr>
<td>id</td>
<td>UUID</td>
<td>Unique id for this user</td>
</tr>
<tr>
<td>login</td>
<td>String</td>
<td>Login name of this user</td>
</tr>
<tr>
<td>default</td>
<td>Boolean</td>
<td>If <code>true</code>, the user is a default member of the role</td>
</tr>
</tbody>
</table>
<h3 id="errors_12">Errors</h3>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:account</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_12">CLI Command:</h3>
<pre><code>$ sdc-role list
</code></pre>
<h3 id="example-request_10">Example Request</h3>
<pre><code>GET /my/roles HTTP/1.1
Accept: application/json
Content-Type: application/json
Host: api.example.com
Accept-Version: ~9
Authorization: Signature keyId...
</code></pre>
<h3 id="example-response_10">Example Response</h3>
<pre><code>HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 136
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: POST, GET, HEAD
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Content-MD5: cxF+Tamx+GkSloXKYHvX/Q==
Date: Tue, 19 Jan 2016 10:54:05 GMT
Server: cloudapi/9.0.0
Api-Version: 9.0.0
Request-Id: f2a9bf40-be9a-11e5-820f-3bf7c01a78db
Response-Time: 4086

[
  {
    "name": "readable",
    "id": "e53b8fec-e661-4ded-a21e-959c9ba08cb2",
    "members": [
      {
        "type": "subuser",
        "id": "267c1fa9-8247-4860-8b95-61ba6d5a5fb5",
        "login": "foo",
        "default": true
      }
    ],
    "policies": [
      {
        "id": "92914b4f-79bf-4664-bc3b-b6dbb424263f",
        "name": "readinstance"
      }
    ]
  }
]
</code></pre>
<h2 id="getrole-get-accountrolesrole">GetRole (GET /:account/roles/:role)</h2>
<p>Get an account role (<code>:role</code>) by <code>id</code> or <code>name</code>.</p>
<h3 id="inputs_13">Inputs</h3>
<ul>
<li>None</li>
</ul>
<h3 id="returns_13">Returns</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>Unique id for this role</td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td>The role name</td>
</tr>
<tr>
<td>policies</td>
<td>Array</td>
<td>This account's policies which this role obeys (Optional)</td>
</tr>
<tr>
<td>members</td>
<td>Array</td>
<td>This account's users this role applies to (Optional)</td>
</tr>
</tbody>
</table>
<p>The <code>policies</code> Array contains objects with the following fields:</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>Unique id for this policy</td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td>The policy name</td>
</tr>
</tbody>
</table>
<p>The <code>members</code> Array contains objects with the following fields:</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>type</td>
<td>String</td>
<td>Either <code>"subuser"</code> or <code>"account"</code></td>
</tr>
<tr>
<td>id</td>
<td>UUID</td>
<td>Unique id for this user</td>
</tr>
<tr>
<td>login</td>
<td>String</td>
<td>Login name of this user</td>
</tr>
<tr>
<td>default</td>
<td>Boolean</td>
<td>If <code>true</code>, the user is a default member of the role</td>
</tr>
</tbody>
</table>
<h3 id="errors_13">Errors</h3>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:account</code> or <code>:role</code> do not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_13">CLI Command:</h3>
<pre><code>$ sdc-role get e53b8fec-e661-4ded-a21e-959c9ba08cb2
</code></pre>
<h3 id="example-request_11">Example Request</h3>
<pre><code>GET /my/roles/e53b8fec-e661-4ded-a21e-959c9ba08cb2 HTTP/1.1
Accept: application/json
Content-Type: application/json
Host: api.example.com
Accept-Version: ~9
Authorization: Signature keyId...
</code></pre>
<h3 id="example-response_11">Example Response</h3>
<pre><code>HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 134
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: GET, HEAD, POST, DELETE
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Content-MD5: Sr2lbN/2Jhl7q1VsGV63xg==
Date: Tue, 19 Jan 2016 11:00:08 GMT
Server: cloudapi/9.0.0
Api-Version: 9.0.0
Request-Id: cd193de0-be9b-11e5-b9fe-8768cab09198
Response-Time: 1268

{
  "name": "readable",
  "id": "e53b8fec-e661-4ded-a21e-959c9ba08cb2",
  "members": [
    {
      "type": "subuser",
      "id": "267c1fa9-8247-4860-8b95-61ba6d5a5fb5",
      "login": "foo",
      "default": true
    }
  ],
  "policies": [
    {
      "id": "92914b4f-79bf-4664-bc3b-b6dbb424263f",
      "name": "readinstance"
    }
  ]
}
</code></pre>
<h2 id="createrole-post-accountroles">CreateRole (POST /:account/roles)</h2>
<p>Create a new role for your account.</p>
<h3 id="inputs_14">Inputs</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>String</td>
<td>The role's name</td>
</tr>
<tr>
<td>policies</td>
<td>Array</td>
<td>This account's policies to be given to this role (Optional)</td>
</tr>
<tr>
<td>members</td>
<td>Array</td>
<td>This account's user logins to be added to this role (Optional)</td>
</tr>
</tbody>
</table>
<p>The <code>policies</code> Array contains objects with the following fields (either <code>id</code> or
<code>name</code> is required, both may be supplied but if so only <code>id</code> will be used):</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>Unique id for this policy (either id or name required)</td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td>The policy name (either id or name required)</td>
</tr>
</tbody>
</table>
<p>The <code>members</code> Array contains objects with the following fields (either <code>id</code> or
<code>login</code> is required, both may be supplied but if so only <code>id</code> will be used):</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>type</td>
<td>String</td>
<td>Either <code>"subuser"</code> or <code>"account"</code></td>
</tr>
<tr>
<td>id</td>
<td>UUID</td>
<td>Unique id for this user (either id or login required)</td>
</tr>
<tr>
<td>login</td>
<td>String</td>
<td>Login name of this user (either id or login required)</td>
</tr>
<tr>
<td>default</td>
<td>Boolean</td>
<td>If <code>true</code>, the user is a default member of the role (Optional)</td>
</tr>
</tbody>
</table>
<h3 id="returns_14">Returns</h3>
<p>Account role.</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>Unique id for this role</td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td>The role name</td>
</tr>
<tr>
<td>policies</td>
<td>Array</td>
<td>This account's policies which this role obeys (Optional)</td>
</tr>
<tr>
<td>members</td>
<td>Array</td>
<td>This account's users this role applies to (Optional)</td>
</tr>
</tbody>
</table>
<h3 id="errors_14">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>InvalidArgument</td>
<td>If member or policies are invalid, e.g. you try to add a non-existent user</td>
</tr>
<tr>
<td>MissingParameter</td>
<td>If you didn't send a <code>name</code></td>
</tr>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:account</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_14">CLI Command:</h3>
<p>Note that the CLI command uses the older v7.x/v8.x API.</p>
<pre><code>$ sdc-role create --name=readable --members=foo --default-members=foo --policies=readinstance
</code></pre>
<p>Possible alternate formats to pass in multiple items; in <code>sdc-role</code>, CSV and
JSON are also acceptable formats for <code>--members</code>, <code>--default-members</code> and
<code>--policies</code>:</p>
<pre><code>$ sdc-role create --name=readable --members=bob,fred --default-members=foo --policies=readinstance
$ sdc-role create --name=readable --members='["bob","fred"]' --default-members=foo --policies=readinstance
</code></pre>
<h3 id="example-request_12">Example Request</h3>
<pre><code>POST /my/roles HTTP/1.1
Accept: application/json
Content-Type: application/json
Host: api.example.com
Accept-Version: ~9
Content-Length: 40
Authorization: Signature keyId...

{
    "name": "readable",
    "members": [{"type": "subuser", "login": "foo", "default": true}],
    "policies": [{"name": "readinstance"}]
}
</code></pre>
<h3 id="example-response_12">Example Response</h3>
<pre><code>HTTP/1.1 201 Created
Location: /my/roles/e53b8fec-e661-4ded-a21e-959c9ba08cb2
Content-Type: application/json
Content-Length: 135
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: POST, GET, HEAD
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Content-MD5: JC584Ys8XLt9OsqeKzFGRA==
Date: Tue, 19 Jan 2016 11:49:25 GMT
Server: cloudapi/9.0.0
Api-Version: 9.0.0
Request-Id: af9adf10-bea2-11e5-820f-3bf7c01a78db
Response-Time: 1017

{
  "name": "readable",
  "id": "e53b8fec-e661-4ded-a21e-959c9ba08cb2",
  "members": [
    {
      "type": "subuser",
      "id": "267c1fa9-8247-4860-8b95-61ba6d5a5fb5",
      "login": "foo",
      "default": true
    }
  ],
  "policies": [
    {
      "id": "7bde94da-e279-4c74-86bc-1b0b046f7fc4",
      "name": "readinstance"
    }
  ]
}
</code></pre>
<h2 id="updaterole-post-accountrolesrole">UpdateRole (POST /:account/roles/:role)</h2>
<p>Modifies an account role.  Anything but <code>id</code> can be modified.</p>
<h3 id="inputs_15">Inputs</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>String</td>
<td>The role's name</td>
</tr>
<tr>
<td>policies</td>
<td>Array</td>
<td>This account's policies to be given to this role (Optional)</td>
</tr>
<tr>
<td>members</td>
<td>Array</td>
<td>This account's users to be added to this role (Optional)</td>
</tr>
</tbody>
</table>
<p>The <code>policies</code> Array contains objects with the following fields (either <code>id</code> or
<code>name</code> is required, both may be supplied but if so only <code>id</code> will be used):</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>Unique id for this policy (either id or name required)</td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td>The policy name (either id or name required)</td>
</tr>
</tbody>
</table>
<p>The <code>members</code> Array contains objects with the following fields (either <code>id</code> or
<code>login</code> is required, both may be supplied but if so only <code>id</code> will be used):</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>type</td>
<td>String</td>
<td>Either <code>"subuser"</code> or <code>"account"</code></td>
</tr>
<tr>
<td>id</td>
<td>UUID</td>
<td>Unique id for this user (either id or login required)</td>
</tr>
<tr>
<td>login</td>
<td>String</td>
<td>Login name of this user (either id or login required)</td>
</tr>
<tr>
<td>default</td>
<td>Boolean</td>
<td>If <code>true</code>, the user is a default member of the role (Optional)</td>
</tr>
</tbody>
</table>
<h3 id="returns_15">Returns</h3>
<p>Account role</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>Unique id for this role</td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td>The role name</td>
</tr>
<tr>
<td>policies</td>
<td>Array</td>
<td>This account's policies which this role obeys (Optional)</td>
</tr>
<tr>
<td>members</td>
<td>Array</td>
<td>This account's users this role applies to (Optional)</td>
</tr>
</tbody>
</table>
<h3 id="errors_15">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>InvalidArgument</td>
<td>If member or policies are invalid, e.g. you tried to add an non-existent user</td>
</tr>
<tr>
<td>MissingParameter</td>
<td>If you didn't send a <code>name</code></td>
</tr>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:account</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_15">CLI Command:</h3>
<pre><code>$ sdc-role update e53b8fec-e661-4ded-a21e-959c9ba08cb2 --members=foo,bar
</code></pre>
<h3 id="example-request_13">Example Request</h3>
<pre><code>POST /my/roles/e53b8fec-e661-4ded-a21e-959c9ba08cb2 HTTP/1.1
Accept: application/json
Content-Type: application/json
Host: api.example.com
Api-Version: ~9
Content-Length: 40
Authorization: Signature keyId...

{
    "members": [
      {"type": "subuser", "login": "foo", "default": true},
      {"type": "subuser", "login": "bar"}
    ]
}
</code></pre>
<h3 id="example-response_13">Example Response</h3>
<pre><code>HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 134
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: GET, HEAD, POST, DELETE
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Content-MD5: Sr2lbN/2Jhl7q1VsGV63xg==
Date: Tue, 19 Jan 2016 13:31:13 GMT
Server: cloudapi/9.0.0
Api-Version: 9.0.0
Request-Id: e8534140-beb0-11e5-b819-3f29fab5fc3a
Response-Time: 1310

{
  "name": "readable",
  "id": "e53b8fec-e661-4ded-a21e-959c9ba08cb2",
  "members": [
    {
      "type": "subuser",
      "id": "267c1fa9-8247-4860-8b95-61ba6d5a5fb5",
      "login": "foo",
      "default": true
    },
    {
      "type": "subuser",
      "id": "383a466a-be93-4664-9625-a876ff655c4c",
      "login": "bar",
      "default": false
    }
  ],
  "policies": [
    {
      "id": "7bde94da-e279-4c74-86bc-1b0b046f7fc4",
      "name": "readinstance"
    }
  ]
}
</code></pre>
<h2 id="deleterole-delete-accountrolesrole">DeleteRole (DELETE /:account/roles/:role)</h2>
<p>Remove a role. <code>:role</code> must be the role <code>id</code> (a UUID).</p>
<h3 id="inputs_16">Inputs</h3>
<ul>
<li>None</li>
</ul>
<h3 id="returns_16">Returns</h3>
<ul>
<li>None</li>
</ul>
<h3 id="errors_16">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:account</code> or <code>:role</code> do not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_16">CLI Command:</h3>
<pre><code>$ sdc-role delete e53b8fec-e661-4ded-a21e-959c9ba08cb2
</code></pre>
<h4 id="example-request_14">Example Request</h4>
<pre><code>DELETE /my/roles/e53b8fec-e661-4ded-a21e-959c9ba08cb2 HTTP/1.1
Host: api.example.com
Accept: application/json
Api-Version: ~8
Content-Length: 0
</code></pre>
<h4 id="example-response_14">Example Response</h4>
<pre><code>HTTP/1.1 204 No Content
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: GET, HEAD, POST, DELETE
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Date: Tue, 19 Jan 2016 13:33:33 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: 3b6aec20-beb1-11e5-820f-3bf7c01a78db
Response-Time: 1095
</code></pre>
<h1 id="role-tags">Role Tags</h1>
<h2 id="setroletags-put-resource_path">SetRoleTags (PUT /:resource_path)</h2>
<p>Sets the given role tags to the provided resource path. <code>resource_path</code>
can be the path to any of the CloudAPI resources described in this document:
account, keys, users, roles, policies, user's ssh keys, datacenters, images,
packages, instances, firewall rules and networks.</p>
<p>For each of these you can set role tags either for an individual resource or
for the whole group; i.e., you can set role tags for all the instances using:</p>
<pre><code>PUT /:account/machines
</code></pre>
<p>or just for a given instance using</p>
<pre><code>PUT /:account/machines/:instance_id
</code></pre>
<h3 id="inputs_17">Inputs</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>role-tag</td>
<td>Array</td>
<td>The list role-tags to be added to this resource</td>
</tr>
</tbody>
</table>
<h3 id="returns_17">Returns</h3>
<p>Resource role tags</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>String</td>
<td>Path to the resource</td>
</tr>
<tr>
<td>role-tag</td>
<td>Array</td>
<td>The list of role tags assigned to this resource</td>
</tr>
</tbody>
</table>
<h3 id="errors_17">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>InvalidArgument</td>
<td>The provided resource path is not valid</td>
</tr>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:resource_path</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_17">CLI Command:</h3>
<pre><code>$ sdc-chmod -- =read,create /my/machines
</code></pre>
<p>The list of role-tags assigned to a given resource can be obtained from the
command line with <code>sdc-info /:resource_path</code>. E.g.:</p>
<pre><code>$ sdc-info /my/machines
</code></pre>
<h3 id="example-request_15">Example Request</h3>
<pre><code>PUT /my/machines HTTP/1.1
Accept: application/json
Content-Type: application/json
Host: api.example.com
Api-Version: ~8
content-length: 26
content-md5: KwJKP+w/roeR+pRgKTMo7w==
Authorization: Signature keyId...

{
    "role-tag": ["test-role"]
}
</code></pre>
<h3 id="example-response_15">Example Response</h3>
<pre><code>HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 76
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: PUT
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Content-MD5: glSyrrDK7km8e0oHkK8MFQ==
Date: Tue, 19 Jan 2016 13:31:01 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: e0ec6b20-beb0-11e5-bb37-b3b95e8d52c8
Response-Time: 1108

{
  "name": "/my/machines",
  "role-tag": [
    "test-role"
  ]
}
</code></pre>
<h1 id="policies">Policies</h1>
<h2 id="listpolicies-get-accountpolicies">ListPolicies (GET /:account/policies)</h2>
<p>Retrieves a list of account policies.</p>
<h3 id="inputs_18">Inputs</h3>
<ul>
<li>None</li>
</ul>
<h3 id="returns_18">Returns</h3>
<p>Array of policy objects.  Each policy object has the following fields:</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>Unique id for this policy</td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td>The policy name</td>
</tr>
<tr>
<td>rules</td>
<td>Array</td>
<td>One or more Aperture sentences applying to the policy</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>A description for this policy</td>
</tr>
</tbody>
</table>
<h3 id="errors_18">Errors</h3>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:account</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_18">CLI Command:</h3>
<pre><code>$ sdc-policy list
</code></pre>
<h3 id="example-request_16">Example Request</h3>
<pre><code>GET /my/policies HTTP/1.1
Accept: application/json
Content-Type: application/json
Host: api.example.com
Api-Version: ~8
Authorization: Signature keyId...
</code></pre>
<h3 id="example-response_16">Example Response</h3>
<pre><code>HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 111
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: POST, GET, HEAD
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Content-MD5: KIok0p7Vj1ywnmKotC0dxw==
Date: Wed, 20 Jan 2016 10:27:01 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: 56d4a410-bf60-11e5-8d8f-d9c2edd19b69
Response-Time: 1539

[
  {
    "name": "readinstance",
    "id": "95ca7b25-5c8f-4c1b-92da-4276f23807f3",
    "rules": [
      "can listmachine and getmachine"
    ]
  }
]
</code></pre>
<h2 id="getpolicy-get-accountpoliciespolicy">GetPolicy (GET /:account/policies/:policy)</h2>
<p>Get an account policy (<code>:policy</code>) by <code>id</code>.</p>
<h3 id="inputs_19">Inputs</h3>
<ul>
<li>None</li>
</ul>
<h3 id="returns_19">Returns</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>Unique id for this policy</td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td>The policy name</td>
</tr>
<tr>
<td>rules</td>
<td>Array</td>
<td>One or more Aperture sentences applying to the policy</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>A description for this policy</td>
</tr>
</tbody>
</table>
<h3 id="errors_19">Errors</h3>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:account</code> or <code>:role</code> do not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_19">CLI Command:</h3>
<pre><code>$ sdc-policy get 95ca7b25-5c8f-4c1b-92da-4276f23807f3
</code></pre>
<h3 id="example-request_17">Example Request</h3>
<pre><code>GET /my/policies/95ca7b25-5c8f-4c1b-92da-4276f23807f3 HTTP/1.1
Accept: application/json
Content-Type: application/json
Host: api.example.com
Api-Version: ~8
Authorization: Signature keyId...
</code></pre>
<h3 id="example-response_17">Example Response</h3>
<pre><code>HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 109
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: GET, HEAD, POST, DELETE
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Content-MD5: aJlIu8bZIl2QvcSBk/OjxQ==
Date: Wed, 20 Jan 2016 10:27:41 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: 6f6517d0-bf60-11e5-9252-e35f55471f16
Response-Time: 684

{
  "name": "readinstance",
  "id": "95ca7b25-5c8f-4c1b-92da-4276f23807f3",
  "rules": [
    "can listmachine and getmachine"
  ]
}
</code></pre>
<h2 id="createpolicy-post-accountpolicies">CreatePolicy (POST /:account/policies)</h2>
<p>Creates a new account policy.</p>
<h3 id="inputs_20">Inputs</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>String</td>
<td>The policy name</td>
</tr>
<tr>
<td>rules</td>
<td>Array</td>
<td>One or more Aperture sentences to be added to the current policy</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>A description for this policy (Optional)</td>
</tr>
</tbody>
</table>
<h3 id="returns_20">Returns</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>Unique id for this policy</td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td>The policy name</td>
</tr>
<tr>
<td>rules</td>
<td>Array</td>
<td>One or more Aperture sentences applying to the policy</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>A description for this policy</td>
</tr>
</tbody>
</table>
<h3 id="errors_20">Errors</h3>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:account</code> or <code>:role</code> do not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_20">CLI Command:</h3>
<pre><code>$ sdc-policy create --name=test-policy --description='Policy to test cmdln tool' --rules='CAN rebootmachine, createmachine AND getmachine' --rules='CAN listkeys AND listuserkeys'
</code></pre>
<h3 id="example-request_18">Example Request</h3>
<pre><code>POST /my/policies HTTP/1.1
Accept: application/json
Content-Type: application/json
Host: api.example.com
Api-Version: ~7.2
Authorization: Signature keyId...


{
    "name": "test-policy",
    "rules": ["can rebootMachine"],
    "description": "can reboot any instance"
}
</code></pre>
<h3 id="example-response_18">Example Response</h3>
<pre><code>HTTP/1.1 201 Created
Location: /my/policies/8700e959-4cb3-4337-8afa-fb0a53b5366e
Content-Type: application/json
Content-Length: 123
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: POST, GET, HEAD
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Content-MD5: U9aAcBqQD9i80axNg4aK9A==
Date: Wed, 20 Jan 2016 10:34:44 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: 6b01c840-bf61-11e5-9252-e35f55471f16
Response-Time: 1116

{
  "name": "test-policy",
  "id": "8700e959-4cb3-4337-8afa-fb0a53b5366e",
  "rules": [
    "can rebootMachine"
  ],
  "description": "can reboot any instance"
}
</code></pre>
<h2 id="updatepolicy-post-accountpoliciespolicy">UpdatePolicy (POST /:account/policies/:policy)</h2>
<p>Upgrades an existing account policy.  Everything but id can be modified.</p>
<h3 id="inputs_21">Inputs</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>String</td>
<td>The policy name</td>
</tr>
<tr>
<td>rules</td>
<td>Array</td>
<td>One or more Aperture sentences to be added to the current policy</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>A description for this policy (Optional)</td>
</tr>
</tbody>
</table>
<h3 id="returns_21">Returns</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>Unique id for this policy</td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td>The policy name</td>
</tr>
<tr>
<td>rules</td>
<td>Array</td>
<td>One or more Aperture sentences applying to the policy</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>A description for this policy</td>
</tr>
</tbody>
</table>
<h3 id="errors_21">Errors</h3>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:account</code> or <code>:role</code> do not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_21">CLI Command:</h3>
<pre><code>$ sdc-policy update 8700e959-4cb3-4337-8afa-fb0a53b5366e --rules='CAN rebootmachine, createmachine AND getmachine' --rules='CAN listkeys AND listuserkeys' --rules='CAN stopmachine, startmachine, renamemachine, enablemachinefirewall AND disablemachinefirewall'
</code></pre>
<h3 id="example-request_19">Example Request</h3>
<pre><code>POST /my/policies/8700e959-4cb3-4337-8afa-fb0a53b5366e HTTP/1.1
Accept: application/json
Content-Type: application/json
Host: api.example.com
Api-Version: ~8
Authorization: Signature keyId...


{
    "description": "Restart any instance, no matter which origin IP"
}
</code></pre>
<h3 id="example-response_19">Example Response</h3>
<pre><code>HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 159
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: GET, HEAD, POST, DELETE
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Content-MD5: V0Ud8w9ChirsRyEm341wQg==
Date: Wed, 20 Jan 2016 11:02:55 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: 5b10fbf0-bf65-11e5-8d2c-33d19d9c4408
Response-Time: 1091

{
  "name": "test-policy",
  "id": "8700e959-4cb3-4337-8afa-fb0a53b5366e",
  "rules": [
    "can rebootMachine"
  ],
  "description": "Restart any instance, no matter which origin IP"
}
</code></pre>
<h2 id="deletepolicy-delete-accountpoliciespolicy">DeletePolicy (DELETE /:account/policies/:policy)</h2>
<p>Delete an RBAC policy. <code>:policy</code> must be the policy <code>id</code> (a UUID).</p>
<h3 id="inputs_22">Inputs</h3>
<ul>
<li>None</li>
</ul>
<h3 id="returns_22">Returns</h3>
<ul>
<li>None</li>
</ul>
<h3 id="errors_22">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:account</code> or <code>:policy</code> do not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_22">CLI Command:</h3>
<pre><code>$ sdc-policy delete 8700e959-4cb3-4337-8afa-fb0a53b5366e
</code></pre>
<h4 id="example-request_20">Example Request</h4>
<pre><code>DELETE /my/policies/8700e959-4cb3-4337-8afa-fb0a53b5366e HTTP/1.1
Host: api.example.com
Accept: application/json
Api-Version: ~8
Authorization: Signature keyId...
Content-Length: 0
</code></pre>
<h4 id="example-response_20">Example Response</h4>
<pre><code>HTTP/1.1 204 No Content
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: GET, HEAD, POST, DELETE
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Date: Wed, 20 Jan 2016 11:04:11 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: 8887ee40-bf65-11e5-a1c5-412a81a23b66
Response-Time: 872
</code></pre>
<h1 id="user-ssh-keys">User SSH Keys</h1>
<p>See account <a href="#keys">keys</a> for a detailed description.  Only difference is the
path from where you can access users' keys:</p>
<h2 id="listuserkeys-get-accountusersuserkeys">ListUserKeys (GET /:account/users/:user/keys)</h2>
<p>Lists all public keys we have on record for the specified account user.
See <a href="#ListKeys">ListKeys</a>.</p>
<h3 id="cli-command_23">CLI Command:</h3>
<pre><code>$ sdc-user keys dd71f8bb-f310-4746-8e36-afd7c6dd2895
</code></pre>
<h2 id="getuserkey-get-accountusersuserkeyskey">GetUserKey (GET /:account/users/:user/keys/:key)</h2>
<p>Retrieves the given key record either by fingerprint or name.
See <a href="#GetKey">GetKey</a>.</p>
<h3 id="cli-command_24">CLI Command:</h3>
<pre><code>$ sdc-user key dd71f8bb-f310-4746-8e36-afd7c6dd2895 '0b:56:ae:c5:d1:7b:7a:98:09:58:1a:a2:0c:22:63:9f'
</code></pre>
<h2 id="createuserkey-post-accountusersuserkeys">CreateUserKey (POST /:account/users/:user/keys)</h2>
<p>Creates a new key record.  See <a href="#CreateKey">CreateKey</a>.</p>
<h3 id="cli-command_25">CLI Command:</h3>
<pre><code>$ sdc-user upload-key -n test 93c3d419-a927-6195-b6fc-b3a4af541aa3 ~/.ssh/id_rsa.pub
</code></pre>
<h2 id="deleteuserkey-delete-accountusersuserkeyskey">DeleteUserKey (DELETE /:account/users/:user/keys/:key)</h2>
<p>Removes a key.  See <a href="#GetKey">GetKey</a>.</p>
<h3 id="cli-command_26">CLI Command:</h3>
<pre><code>$ sdc-user delete-key dd71f8bb-f310-4746-8e36-afd7c6dd2895 '0b:56:ae:c5:d1:7b:7a:98:09:58:1a:a2:0c:22:63:9f'
</code></pre>
<h1 id="config">Config</h1>
<p>These endpoints allow you to get and set configuration values related to your
account.</p>
<h2 id="getconfig-get-loginconfig">GetConfig (GET /:login/config)</h2>
<p>Outputs configuration for your account.  The configuration values that are
currently configurable are:</p>
<ul>
<li><code>default_network</code>: the network that docker containers are provisioned on.</li>
</ul>
<h3 id="inputs_23">Inputs</h3>
<ul>
<li>None</li>
</ul>
<h3 id="returns_23">Returns</h3>
<p>An object with configuration values.</p>
<h3 id="errors_23">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<h3 id="cli-command_27">CLI Command</h3>
<p>A user's default fabric network is stored on this config object. The following
command uses this endpoint to retrieve it.</p>
<pre><code>$ sdc-fabric network get-default
7fa999c8-0d2c-453e-989c-e897716d0831
</code></pre>
<h3 id="example-request_21">Example Request</h3>
<pre><code>GET /my/config HTTP/1.1
Host: api.example.com
Accept: application/json
Authorization: Signature keyId...
Api-Version: ~8
</code></pre>
<h3 id="example-response_21">Example Response</h3>
<pre><code>HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 58
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: GET, HEAD, PUT
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Content-MD5: 0ZhWHGmb65TwGb3V1+XFlA==
Date: Thu, 21 Jan 2016 05:23:10 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: 0faa8fb0-bfff-11e5-a42d-41bc4fcc136a
Response-Time: 379

{
  "default_network": "45607081-4cd2-45c8-baf7-79da760fffaa"
}
</code></pre>
<h2 id="updateconfig-put-loginconfig">UpdateConfig (PUT /:login/config)</h2>
<p>Updates configuration values for your account.</p>
<h3 id="inputs_24">Inputs</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>default_network</td>
<td>String</td>
<td>ID of the network used for provisioning docker containers</td>
</tr>
</tbody>
</table>
<h3 id="returns_24">Returns</h3>
<p>An object with the updated configuration.</p>
<h3 id="errors_24">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<h3 id="cli-command_28">CLI Command</h3>
<pre><code>$ sdc-fabric network set-default c00cbe98-7dea-44d3-b644-5bd078700bf8
</code></pre>
<h3 id="example-request_22">Example Request</h3>
<pre><code>PUT /my/config HTTP/1.1
Host: api.example.com
Accept: application/json
Authorization: Signature keyId...
Api-Version: ~8

{
    "default_network": "c00cbe98-7dea-44d3-b644-5bd078700bf8"
}
</code></pre>
<h3 id="example-response_22">Example Response</h3>
<pre><code>HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 58
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: GET, HEAD, PUT
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Content-MD5: g7ZJ7pMsDmGHEbxBpH0gug==
Date: Thu, 21 Jan 2016 05:24:58 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: 4ed86b80-bfff-11e5-bf5e-35b3b5208a80
Response-Time: 1643

{
  "default_network": "c00cbe98-7dea-44d3-b644-5bd078700bf8"
}
</code></pre>
<h1 id="datacenters">Datacenters</h1>
<h2 id="listdatacenters-get-logindatacenters">ListDatacenters (GET /:login/datacenters)</h2>
<p>Provides a list of all datacenters this cloud is aware of.</p>
<h3 id="inputs_25">Inputs</h3>
<ul>
<li>None</li>
</ul>
<h3 id="returns_25">Returns</h3>
<p>An object where the keys are the datacenter name, and the value is the URL
endpoint of that datacenter's CloudAPI.</p>
<p>Note that a <code>Triton-Datacenter-Name</code> response header was added in 9.2.0.</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>$datacentername</td>
<td>URL</td>
<td>location of the datacenter</td>
</tr>
</tbody>
</table>
<h3 id="errors_25">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_29">CLI Command</h3>
<pre><code>$ triton datacenters
</code></pre>
<p>or</p>
<pre><code>$ sdc-listdatacenters
</code></pre>
<h4 id="example-request_23">Example Request</h4>
<pre><code>GET /my/datacenters HTTP/1.1
Host: api.example.com
Accept: application/json
Authorization: Signature keyId...
Api-Version: ~8
Content-Length: 0
</code></pre>
<h4 id="example-response_23">Example Response</h4>
<pre><code>HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 42
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: GET
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Content-MD5: Ju6/xjora7HcwoGG8a8CyA==
Date: Thu, 21 Jan 2016 05:29:22 GMT
Server: cloudapi/8.0.0
Triton-Datacenter-Name: us-west-1
Api-Version: 8.0.0
Request-Id: ec8bd1a0-bfff-11e5-acb9-49a3959d8bb3
Response-Time: 958

{
  "us-west-1": "https://us-west-1.api.joyent.com"
}
</code></pre>
<h2 id="getdatacenter-get-logindatacentersname">GetDatacenter (GET /:login/datacenters/:name)</h2>
<p>Gets an individual datacenter by name.  Returns an HTTP redirect to your client,
where the datacenter url is in the Location header.</p>
<h3 id="inputs_26">Inputs</h3>
<ul>
<li>None</li>
</ul>
<h3 id="returns_26">Returns</h3>
<p>An object formatted like an Error Response; check the <code>Location</code> header for the
URL itself.</p>
<h3 id="errors_26">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> does not exist or <code>:name</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_30">CLI Command</h3>
<ul>
<li>None</li>
</ul>
<h3 id="example-request_24">Example Request</h3>
<pre><code>GET /my/datacenters/example HTTP/1.1
Host: api.example.com
Authorization: Signature keyId...
Accept: application/json
Api-Version: ~8
</code></pre>
<h3 id="example-response_24">Example Response</h3>
<pre><code>HTTP/1.1 302 Moved Temporarily
Location: https://api.example.com
Content-Type: application/json
Content-Length: 74
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: GET
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Content-MD5: LWs/o6eHtZLqPJPJEcN46A==
Date: Thu, 21 Jan 2016 05:31:51 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: 45769340-c000-11e5-a6b9-4349e525b06c
Response-Time: 830

{
  "code": "ResourceMoved",
  "message": "example https://api.example.com"
}
</code></pre>
<h1 id="services">Services</h1>
<h2 id="listservices-get-loginservices">ListServices (GET /:login/services)</h2>
<p>Provides the URL endpoints for services for this datacenter. It is a mapping of
service name to URL endpoint.</p>
<h3 id="inputs_27">Inputs</h3>
<ul>
<li>None</li>
</ul>
<h3 id="returns_27">Returns</h3>
<p>An object where the keys are the service name, and the value is the URL
endpoint.</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>$serviceName</td>
<td>URL</td>
<td>URL endpoint of that service</td>
</tr>
</tbody>
</table>
<h3 id="errors_27">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_31">CLI Command</h3>
<pre><code>$ triton services
</code></pre>
<h4 id="example-request_25">Example Request</h4>
<pre><code>GET /my/services HTTP/1.1
Host: api.example.com
Authorization: Signature keyId...
Accept: application/json
Api-Version: ~8
Content-Length: 0
</code></pre>
<h4 id="example-response_25">Example Response</h4>
<pre><code>HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 100
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: GET
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Content-MD5: jzCseheYDALjhInUqjTbDg==
Date: Thu, 21 Jan 2016 05:39:52 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: 645d8920-c001-11e5-a42d-41bc4fcc136a
Response-Time: 882

{
  "cloudapi": "https://us-west-1.api.example.com",
  "docker": "tcp://us-west-1.docker.example.com",
  "manta": "https://us-west.manta.example.com"
}
</code></pre>
<h1 id="images_1">Images</h1>
<p>An <a href="#image-description">image</a> contains the software packages that will be
available on newly-provisioned instance.  In the case of hardware virtual
machines, the image also includes the operating system.</p>
<h2 id="listimages-get-loginimages">ListImages (GET /:login/images)</h2>
<p>Provides a list of images available in this datacenter.</p>
<p>Note: Currently, <em>Docker</em> images are not included in this endpoint's responses.
You must use <code>docker images</code> against the
<a href="https://apidocs.joyent.com/docker">docker</a> service for this datacenter.</p>
<h3 id="inputs_28">Inputs</h3>
<p>The following optional query parameters are available to filter the list of
images:</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>String</td>
<td>The "friendly" name for this image</td>
</tr>
<tr>
<td>os</td>
<td>String</td>
<td>The underlying operating system for this image</td>
</tr>
<tr>
<td>version</td>
<td>String</td>
<td>The version for this image</td>
</tr>
<tr>
<td>public</td>
<td>Boolean</td>
<td>Filter public/private images</td>
</tr>
<tr>
<td>state</td>
<td>String</td>
<td>Filter on image <a href="https://images.joyent.com/docs/#manifest-state">state</a>. By default only active images are shown. Use <code>?state=all</code> to list all images</td>
</tr>
<tr>
<td>owner</td>
<td>String</td>
<td>Filter on owner UUID</td>
</tr>
<tr>
<td>type</td>
<td>String</td>
<td>Filter on image type. The types changed in v8.0.0</td>
</tr>
</tbody>
</table>
<h3 id="returns_28">Returns</h3>
<p>An array of images.  Image objects include the following fields:</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>Unique id for this image</td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td>The "friendly" name for this image</td>
</tr>
<tr>
<td>os</td>
<td>String</td>
<td>The underlying operating system for this image</td>
</tr>
<tr>
<td>version</td>
<td>String</td>
<td>The version for this image</td>
</tr>
<tr>
<td>type</td>
<td>String</td>
<td>What kind of image this is. The values differ after v8.0.0+</td>
</tr>
<tr>
<td>requirements</td>
<td>Object</td>
<td>Contains a grouping of various minimum requirements for provisioning an instance with this image. For example 'password' indicates that a password must be provided</td>
</tr>
<tr>
<td>requirements.max_ram</td>
<td>String</td>
<td>Indicates the maximum RAM requirement that must be provided in the VM manifest to provision a VM based on this image.</td>
</tr>
<tr>
<td>requirements.max_memory</td>
<td>String</td>
<td>Indicates the maximum RAM requirement that must be provided in the VM manifest to provision a VM based on this image.</td>
</tr>
<tr>
<td>requirements.min_ram</td>
<td>String</td>
<td>Indicates the minimum RAM requirement that must be provided in the VM manifest to provision a VM based on this image.</td>
</tr>
<tr>
<td>requirements.min_memory</td>
<td>String</td>
<td>Indicates the minimum RAM requirement that must be provided in the VM manifest to provision a VM based on this image.</td>
</tr>
<tr>
<td>requirements.brand</td>
<td>String</td>
<td>Indicates which brand has to be used in the VM manifest to provision a VM based on this image.</td>
</tr>
<tr>
<td>homepage</td>
<td>String</td>
<td>The URL for a web page with more detailed information for this image</td>
</tr>
<tr>
<td>files</td>
<td>Array</td>
<td>An array of image files that make up each image. Currently only a single file per image is supported</td>
</tr>
<tr>
<td>files[0].compression</td>
<td>String</td>
<td>The type of file compression used for the image file. One of 'bzip2', 'gzip', 'none'</td>
</tr>
<tr>
<td>files[0].sha1</td>
<td>String</td>
<td>SHA-1 hex digest of the file content. Used for corruption checking</td>
</tr>
<tr>
<td>files[0].size</td>
<td>Number</td>
<td>File size in bytes</td>
</tr>
<tr>
<td>published_at</td>
<td>ISO8859 date</td>
<td>The time this image has been made publicly available</td>
</tr>
<tr>
<td>owner</td>
<td>String</td>
<td>The UUID of the user who owns this image</td>
</tr>
<tr>
<td>public</td>
<td>Boolean</td>
<td>Indicates if this image is publicly available</td>
</tr>
<tr>
<td>state</td>
<td>String</td>
<td>The current state of the image. One of 'active', 'unactivated', 'disabled', 'creating', 'failed'</td>
</tr>
<tr>
<td>tags</td>
<td>Object</td>
<td>An object of key/value pairs that allows clients to categorize images by any given criteria</td>
</tr>
<tr>
<td>eula</td>
<td>String</td>
<td>URL of the End User License Agreement (EULA) for the image</td>
</tr>
<tr>
<td>acl</td>
<td>Array</td>
<td>Access Control List. An array of account UUIDs given access to a private image. The field is only relevant to private images.</td>
</tr>
<tr>
<td>error</td>
<td>Object</td>
<td>If <code>state=="failed"</code>, resulting from <a href="#CreateImageFromMachine">CreateImageFromMachine</a> failure, then there may be an error object of the form <code>{"code": "&lt;string error code&gt;", "message": "&lt;string desc&gt;"}</code></td>
</tr>
<tr>
<td>error.code</td>
<td>String</td>
<td>A CamelCase string code for this error, e.g. "PrepareImageDidNotRun". See <a href="#GetImage">GetImage</a> docs for a table of error.code values</td>
</tr>
<tr>
<td>error.message</td>
<td>String</td>
<td>A short description of the image creation failure</td>
</tr>
</tbody>
</table>
<!-- TODO: list possible error.code values, link to troubleshooting docs -->

<h3 id="errors_28">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>login</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_32">CLI Command</h3>
<pre><code>$ triton image list
</code></pre>
<p>or</p>
<pre><code>$ sdc-listimages
</code></pre>
<h3 id="example-request_26">Example Request</h3>
<pre><code>GET /my/images HTTP/1.1
Host: api.example.com
Authorization: Signature keyId...
Accept: application/json
Api-Version: ~8
</code></pre>
<h3 id="example-response_26">Example Response</h3>
<pre><code>HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 611
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: GET, HEAD, POST
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Content-MD5: 9eDxMdIxc+3aED7Z3qyL8w==
Date: Thu, 21 Jan 2016 07:57:59 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: af34a510-c014-11e5-9c73-6767e338bf5d
Response-Time: 1506

[
  {
    "id": "2b683a82-a066-11e3-97ab-2faa44701c5a",
    "name": "base",
    "version": "13.4.0",
    "os": "smartos",
    "requirements": {},
    "type": "zone-dataset",
    "description": "A 32-bit SmartOS image with just essential packages installed. Ideal for users who are comfortable with setting up their own environment and tools.",
    "files": [
      {
        "compression": "gzip",
        "sha1": "3bebb6ae2cdb26eef20cfb30fdc4a00a059a0b7b",
        "size": 110742036
      }
    ],
    "tags": {
      "role": "os",
      "group": "base-32"
    },
    "homepage": "https://docs.joyent.com/images/smartos/base",
    "published_at": "2014-02-28T10:50:42Z",
    "owner": "930896af-bf8c-48d4-885c-6573a94b1853",
    "public": true,
    "state": "active"
  },
  ...
]
</code></pre>
<h2 id="getimage-get-loginimagesid">GetImage (GET /:login/images/:id)</h2>
<p>Gets an individual image by <code>id</code>.</p>
<h3 id="inputs_29">Inputs</h3>
<p>None</p>
<h3 id="returns_29">Returns</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>Unique id for this image</td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td>The "friendly" name for this image</td>
</tr>
<tr>
<td>os</td>
<td>String</td>
<td>The underlying operating system for this image</td>
</tr>
<tr>
<td>version</td>
<td>String</td>
<td>The version for this image</td>
</tr>
<tr>
<td>type</td>
<td>String</td>
<td>What kind of image this is. The values differ after v8.0.0+</td>
</tr>
<tr>
<td>requirements</td>
<td>Object</td>
<td>Contains a grouping of various minimum requirements for provisioning an instance with this image. For example 'password' indicates that a password must be provided</td>
</tr>
<tr>
<td>requirements.max_ram</td>
<td>String</td>
<td>Indicates the maximum RAM requirement that must be provided in the VM manifest to provision a VM based on this image.</td>
</tr>
<tr>
<td>requirements.max_memory</td>
<td>String</td>
<td>Indicates the maximum RAM requirement that must be provided in the VM manifest to provision a VM based on this image.</td>
</tr>
<tr>
<td>requirements.min_ram</td>
<td>String</td>
<td>Indicates the minimum RAM requirement that must be provided in the VM manifest to provision a VM based on this image.</td>
</tr>
<tr>
<td>requirements.min_memory</td>
<td>String</td>
<td>Indicates the minimum RAM requirement that must be provided in the VM manifest to provision a VM based on this image.</td>
</tr>
<tr>
<td>requirements.brand</td>
<td>String</td>
<td>Indicates which brand has to be used in the VM manifest to provision a VM based on this image.</td>
</tr>
<tr>
<td>homepage</td>
<td>String</td>
<td>The URL for a web page with more detailed information for this image</td>
</tr>
<tr>
<td>files</td>
<td>Array</td>
<td>An array of image files that make up each image. Currently only a single file per image is supported</td>
</tr>
<tr>
<td>files[0].compression</td>
<td>String</td>
<td>The type of file compression used for the image file. One of 'bzip2', 'gzip', 'none'</td>
</tr>
<tr>
<td>files[0].sha1</td>
<td>String</td>
<td>SHA-1 hex digest of the file content. Used for corruption checking</td>
</tr>
<tr>
<td>files[0].size</td>
<td>Number</td>
<td>File size in bytes</td>
</tr>
<tr>
<td>published_at</td>
<td>ISO8859 date</td>
<td>The time this image has been made publicly available</td>
</tr>
<tr>
<td>owner</td>
<td>String</td>
<td>The UUID of the user who owns this image</td>
</tr>
<tr>
<td>public</td>
<td>Boolean</td>
<td>Indicates if this image is publicly available</td>
</tr>
<tr>
<td>state</td>
<td>String</td>
<td>The current state of the image. One of 'active', 'unactivated', 'disabled', 'creating', 'failed'</td>
</tr>
<tr>
<td>tags</td>
<td>Object</td>
<td>An object of key/value pairs that allows clients to categorize images by any given criteria</td>
</tr>
<tr>
<td>eula</td>
<td>String</td>
<td>URL of the End User License Agreement (EULA) for the image</td>
</tr>
<tr>
<td>acl</td>
<td>Array</td>
<td>Access Control List. An array of account UUIDs given access to a private image. The field is only relevant to private images.</td>
</tr>
<tr>
<td>error</td>
<td>Object</td>
<td>If <code>state=="failed"</code>, resulting from <a href="#CreateImageFromMachine">CreateImageFromMachine</a> failure, then there may be an error object of the form <code>{"code": "&lt;string error code&gt;", "message": "&lt;string desc&gt;"}</code></td>
</tr>
<tr>
<td>error.code</td>
<td>String</td>
<td>A CamelCase string code for this error, e.g. "PrepareImageDidNotRun". See <a href="#GetImage">GetImage</a> docs for a table of error.code values</td>
</tr>
<tr>
<td>error.message</td>
<td>String</td>
<td>A short description of the image creation failure</td>
</tr>
</tbody>
</table>
<p>Possible <code>error.code</code> values:</p>
<table>
<thead>
<tr>
<th><strong>error.code</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>PrepareImageDidNotRun</td>
<td>This typically means that the target harware virtual machine (e.g. Linux) has old guest tools that pre-date the image creation feature. Guest tools can be upgraded with installers at <a href="https://download.joyent.com/pub/guest-tools/">https://download.joyent.com/pub/guest-tools/</a>. Other possibilities are: a boot time greater than the five-minute timeout, or a bug or crash in the image-preparation script</td>
</tr>
<tr>
<td>VmHasNoOrigin</td>
<td>Origin image data could not be found for the instance. Typically this is for an instance <em>migrated</em> before image creation support was added</td>
</tr>
<tr>
<td>NotSupported</td>
<td>Indicates an error due to functionality that isn't currently supported. One example is that custom image creation of an instance based on a custom image isn't currently supported</td>
</tr>
<tr>
<td>InternalError</td>
<td>A catch-all error for unexpected or internal errors</td>
</tr>
</tbody>
</table>
<h3 id="errors_29">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<h3 id="cli-command_33">CLI Command</h3>
<pre><code>$ triton image get 2b683a82-a066-11e3-97ab-2faa44701c5a
</code></pre>
<p>or</p>
<pre><code>$ sdc-getimage 2b683a82-a066-11e3-97ab-2faa44701c5a
</code></pre>
<h4 id="example-request_27">Example Request</h4>
<pre><code>GET /my/images/2b683a82-a066-11e3-97ab-2faa44701c5a HTTP/1.1
Host: api.example.com
Authorization: Signature keyId...
Accept: application/json
Api-Version: ~8
</code></pre>
<h4 id="example-response_27">Example Response</h4>
<pre><code>HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 609
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: GET, HEAD, POST, DELETE
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Content-MD5: 42n5PWY5xZP0lnjdMb7Omg==
Date: Thu, 21 Jan 2016 08:00:09 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: fd5679d0-c014-11e5-a8f8-951890fd520a
Response-Time: 876

{
  "id": "2b683a82-a066-11e3-97ab-2faa44701c5a",
  "name": "base",
  "version": "13.4.0",
  "os": "smartos",
  "requirements": {},
  "type": "zone-dataset",
  "description": "A 32-bit SmartOS image with just essential packages installed. Ideal for users who are comfortable with setting up their own environment and tools.",
  "files": [
    {
      "compression": "gzip",
      "sha1": "3bebb6ae2cdb26eef20cfb30fdc4a00a059a0b7b",
      "size": 110742036
    }
  ],
  "tags": {
    "role": "os",
    "group": "base-32"
  },
  "homepage": "https://docs.joyent.com/images/smartos/base",
  "published_at": "2014-02-28T10:50:42Z",
  "owner": "930896af-bf8c-48d4-885c-6573a94b1853",
  "public": true,
  "state": "active"
}
</code></pre>
<h2 id="deleteimage-delete-loginimagesid">DeleteImage (DELETE /:login/images/:id)</h2>
<p>Delete an image.  Caller must be the owner of the image to delete it.</p>
<h3 id="inputs_30">Inputs</h3>
<p>None</p>
<h3 id="returns_30">Returns</h3>
<p>Responds with HTTP 204 'No Content'.</p>
<h3 id="errors_30">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> or <code>:id</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_34">CLI Command</h3>
<pre><code>$ triton image delete 2b683a82-a066-11e3-97ab-2faa44701c5a
</code></pre>
<p>or</p>
<pre><code>$ sdc-deleteimage 2b683a82-a066-11e3-97ab-2faa44701c5a
</code></pre>
<h4 id="example-request_28">Example Request</h4>
<pre><code>DELETE /my/images/2b683a82-a066-11e3-97ab-2faa44701c5a HTTP/1.1
Authorization: ...
Host: api.example.com
Accept: application/json
Api-Version: ~8
</code></pre>
<h4 id="example-response_28">Example Response</h4>
<pre><code>HTTP/1.1 204 No Content
Content-Type: application/json
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: GET, HEAD, POST, DELETE
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Content-MD5: 83MuHssrpOMWvPXLB9stgg==
Date: Thu, 21 Jan 2016 08:02:08 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: 440f5590-c015-11e5-b5f9-2b49303f7fc4
Response-Time: 1262
</code></pre>
<h2 id="exportimage-post-loginimagesidactionexport">ExportImage (POST /:login/images/:id?action=export)</h2>
<p>Exports an image to the specified Manta path.  Caller must be the owner of the
image, and the correspondent Manta path prefix, in order to export it.  Both the
image manifest and the image file will be exported, and their filenames will
default to the following format when the specified manta path is a directory:</p>
<pre><code>&lt;manta_path&gt;/NAME-VER.imgmanifest
&lt;manta_path&gt;/NAME-VER.zfs.FILE-EXT
</code></pre>
<p>Where NAME is the image name and VER is the image version.  FILE-EXT is the file
extension of the image file.  As an example, exporting a foo-1.0.0 image to
/user/stor/cloudapi would result in the following files being exported:</p>
<pre><code>/user/stor/cloudapi/foo-1.0.0.imgmanifest
/user/stor/cloudapi/foo-1.0.0.zfs.gz
</code></pre>
<p>By contrast, if the basename of the given prefix is not a directory, then
"MANTA_PATH.imgmanifest" and "MANTA_PATH.zfs[.EXT]" are created.  As an example,
the following shows how to export foo-1.0.0 with a custom name:</p>
<pre><code>/my/images/&lt;uuid&gt;?action=export&amp;manta_path=/user/stor/my-image

/user/stor/my-image.imgmanifest
/user/stor/my-image.zfs.gz
</code></pre>
<h3 id="inputs_31">Inputs</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>manta_path</td>
<td>String</td>
<td>Manta path prefix used when exporting the image</td>
</tr>
</tbody>
</table>
<h3 id="returns_31">Returns</h3>
<p>A Manta location response object.  It provides the properties that allow a
CloudAPI user to retrieve the image file and manifest from Manta: manta_url,
image_path, manifest_path.</p>
<h3 id="errors_31">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> or <code>:id</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_35">CLI Command</h3>
<pre><code>$ sdc-exportimage --mantaPath=/user/stor/my-image 0c428eb9-7f03-4bb0-ac9f-c0718945d604
</code></pre>
<h4 id="example-request_29">Example Request</h4>
<pre><code>POST /my/images/e42f8c84-bbea-11e2-b920-078fab2aab1f?action=export&amp;manta_path=/user/stor/my-image HTTP/1.1
Authorization: ...
Host: api.example.com
Accept: application/json
Api-Version: ~8
</code></pre>
<h4 id="example-response_29">Example Response</h4>
<pre><code>HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 150
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: GET, HEAD, POST, DELETE
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Content-MD5: qSUhN+dwdJKEFlcyrUdBiw==
Date: Thu, 21 Jan 2016 08:00:09 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: 8180ad80-14ef-11e3-a62d-89e8106c294e
Response-Time: 670

{
  "manta_url": "https://us-east.manta.joyent.com",
  "image_path": "/user/stor/my-image.zfs.gz",
  "manifest_path": "/user/stor/my-image.imgmanifest"
}
</code></pre>
<h2 id="createimagefrommachine-post-loginimages">CreateImageFromMachine (POST /:login/images)</h2>
<p>Create a new custom image from an instance.  The typical process is:</p>
<ol>
<li>Customize an instance the way you want it.</li>
<li>Call this endpoint (CreateImageFromMachine) to create a new image.</li>
<li>Repeat from step 1 if more customizations are desired with different images.</li>
<li>Use the new image(s) for provisioning via <a href="#CreateMachine">CreateMachine</a>.</li>
</ol>
<h3 id="inputs_32">Inputs</h3>
<p>All inputs except <code>machine</code> are image manifest fields as defined by
<a href="https://images.joyent.com/docs/#image-manifests">the IMGAPI docs</a>.  Note that
not all fields listed there can be specified here.</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Required?</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>machine</td>
<td>UUID</td>
<td>Yes</td>
<td>The prepared and stopped instance UUID from which the image is to be created</td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td>Yes</td>
<td>The name of the custom image, e.g. "my-image". See the <a href="https://images.joyent.com/docs/#manifest-name">IMGAPI docs</a> for details</td>
</tr>
<tr>
<td>version</td>
<td>String</td>
<td>Yes</td>
<td>The version of the custom image, e.g. "1.0.0". See the <a href="https://images.joyent.com/docs/#manifest-version">IMGAPI docs</a> for details</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>No</td>
<td>The image <a href="https://images.joyent.com/docs/#manifest-description">description</a></td>
</tr>
<tr>
<td>homepage</td>
<td>String</td>
<td>No</td>
<td>The image <a href="https://images.joyent.com/docs/#manifest-homepage">homepage</a></td>
</tr>
<tr>
<td>eula</td>
<td>String</td>
<td>No</td>
<td>The image <a href="https://images.joyent.com/docs/#manifest-eula">eula</a></td>
</tr>
<tr>
<td>acl</td>
<td>String</td>
<td>No</td>
<td>The image <a href="https://images.joyent.com/docs/#manifest-acl">acl</a></td>
</tr>
<tr>
<td>tags</td>
<td>String</td>
<td>No</td>
<td>The image <a href="https://images.joyent.com/docs/#manifest-tags">tags</a></td>
</tr>
</tbody>
</table>
<h3 id="returns_32">Returns</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>Unique id for this image</td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td>The "friendly" name for this image</td>
</tr>
<tr>
<td>os</td>
<td>String</td>
<td>The underlying operating system for this image</td>
</tr>
<tr>
<td>version</td>
<td>String</td>
<td>The version for this image</td>
</tr>
<tr>
<td>type</td>
<td>String</td>
<td>What kind of image this is. The values differ after v8.0.0+</td>
</tr>
<tr>
<td>requirements</td>
<td>Object</td>
<td>Contains a grouping of various minimum requirements for provisioning an instance with this image. For example 'password' indicates that a password must be provided</td>
</tr>
<tr>
<td>homepage</td>
<td>String</td>
<td>The URL for a web page with more detailed information for this image</td>
</tr>
<tr>
<td>files</td>
<td>Array</td>
<td>An array of image files that make up each image. Currently only a single file per image is supported</td>
</tr>
<tr>
<td>files[0].compression</td>
<td>String</td>
<td>The type of file compression used for the image file. One of 'bzip2', 'gzip', 'none'</td>
</tr>
<tr>
<td>files[0].sha1</td>
<td>String</td>
<td>SHA-1 hex digest of the file content. Used for corruption checking</td>
</tr>
<tr>
<td>files[0].size</td>
<td>Number</td>
<td>File size in bytes</td>
</tr>
<tr>
<td>published_at</td>
<td>ISO8859 date</td>
<td>The time this image has been made publicly available</td>
</tr>
<tr>
<td>owner</td>
<td>String</td>
<td>The UUID of the user who owns this image</td>
</tr>
<tr>
<td>public</td>
<td>Boolean</td>
<td>Indicates if this image is publicly available</td>
</tr>
<tr>
<td>state</td>
<td>String</td>
<td>The current state of the image. One of 'active', 'unactivated', 'disabled', 'creating', 'failed'</td>
</tr>
<tr>
<td>tags</td>
<td>Object</td>
<td>An object of key/value pairs that allows clients to categorize images by any given criteria</td>
</tr>
<tr>
<td>eula</td>
<td>String</td>
<td>URL of the End User License Agreement (EULA) for the image</td>
</tr>
<tr>
<td>acl</td>
<td>Array</td>
<td>Access Control List. An array of account UUIDs given access to a private image. The field is only relevant to private images</td>
</tr>
</tbody>
</table>
<h3 id="errors_32">Errors</h3>
<p>For general errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.
Some typical and specific errors for this endpoint:</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>InsufficientServerVersionError</td>
<td>The <code>machine</code> given is running on a server that is too old</td>
</tr>
<tr>
<td>NotAvailable</td>
<td>Typically this indicates that image creation is not supported for the OS of the given hardware virtual machine</td>
</tr>
</tbody>
</table>
<!-- TODO: integrate these errors into the general table above -->

<h3 id="example-cli-command">Example CLI Command</h3>
<pre><code>$ triton image create a44f2b9b-e7af-f548-b0ba-4d9270423f1a my-custom-image 1.0.0
</code></pre>
<p>or</p>
<pre><code>$ sdc-createimagefrommachine --machine=a44f2b9b-e7af-f548-b0ba-4d9270423f1a --name=my-custom-image --imageVersion=1.0.0
</code></pre>
<h4 id="example-http-request">Example HTTP Request</h4>
<pre><code>POST /my/images HTTP/1.1
Authorization: ...
Host: api.example.com
Accept: application/json
Api-Version: ~8

{
  "machine": "a44f2b9b-e7af-f548-b0ba-4d9270423f1a",
  "name": "my-custom-image",
  "version": "1.0.0"
}
</code></pre>
<h4 id="example-http-response">Example HTTP Response</h4>
<pre><code>HTTP/1.1 201 Created
x-joyent-jobid: 0b30ef20-d622-436a-9c30-7376ba7d904c
Location: /admin/images/b87616a2-7a49-4e02-a71d-2e0ce5a2f037
Content-Type: application/json
Content-Length: 125
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: GET, HEAD, POST
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Content-MD5: 2sEZ45LmhRiretMPn5sqVA==
Date: Thu, 21 Jan 2016 08:00:09 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: 88af23b0-f952-11e2-8f2c-fff0ec35f4ce
Response-Time: 160

{
    "id": "62306cd7-7b8a-c5dd-d44e-8491c83b9974",
    "name": "my-custom-image",
    "version": "1.2.3",
    "requirements": {},
    "owner": "47034e57-42d1-0342-b302-00db733e8c8a",
    "public": false,
    "state": "creating"
}
</code></pre>
<h2 id="importimagefromdatacenter-post-loginimagesactionimport-from-datacenter">ImportImageFromDatacenter (POST /:login/images?action=import-from-datacenter)</h2>
<p>This will copy the image with <code>id</code> from the source <code>datacenter</code> into this
datacenter. The copied image will retain all fields (e.g. <code>id</code>, <code>published_at</code>)
as the original image. All incremental images in the origin chain will also be
copied.</p>
<p>You can use <a href="#ListDatacenters">triton datacenters</a> to view the list of
datacenter names in the current cloud.</p>
<h3 id="inputs_33">Inputs</h3>
<p>The following query parameters are required, these parameters will be used to
identify the image to be copied.</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>datacenter</td>
<td>String</td>
<td>The datacenter name from where the image will be copied from.</td>
</tr>
<tr>
<td>id</td>
<td>UUID</td>
<td>The id of the image to be copied.</td>
</tr>
</tbody>
</table>
<h3 id="returns_33">Returns</h3>
<p>On success, an Image object is returned. See <a href="#GetImage">GetImage</a> for the
fields that are returned in the image object.</p>
<h3 id="errors_33">Errors</h3>
<p>For general errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.
Some typical and specific errors for this endpoint:</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ImageUuidAlreadyExistsError</td>
<td>The image with <code>id</code> already exists in this datacenter.</td>
</tr>
<tr>
<td>UnauthorizedError</td>
<td>If the source image is owned by the admin.</td>
</tr>
<tr>
<td>OriginIsNotActiveError</td>
<td>If one of the incremental (origin) images is not activated.</td>
</tr>
</tbody>
</table>
<!-- TODO: integrate these errors into the general table above -->

<h3 id="example-cli-command_1">Example CLI Command</h3>
<pre><code>$ triton image copy 7eed8e50-e452-428d-9131-bf056aa911bd us-west-1
</code></pre>
<h4 id="example-http-request_1">Example HTTP Request</h4>
<pre><code>POST /my/images?action=import-from-datacenter&amp;datacenter=us-west-1&amp;id=7eed8e50-e452-428d-9131-bf056aa911bd HTTP/1.1
Authorization: ...
Host: api.example.com
Accept: application/json
Api-Version: ~9

{}
</code></pre>
<h4 id="example-http-response_1">Example HTTP Response</h4>
<pre><code>HTTP/1.1 201 Created
Content-Type: application/json
Content-Length: 125
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: GET, HEAD, POST
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Content-MD5: 2sEZ45LmhRiretMPn5sqVA==
Date: Thu, 21 Jan 2018 08:00:09 GMT
Server: cloudapi/9.2.0
Api-Version: 9.0.0
Request-Id: 49af23b0-f952-11e2-8f2c-fff0ec35f4ce
Response-Time: 460

{
  "id": "7eed8e50-e452-428d-9131-bf056aa911bd",
  "name": "myimage",
  "version": "1.4.0",
  "os": "smartos",
  "requirements": {},
  "type": "zone-dataset",
  "description": "A custom image used to test stuff.",
  "files": [
    {
      "compression": "gzip",
      "sha1": "3bebb6ae2cdb26eef20cfb30fdc4a00a059a0b7b",
      "size": 110742036
    }
  ],
  "published_at": "2015-02-28T10:50:42Z",
  "owner": "930896af-bf8c-48d4-885c-6573a94b1853",
  "public": false,
  "state": "active"
}
</code></pre>
<h2 id="updateimage-post-loginimagesidactionupdate">UpdateImage (POST /:login/images/:id?action=update)</h2>
<p>Updates metadata about an image.</p>
<h3 id="inputs_34">Inputs</h3>
<p>Only the image attributes listed below can be updated.</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>String</td>
<td>The name of the custom image, e.g. "my-image". See the <a href="https://images.joyent.com/docs/#manifest-name">IMGAPI docs</a> for details</td>
</tr>
<tr>
<td>version</td>
<td>String</td>
<td>The version of the custom image, e.g. "1.0.0". See the <a href="https://images.joyent.com/docs/#manifest-version">IMGAPI docs</a> for details</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>The image <a href="https://images.joyent.com/docs/#manifest-description">description</a></td>
</tr>
<tr>
<td>homepage</td>
<td>String</td>
<td>The image <a href="https://images.joyent.com/docs/#manifest-homepage">homepage</a></td>
</tr>
<tr>
<td>eula</td>
<td>String</td>
<td>The image <a href="https://images.joyent.com/docs/#manifest-eula">eula</a></td>
</tr>
<tr>
<td>acl</td>
<td>String</td>
<td>The image <a href="https://images.joyent.com/docs/#manifest-acl">acl</a></td>
</tr>
<tr>
<td>tags</td>
<td>String</td>
<td>The image <a href="https://images.joyent.com/docs/#manifest-tags">tags</a></td>
</tr>
</tbody>
</table>
<h3 id="returns_34">Returns</h3>
<p>An updated image object.</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>Unique id for this image</td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td>The "friendly" name for this image</td>
</tr>
<tr>
<td>os</td>
<td>String</td>
<td>The underlying operating system for this image</td>
</tr>
<tr>
<td>version</td>
<td>String</td>
<td>The version for this image</td>
</tr>
<tr>
<td>type</td>
<td>String</td>
<td>What kind of image this is. The values differ after v8.0.0+</td>
</tr>
<tr>
<td>requirements</td>
<td>Object</td>
<td>Contains a grouping of various minimum requirements for provisioning an instance with this image. For example 'password' indicates that a password must be provided</td>
</tr>
<tr>
<td>homepage</td>
<td>String</td>
<td>The URL for a web page with more detailed information for this image</td>
</tr>
<tr>
<td>files</td>
<td>Array</td>
<td>An array of image files that make up each image. Currently only a single file per image is supported</td>
</tr>
<tr>
<td>files[0].compression</td>
<td>String</td>
<td>The type of file compression used for the image file. One of 'bzip2', 'gzip', 'none'</td>
</tr>
<tr>
<td>files[0].sha1</td>
<td>String</td>
<td>SHA-1 hex digest of the file content. Used for corruption checking</td>
</tr>
<tr>
<td>files[0].size</td>
<td>Number</td>
<td>File size in bytes</td>
</tr>
<tr>
<td>published_at</td>
<td>ISO8859 date</td>
<td>The time this image has been made publicly available</td>
</tr>
<tr>
<td>owner</td>
<td>String</td>
<td>The UUID of the user who owns this image</td>
</tr>
<tr>
<td>public</td>
<td>Boolean</td>
<td>Indicates if this image is publicly available</td>
</tr>
<tr>
<td>state</td>
<td>String</td>
<td>The current state of the image. One of 'active', 'unactivated', 'disabled', 'creating', 'failed'</td>
</tr>
<tr>
<td>tags</td>
<td>Object</td>
<td>An object of key/value pairs that allows clients to categorize images by any given criteria</td>
</tr>
<tr>
<td>eula</td>
<td>String</td>
<td>URL of the End User License Agreement (EULA) for the image</td>
</tr>
<tr>
<td>acl</td>
<td>Array</td>
<td>Access Control List. An array of account UUIDs given access to a private image. The field is only relevant to private images</td>
</tr>
</tbody>
</table>
<h3 id="errors_34">Errors</h3>
<p>For general errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.
Some typical and specific errors for this endpoint:</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> or <code>:id</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="example-cli-command_2">Example CLI Command</h3>
<pre><code>$ sdc-updateimage --name=my-renamed-image eca995fe-b904-11e3-b05a-83a4899322dc
</code></pre>
<h4 id="example-http-request_2">Example HTTP Request</h4>
<pre><code>POST /my/images/eca995fe-b904-11e3-b05a-83a4899322dc?action=update HTTP/1.1
Authorization: ...
Host: api.example.com
Accept: application/json
Api-Version: ~8

{
  "name": "my-renamed-image",
}
</code></pre>
<h4 id="example-http-response_2">Example HTTP Response</h4>
<pre><code>HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 125
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: GET, HEAD, POST
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Content-MD5: 2sEZ45LmhRiretMPn5sqVA==
Date: Thu, 21 Jan 2016 08:00:09 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: b8e43c60-b904-11e3-93b7-1f685001b0c3
Response-Time: 135

{
  "id": "eca995fe-b904-11e3-b05a-83a4899322dc",
  "name": "my-renamed-image",
  "version": "1.0.0",
  "os": "smartos",
  "requirements": {},
  "type": "zone-dataset",
  "published_at": "2013-11-25T17:44:54Z",
  "owner": "47034e57-42d1-0342-b302-00db733e8c8a",
  "public": true,
  "state": "active"
}
</code></pre>
<h2 id="cloneimage-post-loginimagesidactionclone">CloneImage (POST /:login/images/:id?action=clone)</h2>
<p>Creates an independent copy of the source image. The <code>login</code> account must be on
the source image ACL to be able to make an image clone.</p>
<p>The resulting cloned image will have the same properties as the source image,
but the cloned image will have a different id, it will be owned by the <code>login</code>
account and the image will have an empty ACL.</p>
<p>All incremental images in the image origin chain that are not operator images
(i.e. are not owned by admin) will also be cloned, though all cloned incremental
images will have state <code>disabled</code> so that they are not visible in the default
image listings.</p>
<h3 id="inputs_35">Inputs</h3>
<p>None.</p>
<h3 id="returns_35">Returns</h3>
<p>A cloned image object. See <a href="#GetImage">GetImage</a> docs for the image fields
returned.</p>
<h3 id="errors_35">Errors</h3>
<p>For general errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.
Some typical and specific errors for this endpoint:</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> or <code>:id</code> does not exist.</td>
</tr>
<tr>
<td>NotImageOwnerError</td>
<td>If your account is not the owner of the image.</td>
</tr>
<tr>
<td>ImageNotShared</td>
<td>When the given image is not shared with your account.</td>
</tr>
</tbody>
</table>
<h3 id="example-cli-command_3">Example CLI Command</h3>
<pre><code>$ triton image clone eca995fe-b904-11e3-b05a-83a4899322dc
</code></pre>
<h4 id="example-http-request_3">Example HTTP Request</h4>
<pre><code>POST /my/images/eca995fe-b904-11e3-b05a-83a4899322dc?action=clone HTTP/1.1
Authorization: ...
Host: api.example.com
Accept: application/json
Api-Version: ~8
</code></pre>
<h4 id="example-http-response_3">Example HTTP Response</h4>
<pre><code>HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 125
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: GET, HEAD, POST
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Content-MD5: 2sEZ45LmhRiretMPn5sqVA==
Date: Thu, 21 Jan 2016 08:00:09 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: f8e43c60-b904-11e3-93b7-1f685001b0c3
Response-Time: 135

{
  "id": "4ca995fe-b904-11e3-b05a-83a4899322dc",
  "name": "some-image",
  "version": "1.0.0",
  "os": "smartos",
  "requirements": {},
  "type": "zone-dataset",
  "published_at": "2017-11-25T17:44:54Z",
  "owner": "77034e57-42d1-0342-b302-00db733e8c8a",
  "public": true,
  "state": "active"
}
</code></pre>
<h1 id="packages_1">Packages</h1>
<p><a href="#packages-description">Packages</a> are named collections of resources that are
used to describe the dimensions of either a container or a hardware virtual
machine.  These resources include (but are not limited to) RAM size, CPUs, CPU
caps, lightweight threads, disk space, swap size, and logical networks.</p>
<h2 id="listpackages-get-loginpackages">ListPackages (GET /:login/packages)</h2>
<p>Provides a list of packages available in this datacenter.</p>
<h3 id="inputs_36">Inputs</h3>
<ul>
<li>The following are all optional inputs:</li>
</ul>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>String</td>
<td>The "friendly" name for this package</td>
</tr>
<tr>
<td>memory</td>
<td>Number</td>
<td>How much memory will by available (in MiB)</td>
</tr>
<tr>
<td>disk</td>
<td>Number</td>
<td>How much disk space will be available (in MiB)</td>
</tr>
<tr>
<td>swap</td>
<td>Number</td>
<td>How much swap space will be available (in MiB)</td>
</tr>
<tr>
<td>lwps</td>
<td>Number</td>
<td>Maximum number of light-weight processes (threads) allowed</td>
</tr>
<tr>
<td>vcpus</td>
<td>Number</td>
<td>Number of vCPUs for this package</td>
</tr>
<tr>
<td>version</td>
<td>String</td>
<td>The version of this package</td>
</tr>
<tr>
<td>group</td>
<td>String</td>
<td>The group this package belongs to</td>
</tr>
<tr>
<td>flexible_disk</td>
<td>Boolean</td>
<td>Whether this is a flexible_disk package</td>
</tr>
</tbody>
</table>
<p>When any values are provided for one or more of the aforementioned inputs, the
retrieved packages will match all of them.</p>
<p>When querying, wildcards (i.e. '<em>') are allowed for string fields. For example,
to list all packages with a name that starts with "foo", give "foo</em>" as the
package name.</p>
<h3 id="returns_36">Returns</h3>
<p>An array of objects, of the form:</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>Unique id for this package</td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td>The "friendly" name for this package</td>
</tr>
<tr>
<td>memory</td>
<td>Number</td>
<td>How much memory will by available (in MiB)</td>
</tr>
<tr>
<td>disk</td>
<td>Number</td>
<td>How much disk space will be available (in MiB)</td>
</tr>
<tr>
<td>swap</td>
<td>Number</td>
<td>How much swap space will be available (in MiB)</td>
</tr>
<tr>
<td>lwps</td>
<td>Number</td>
<td>Maximum number of light-weight processes (threads) allowed</td>
</tr>
<tr>
<td>vcpus</td>
<td>Number</td>
<td>Number of vCPUs for this package</td>
</tr>
<tr>
<td>version</td>
<td>String</td>
<td>The version of this package</td>
</tr>
<tr>
<td>group</td>
<td>String</td>
<td>The group this package belongs to</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>A human-friendly description about this package</td>
</tr>
<tr>
<td>disks</td>
<td>Array</td>
<td>The disks this package contains (Allowed when flexible_disk is <code>true</code>)</td>
</tr>
<tr>
<td>flexible_disk</td>
<td>Boolean</td>
<td>Whether this is a flexible_disk package (bhyve only)</td>
</tr>
<tr>
<td>default</td>
<td>Boolean</td>
<td>(deprecated) Whether this is the default package in this datacenter</td>
</tr>
</tbody>
</table>
<h3 id="errors_36">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_36">CLI Command</h3>
<pre><code>$ triton package list
</code></pre>
<p>or</p>
<pre><code>$ sdc-listpackages
</code></pre>
<h3 id="example-request_30">Example Request</h3>
<pre><code>GET /my/packages HTTP/1.1
Host: api.example.com
Authorization: ...
Accept: application/json
Api-Version: ~8
</code></pre>
<h3 id="example-response_30">Example Response</h3>
<pre><code>HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 314
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: GET, HEAD
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Content-MD5: u0+0E3G28WL4Y4K8p6+pIg==
Date: Thu, 21 Jan 2016 08:33:52 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: b24219e0-c019-11e5-99e1-8339f3270a9f
Response-Time: 1992

[
  {
    "id": "7b17343c-94af-6266-e0e8-893a3b9993d0",
    "name": "sdc_128",
    "memory": 128,
    "disk": 12288,
    "swap": 256,
    "vcpus": 1,
    "lwps": 1000,
    "default": false,
    "version": "1.0.0"
  },
  ...
]
</code></pre>
<h2 id="getpackage-get-loginpackagesid">GetPackage (GET /:login/packages/:id)</h2>
<p>Gets a package by <code>name</code> or <code>id</code>.</p>
<h3 id="inputs_37">Inputs</h3>
<ul>
<li>None</li>
</ul>
<h3 id="returns_37">Returns</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>Unique id for this package</td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td>The "friendly" name for this package</td>
</tr>
<tr>
<td>memory</td>
<td>Number</td>
<td>How much memory will by available (in MiB)</td>
</tr>
<tr>
<td>disk</td>
<td>Number</td>
<td>How much disk space will be available (in MiB)</td>
</tr>
<tr>
<td>swap</td>
<td>Number</td>
<td>How much swap space will be available (in MiB)</td>
</tr>
<tr>
<td>lwps</td>
<td>Number</td>
<td>Maximum number of light-weight processes (threads) allowed</td>
</tr>
<tr>
<td>vcpus</td>
<td>Number</td>
<td>Number of vCPUs for this package</td>
</tr>
<tr>
<td>version</td>
<td>String</td>
<td>The version of this package</td>
</tr>
<tr>
<td>group</td>
<td>String</td>
<td>The group this package belongs to</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>A human-friendly description about this package</td>
</tr>
<tr>
<td>disks</td>
<td>Array</td>
<td>The disks this package contains (Allowed when flexible_disk is <code>true</code>)</td>
</tr>
<tr>
<td>flexible_disk</td>
<td>Boolean</td>
<td>Whether this is a flexible_disk package (bhyve only)</td>
</tr>
<tr>
<td>default</td>
<td>Boolean</td>
<td>(deprecated) Whether this is the default package in this datacenter</td>
</tr>
</tbody>
</table>
<h3 id="errors_37">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> or <code>:id</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_37">CLI Command</h3>
<pre><code>$ triton package get 7b17343c-94af-6266-e0e8-893a3b9993d0
</code></pre>
<p>or</p>
<pre><code>$ sdc-getpackage 7b17343c-94af-6266-e0e8-893a3b9993d0
</code></pre>
<h3 id="example-request_31">Example Request</h3>
<pre><code>GET /my/packages/7b17343c-94af-6266-e0e8-893a3b9993d0 HTTP/1.1
Host: api.example.com
Authorization: ...
Accept: application/json
Api-Version: ~8
</code></pre>
<h3 id="example-response_31">Example Response</h3>
<pre><code>HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 156
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: GET, HEAD
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Content-MD5: MEUpS89GsEaHBykatBp5rg==
Date: Thu, 21 Jan 2016 08:37:04 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: 253dd4c0-c01a-11e5-b5f9-2b49303f7fc4
Response-Time: 1482

{
  "id": "7b17343c-94af-6266-e0e8-893a3b9993d0",
  "name": "sdc_128",
  "memory": 128,
  "disk": 12288,
  "swap": 256,
  "vcpus": 1,
  "lwps": 1000,
  "default": false,
  "version": "1.0.0"
}
</code></pre>
<h1 id="instances">Instances</h1>
<p>Triton supports three different types of instances:</p>
<ul>
<li>Docker containers. OS-virtualized instances managed through the Docker client.</li>
<li>Infrastructure containers. More traditional OS-virtualized instances running SmartOS or more Linux distributions.</li>
<li>Hardware-virtualized machines. Hardware-virtualized instances (KVM) for running legacy or special-purpose operating systems.</li>
</ul>
<p>Infrastructure and Docker containers are lightweight, offering the most
performance, observability and operational flexibility. Harware-virtualized
machines are useful for non-SmartOS or non-Linux stacks.</p>
<h2 id="listmachines-get-loginmachines">ListMachines (GET /:login/machines)</h2>
<p>Lists all instances we have on record for your account.  If you have a large
number of instances, you can filter using the input parameters listed below.
Note that deleted instances are returned only if the instance history has not
been purged from Triton.</p>
<p>You can paginate this API by passing in <code>offset</code> and <code>limit</code>.  HTTP responses
will contain the additional headers <code>x-resource-count</code> and <code>x-query-limit</code>.  If
<code>x-resource-count</code> is less than <code>x-query-limit</code>, you're done, otherwise call the
API again with <code>offset</code> set to <code>offset</code> + <code>limit</code> to fetch additional instances.</p>
<p>Note that there is a <code>HEAD /:login/machines</code> form of this API, so you can
retrieve the number of instances without retrieving a JSON describing the
instances themselves.</p>
<h3 id="inputs_38">Inputs</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>type</td>
<td>String</td>
<td>(deprecated) The type of instance (virtualmachine or smartmachine)</td>
</tr>
<tr>
<td>brand</td>
<td>String</td>
<td>(v8.0+) The type of instance (e.g. lx)</td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td>Machine name to find (will make your list size 1, or 0 if nothing found)</td>
</tr>
<tr>
<td>image</td>
<td>String</td>
<td>Image id; returns instances provisioned with that image</td>
</tr>
<tr>
<td>state</td>
<td>String</td>
<td>The current state of the instance (e.g. running)</td>
</tr>
<tr>
<td>memory</td>
<td>Number</td>
<td>The current size of the RAM deployed for the instance (in MiB)</td>
</tr>
<tr>
<td>tombstone</td>
<td>Boolean</td>
<td>Include destroyed and failed instances available in instance history</td>
</tr>
<tr>
<td>limit</td>
<td>Number</td>
<td>Return a max of N instances; default is 1000 (which is also the maximum allowable result set size)</td>
</tr>
<tr>
<td>offset</td>
<td>Number</td>
<td>Get a <code>limit</code> number of instances starting at this <code>offset</code></td>
</tr>
<tr>
<td>tag.$name</td>
<td>String</td>
<td>An arbitrary set of tags can be used for querying, assuming they are prefixed with "tag."</td>
</tr>
<tr>
<td>docker</td>
<td>Boolean</td>
<td>Whether to only list Docker instances, or only non-Docker instances, if present. Defaults to showing all instances.</td>
</tr>
<tr>
<td>credentials</td>
<td>Boolean</td>
<td>Whether to include the generated credentials for instances, if present. Defaults to false</td>
</tr>
</tbody>
</table>
<p>Note that if the special input <code>tags=*</code> is provided, any other input will be
completely ignored and the response will return all instances with any tag.</p>
<p>Be aware that in the case of instances created with vmadm directly (i.e. not
through CloudAPI), ips, networks, primaryIp and package may be in a different
format than expected. The <code>ips</code> array can contain the value "dhcp", not just
IP strings, the <code>networks</code> array can contain null values for networks that
CloudAPI was unable to determine (e.g. as a result of a "dhcp" IP), <code>primaryIp</code>
too can have the value of "dhcp", and the package string can be empty instead of
a UUID. Unless ops is bypassing CloudAPI and creating instances directly, it is
unlikely you need concern yourself with this caveat.</p>
<h3 id="returns_38">Returns</h3>
<p>An array of instance objects, which contain:</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>Unique id for this instance</td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td>The "friendly" name for this instance</td>
</tr>
<tr>
<td>type</td>
<td>String</td>
<td>(deprecated) The type of instance (virtualmachine or smartmachine)</td>
</tr>
<tr>
<td>brand</td>
<td>String</td>
<td>(v8.0+) The type of instance (e.g. lx)</td>
</tr>
<tr>
<td>state</td>
<td>String</td>
<td>The current state of this instance (e.g. running)</td>
</tr>
<tr>
<td>image</td>
<td>String</td>
<td>The image id this instance was provisioned with</td>
</tr>
<tr>
<td>memory</td>
<td>Number</td>
<td>The amount of RAM this instance has (in MiB)</td>
</tr>
<tr>
<td>disk</td>
<td>Number</td>
<td>The amount of disk this instance has (in MiB)</td>
</tr>
<tr>
<td>disks</td>
<td>Array</td>
<td>An array of disk objects (bhyve)</td>
</tr>
<tr>
<td>metadata</td>
<td>Object[String =&gt; String]</td>
<td>Any additional metadata this instance has</td>
</tr>
<tr>
<td>tags</td>
<td>Object[String =&gt; String]</td>
<td>Any tags this instance has</td>
</tr>
<tr>
<td>created</td>
<td>ISO8601 date</td>
<td>When this instance was created</td>
</tr>
<tr>
<td>updated</td>
<td>ISO8601 date</td>
<td>When this instance's details was last updated</td>
</tr>
<tr>
<td>docker</td>
<td>Boolean</td>
<td>Whether this instance is a Docker container, if present</td>
</tr>
<tr>
<td>ips</td>
<td>Array[String]</td>
<td>The IP addresses this instance has</td>
</tr>
<tr>
<td>networks</td>
<td>Array[String]</td>
<td>The network UUIDs of the nics this instance has</td>
</tr>
<tr>
<td>primaryIp</td>
<td>String</td>
<td>The IP address of the primary NIC of this instance. The "primary" NIC is used to determine the default gateway for an instance. Commonly it is also on an external network (i.e. accessible on the public internet) and hence usable for SSH'ing into an instance, but not always. (Note: In future Triton versions it will be possible to have multiple IPv4 and IPv6 addresses on a particular NIC, at which point the current definition of <code>primaryIp</code> will be ambiguous and will need to change.)</td>
</tr>
<tr>
<td>firewall_enabled</td>
<td>Boolean</td>
<td>Whether firewall rules are enforced on this instance</td>
</tr>
<tr>
<td>deletion_protection</td>
<td>Boolean</td>
<td>Whether an instance is destroyable. See <a href="#deletion-protection">Deletion Protection</a></td>
</tr>
<tr>
<td>compute_node</td>
<td>String</td>
<td>UUID of the server on which the instance is located</td>
</tr>
<tr>
<td>package</td>
<td>String</td>
<td>The id or name of the package used to create this instance</td>
</tr>
<tr>
<td>flexible</td>
<td>Boolean</td>
<td>Whether this instance uses the flexible disk space feature (bhyve)</td>
</tr>
<tr>
<td>free_space</td>
<td>Number</td>
<td>The amount of space (MiB) that is not allocated to disks nor in use by snapshots of those disks. If snapshots are present, writes to disks may reduce this value (bhyve)</td>
</tr>
</tbody>
</table>
<h3 id="errors_38">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> does not exist</td>
</tr>
<tr>
<td>InvalidArgument</td>
<td>If one of the input parameters was invalid</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_38">CLI Command</h3>
<p>Get all instance:</p>
<pre><code>$ triton instance list
</code></pre>
<p>or</p>
<pre><code>$ sdc-listmachines
</code></pre>
<p>Get all LX instance:</p>
<pre><code>$ triton instance list brand=lx
</code></pre>
<p>or</p>
<pre><code>$ sdc-listmachines --brand lx
</code></pre>
<p>Get all LX machines that are currently running:</p>
<pre><code>$ triton instance list brand=lx state=running
</code></pre>
<p>or</p>
<pre><code>$ sdc-listmachines --brand lx --state running
</code></pre>
<p>Get all LX instances that are currently running, and have 256 MiB of memory:</p>
<pre><code>$ triton instance list brand=lx state=running memory=256
</code></pre>
<p>or</p>
<pre><code>$ sdc-listmachines --brand lx --state running --memory 256
</code></pre>
<p>Get all LX instances that are currently running, with 256 MiB of RAM, tagged as
'test':</p>
<pre><code>$ sdc-listmachines --brand lx --state running --memory 256 --tag group=test
</code></pre>
<p>Get all tagged instances:</p>
<pre><code>$ sdc-listmachines --tag \*
</code></pre>
<p>Beware that depending on your shell you may need to escape the asterisk
character. E.g. Bash requires it escaped.</p>
<p>The CLI has parameters that let you filter on most things in the API, and you
can combine them.  Run <code>triton instance list --help</code> or
<code>sdc-listmachines --help</code> to see all the options.</p>
<h3 id="example-request_32">Example Request</h3>
<pre><code>GET /my/machines HTTP/1.1
Authorization: ...
Host: api.example.com
Accept: application/json
Api-Version: ~8
</code></pre>
<h3 id="example-response_32">Example Response</h3>
<pre><code>HTTP/1.1 200 OK
x-query-limit: 1000
x-resource-count: 1
Content-Type: application/json
Content-Length: 1310
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: POST, GET, HEAD
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Content-MD5: w5wJLKlhDzPpC6zKjtqaCw==
Date: Thu, 21 Jan 2016 10:55:25 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: 779b5cc0-c02d-11e5-a7d2-fdf229d32220
Response-Time: 3444

[
  {
    "id": "b6979942-7d5d-4fe6-a2ec-b812e950625a",
    "name": "test",
    "type": "smartmachine",
    "brand": "joyent",
    "state": "running",
    "image": "2b683a82-a066-11e3-97ab-2faa44701c5a",
    "ips": [
      "10.88.88.26",
      "192.168.128.5"
    ],
    "memory": 128,
    "disk": 12288,
    "metadata": {
      "root_authorized_keys": "..."
    },
    "tags": {},
    "created": "2016-01-04T12:55:50.539Z",
    "updated": "2016-01-21T08:56:59.000Z",
    "networks": [
      "a9c130da-e3ba-40e9-8b18-112aba2d3ba7",
      "45607081-4cd2-45c8-baf7-79da760fffaa"
    ],
    "primaryIp": "10.88.88.26",
    "firewall_enabled": false,
    "compute_node": "564d0b8e-6099-7648-351e-877faf6c56f6",
    "package": "sdc_128"
  }
]
</code></pre>
<h2 id="getmachine-get-loginmachinesid">GetMachine (GET /:login/machines/:id)</h2>
<p>Gets the details for an individual instance.</p>
<p>Deleted instances are returned only if the instance history has not
been purged from Triton.</p>
<h3 id="inputs_39">Inputs</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>credentials</td>
<td>Boolean</td>
<td>Whether to include the generated credentials for instances, if present. Defaults to false.</td>
</tr>
</tbody>
</table>
<h3 id="returns_39">Returns</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>Unique id for this instance</td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td>The "friendly" name for this instance</td>
</tr>
<tr>
<td>type</td>
<td>String</td>
<td>(deprecated) The type of instance (virtualmachine or smartmachine)</td>
</tr>
<tr>
<td>brand</td>
<td>String</td>
<td>(v8.0+) The type of instance (e.g. lx)</td>
</tr>
<tr>
<td>state</td>
<td>String</td>
<td>The current state of this instance (e.g. running)</td>
</tr>
<tr>
<td>image</td>
<td>String</td>
<td>The image id this instance was provisioned with</td>
</tr>
<tr>
<td>memory</td>
<td>Number</td>
<td>The amount of RAM this instance has (in MiB)</td>
</tr>
<tr>
<td>disk</td>
<td>Number</td>
<td>The amount of disk this instance has (in MiB)</td>
</tr>
<tr>
<td>disks</td>
<td>Array</td>
<td>An array of disk objects (bhyve)</td>
</tr>
<tr>
<td>metadata</td>
<td>Object[String =&gt; String]</td>
<td>Any additional metadata this instance has</td>
</tr>
<tr>
<td>tags</td>
<td>Object[String =&gt; String]</td>
<td>Any tags this instance has</td>
</tr>
<tr>
<td>created</td>
<td>ISO8601 date</td>
<td>When this instance was created</td>
</tr>
<tr>
<td>updated</td>
<td>ISO8601 date</td>
<td>When this instance's details was last updated</td>
</tr>
<tr>
<td>docker</td>
<td>Boolean</td>
<td>Whether this instance is a Docker container, if present</td>
</tr>
<tr>
<td>ips</td>
<td>Array[String]</td>
<td>The IP addresses this instance has</td>
</tr>
<tr>
<td>networks</td>
<td>Array[String]</td>
<td>The network UUIDs of the nics this instance has</td>
</tr>
<tr>
<td>primaryIp</td>
<td>String</td>
<td>The IP address of the primary NIC of this instance. The "primary" NIC is used to determine the default gateway for an instance. Commonly it is also on an external network (i.e. accessible on the public internet) and hence usable for SSH'ing into an instance, but not always. (Note: In future Triton versions it will be possible to have multiple IPv4 and IPv6 addresses on a particular NIC, at which point the current definition of <code>primaryIp</code> will be ambiguous and will need to change.)</td>
</tr>
<tr>
<td>firewall_enabled</td>
<td>Boolean</td>
<td>Whether firewall rules are enforced on this instance</td>
</tr>
<tr>
<td>compute_node</td>
<td>String</td>
<td>UUID of the server on which the instance is located</td>
</tr>
<tr>
<td>package</td>
<td>String</td>
<td>The id or name of the package used to create this instance</td>
</tr>
<tr>
<td>dns_names</td>
<td>Array[String]</td>
<td>DNS names of the instance (if the instance is using <a href="https://docs.joyent.com/public-cloud/network/cns">CNS</a>)</td>
</tr>
<tr>
<td>flexible</td>
<td>Boolean</td>
<td>Whether this instance uses the flexible disk space feature (bhyve)</td>
</tr>
<tr>
<td>free_space</td>
<td>Number</td>
<td>The amount of space (MiB) that is not allocated to disks nor in use by snapshots of those disks. If snapshots are present, writes to disks may reduce this value (bhyve)</td>
</tr>
</tbody>
</table>
<p>Be aware that in the case of instances created with vmadm directly (i.e. not
through CloudAPI), ips, networks, primaryIp and package may be in a different
format than expected. The <code>ips</code> array can contain the value "dhcp", not just
IP strings, the <code>networks</code> array can contain null values for networks that
CloudAPI was unable to determine (e.g. as a result of a "dhcp" IP), <code>primaryIp</code>
too can have the value of "dhcp", and the package string can be empty instead of
a UUID. Unless ops is bypassing CloudAPI and creating instances directly, it is
unlikely you need concern yourself with this caveat.</p>
<h3 id="errors_39">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> or <code>:id</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_39">CLI Command</h3>
<p>Get the details for the instance with id 75cfe125-a5ce-49e8-82ac-09aa31ffdf26:</p>
<pre><code>$ triton instance get b6979942-7d5d-4fe6-a2ec-b812e950625a
</code></pre>
<p>or</p>
<pre><code>$ sdc-getmachine b6979942-7d5d-4fe6-a2ec-b812e950625a
</code></pre>
<h3 id="example-request_33">Example Request</h3>
<pre><code>GET /my/machines/b6979942-7d5d-4fe6-a2ec-b812e950625a HTTP/1.1
Authorization: ...
Host: api.example.com
Accept: application/json
Api-Version: ~8
</code></pre>
<h3 id="example-response_33">Example Response</h3>
<pre><code>HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 1308
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: POST, GET, HEAD, DELETE, PUT
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Content-MD5: 0q2leQEqeZCNiznbZvKhZw==
Date: Thu, 21 Jan 2016 10:58:11 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: db0705c0-c02d-11e5-b1b7-65fab9169f0e
Response-Time: 3159

{
  "id": "b6979942-7d5d-4fe6-a2ec-b812e950625a",
  "name": "test",
  "type": "smartmachine",
  "brand": "joyent",
  "state": "running",
  "image": "2b683a82-a066-11e3-97ab-2faa44701c5a",
  "ips": [
    "10.88.88.26",
    "192.168.128.5"
  ],
  "memory": 128,
  "disk": 12288,
  "metadata": {
    "root_authorized_keys": "...",
  },
  "tags": {},
  "created": "2016-01-04T12:55:50.539Z",
  "updated": "2016-01-21T08:56:59.000Z",
  "networks": [
    "a9c130da-e3ba-40e9-8b18-112aba2d3ba7",
    "45607081-4cd2-45c8-baf7-79da760fffaa"
  ],
  "primaryIp": "10.88.88.26",
  "firewall_enabled": false,
  "compute_node": "564d0b8e-6099-7648-351e-877faf6c56f6",
  "package": "sdc_128"
}
</code></pre>
<h2 id="createmachine-post-loginmachines">CreateMachine (POST /:login/machines)</h2>
<p>Allows you to provision an instance.</p>
<p>If you do not specify a name, CloudAPI will generate a random one for you. If
you have enabled Triton CNS on your account, this name will also be used in
DNS to refer to the new instance (and must therefore consist of DNS-safe
characters only).</p>
<p>Your instance will initially be not available for login (Triton must provision
and boot it); you can poll <a href="#GetMachine">GetMachine</a> for its status.  When the
<code>state</code> field is equal to <code>running</code>, you can log in.  If the instance is a
<code>brand</code> other than <code>kvm</code> or <code>bhyve</code>, you can usually use any of the SSH keys
managed under the <a href="#keys">keys section</a> of CloudAPI to login as any POSIX user
on the OS.  You can add/remove keys over time, and the instance will
automatically work with that set.</p>
<p>If the the instance has a brand <code>kvm</code> or <code>bhyve</code>, and of a UNIX-derived OS (e.g.
Linux), you <em>must</em> have keys uploaded before provisioning; that entire set of
keys will be written out to <code>/root/.ssh/authorized_keys</code> in the new instance,
and you can SSH in using one of those keys.  Changing the keys over time under
your account will not affect a running hardware virtual machine in any way;
those keys are statically written at provisioning-time only, and you will need
to manually manage them on the instance itself.</p>
<p>If the image you create an instance from is set to generate passwords for you,
the username/password pairs will be returned in the metadata response as a
nested object, like so:</p>
<pre><code>"metadata": {
  "credentials": {
    "root": "s8v9kuht5e",
    "admin": "mf4bteqhpy"
  }
}
</code></pre>
<p>You cannot overwrite the <code>credentials</code> key in CloudAPI.</p>
<p>More generally, the metadata keys can be set either at the time of instance
creation, or after the fact.  You must either pass in plain-string values, or a
JSON-encoded string.  On metadata retrieval, you will get a JSON object back.</p>
<p>Networks can be specified using the networks attribute. It is possible to have
an instance attached to an internal network, external network or both. If the
networks attribute is absent from the input, the instance will be attached to
one externally-accessible network (i.e. assigned a public IP), and any one of
internal/private networks. If the account owns or has access to multiple private
networks, it will be important to include the desired network(s) in the request
payload instead of letting the system assign the network automatically.</p>
<p>Be aware that CreateMachine does not return IP addresses or networks.  To
obtain the IP addresses and networks of a newly-provisioned instance, poll
<a href="#GetMachine">GetMachine</a> until the instance state is <code>running</code>.</p>
<p>Typically, Triton will allocate the new instance somewhere reasonable within the
cloud. See <a href="#affinity-rules">affinity rules</a> below for options on controlling
server placement of new instances.</p>
<p>When Triton CNS is enabled, the DNS search domain of the new VM will be
automatically set to the suffix of the "instance" record that is created for
that VM. For example, if the full CNS name of the new VM would be
"foo.inst.35ad1ec4-2eab-11e6-ac02-8f56c66976a1.us-west-1.triton.zone", its
automatic DNS search path would include
"inst.35ad1ec4-2eab-11e6-ac02-8f56c66976a1.us-west-1.triton.zone". This can
be changed later within the instance, if desired.</p>
<h3 id="inputs_40">Inputs</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>String</td>
<td>Friendly name for this instance; default is the first 8 characters of the machine id. If the name includes the string {{shortId}}, any instances of that tag within the name will be replaced by the first 8 characters of the machine id.</td>
</tr>
<tr>
<td>package</td>
<td>String</td>
<td>Id of the package to use on provisioning, obtained from <a href="#ListPackages">ListPackages</a></td>
</tr>
<tr>
<td>image</td>
<td>String</td>
<td>The image UUID (the "id" field in <a href="#ListImages">ListImages</a>)</td>
</tr>
<tr>
<td>networks</td>
<td>Array</td>
<td>Array of <a href="#network-objects">network objects</a>, or an array of network UUIDs obtained from <a href="#ListNetworks">ListNetworks</a>. See the note about network pools under <a href="#AddNic">AddNic</a>.</td>
</tr>
<tr>
<td>affinity</td>
<td>Array</td>
<td>(Added in CloudAPI v8.3.0.) Optional array of <a href="#affinity-rules">affinity rules</a>.</td>
</tr>
<tr>
<td>locality</td>
<td>Object</td>
<td>(Deprecated in CloudAPI v8.3.0.) Optionally object of <a href="#locality-hints">locality hints</a>, specify which instances the new instance should be near or far from.</td>
</tr>
<tr>
<td>metadata.$name</td>
<td>String</td>
<td>An arbitrary set of metadata key/value pairs can be set at provision time, but they must be prefixed with "metadata."</td>
</tr>
<tr>
<td>tag.$name</td>
<td>String</td>
<td>An arbitrary set of tags can be set at provision time, but they must be prefixed with "tag."</td>
</tr>
<tr>
<td>firewall_enabled</td>
<td>Boolean</td>
<td>Completely enable or disable firewall for this instance. Default is false</td>
</tr>
<tr>
<td>deletion_protection</td>
<td>Boolean</td>
<td>Whether an instance is destroyable. See <a href="#deletion-protection">Deletion Protection</a>. Default is false</td>
</tr>
<tr>
<td>allow_shared_images</td>
<td>Boolean</td>
<td>Whether to allow provisioning from a shared image. Default is false</td>
</tr>
<tr>
<td>volumes</td>
<td>Array</td>
<td>A list of objects representing volumes to mount when the newly created machine boots</td>
</tr>
<tr>
<td>disks</td>
<td>Array</td>
<td>An array of disk objects to be created (bhyve)</td>
</tr>
</tbody>
</table>
<h4 id="volumes">volumes</h4>
<p>The <code>volumes</code> input parameter allows users to specify a list of volumes to mount
in the new machine when it boots:</p>
<pre><code>&quot;volumes&quot;: [
  {
    &quot;name&quot;: &quot;volume-name-1&quot;,
    &quot;type&quot;: &quot;tritonnfs&quot;,
    &quot;mode&quot;: &quot;rw&quot;,
    &quot;mountpoint&quot;: &quot;/foo&quot;
  },
  {
    &quot;name&quot;: &quot;volume-name-2&quot;,
    &quot;mode&quot;: &quot;ro&quot;,
    &quot;mountpoint&quot;: &quot;/bar&quot;
  }
]
</code></pre>

<p>Each object of the <code>volumes</code> array has the following layout:</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>String</td>
<td>The name of the volume to mount</td>
</tr>
<tr>
<td>type</td>
<td>String</td>
<td>The type of the volume to mount (currently only <code>"tritonnfs"</code> is supported)</td>
</tr>
<tr>
<td>mode</td>
<td>String</td>
<td>Determines the read/write mode for the volume to mount. Accepted values are <code>"ro"</code> (for read-only) and <code>"rw"</code> (for read-write). The default value is <code>"rw"</code>.</td>
</tr>
<tr>
<td>mountpoint</td>
<td>String</td>
<td>Specifies where the volume is mounted in the newly created machine's filesystem. It must start with a slash (<code>"/"</code>) and it must contain at least one character that is not <code>'/'</code>.</td>
</tr>
</tbody>
</table>
<h4 id="disks">disks</h4>
<p>The <code>disks</code> input parameter allows users to specify a list of disks to be provisioned when creating a bhyve instance. This parameter can only be specified if the package has its <code>flexible_disk</code> attribute set to <code>true</code>. The sum of the sizes of the disks may be no greater than the package quota.</p>
<pre><code>&quot;disks&quot;: [
  {
    &quot;id&quot;: &quot;eea4e223-dee6-44dc-a7e1-71f996e534f0&quot;,
    &quot;boot&quot;: true
  },
  {
    &quot;id&quot;: &quot;dea91a7f-5fe3-4408-b25a-994c97a7975e&quot;,
    &quot;size&quot;: 512
  },
  {
    &quot;id&quot;: &quot;c41ce11e-bed2-45d2-bdb8-8dc889ed8ced&quot;,
    &quot;size&quot;: &quot;remaining&quot;
  }
]
</code></pre>

<p>Each object of the <code>disks</code> array has the following layout</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>Unique id for this disk</td>
</tr>
<tr>
<td>boot</td>
<td>Boolean</td>
<td>If <code>true</code>, this is the boot disk</td>
</tr>
<tr>
<td>image</td>
<td>UUID</td>
<td>The image from which the disk was created</td>
</tr>
<tr>
<td>size</td>
<td>Integer</td>
<td>The size of the disk in mebibytes or "remaining". If "remaining", size will be set to the difference between the package quota and sum of the other disks.</td>
</tr>
</tbody>
</table>
<h3 id="returns_40">Returns</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>Unique id for this instance</td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td>The "friendly" name for this instance</td>
</tr>
<tr>
<td>type</td>
<td>String</td>
<td>(deprecated) The type of instance (virtualmachine or smartmachine)</td>
</tr>
<tr>
<td>brand</td>
<td>String</td>
<td>(v8.0+) The type of instance (e.g. lx)</td>
</tr>
<tr>
<td>state</td>
<td>String</td>
<td>The current state of this instance (e.g. running)</td>
</tr>
<tr>
<td>memory</td>
<td>Number</td>
<td>The amount of RAM this instance has (in MiB)</td>
</tr>
<tr>
<td>disk</td>
<td>Number</td>
<td>The amount of disk this instance has (in MiB)</td>
</tr>
<tr>
<td>disks</td>
<td>Array</td>
<td>(v9.4.0+) One disk object per disk in the VM (bhyve only)</td>
</tr>
<tr>
<td>ips</td>
<td>Array[String]</td>
<td>The IP addresses this instance has</td>
</tr>
<tr>
<td>metadata</td>
<td>Object[String =&gt; String]</td>
<td>Any additional metadata this instance has</td>
</tr>
<tr>
<td>package</td>
<td>String</td>
<td>The id or name of the package used to create this instance</td>
</tr>
<tr>
<td>image</td>
<td>String</td>
<td>The image id this instance was provisioned with</td>
</tr>
<tr>
<td>docker</td>
<td>Boolean</td>
<td>Whether this instance is a Docker container, if present</td>
</tr>
<tr>
<td>flexible</td>
<td>Boolean</td>
<td>Whether this instance uses the flexible disk space feature (bhyve)</td>
</tr>
<tr>
<td>free_space</td>
<td>Number</td>
<td>The amount of space (MiB) that is not allocated to disks nor in use by snapshots of those disks. If snapshots are present, writes to disks may reduce this value (bhyve)</td>
</tr>
<tr>
<td>created</td>
<td>ISO8601 date</td>
<td>When this instance was created</td>
</tr>
<tr>
<td>updated</td>
<td>ISO8601 date</td>
<td>When this instance's details was last updated</td>
</tr>
</tbody>
</table>
<h3 id="errors_40">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> does not exist</td>
</tr>
<tr>
<td>InsufficientCapacity</td>
<td>There isn't enough capacity in this datacenter</td>
</tr>
<tr>
<td>InvalidArgument</td>
<td>If one of the input parameters was invalid</td>
</tr>
<tr>
<td>MissingParameter</td>
<td>If one of the input parameters was missing</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_40">CLI Command</h3>
<pre><code>$ triton instance create 2b683a82-a066-11e3-97ab-2faa44701c5a 7b17343c-94af-6266-e0e8-893a3b9993d0
</code></pre>
<p>or</p>
<pre><code>$ sdc-createmachine --image=2b683a82-a066-11e3-97ab-2faa44701c5a --package=7b17343c-94af-6266-e0e8-893a3b9993d0
</code></pre>
<h3 id="example-request_34">Example Request</h3>
<pre><code>POST /my/machines HTTP/1.1
Authorization: ...
Host: api.example.com
Accept: application/json
Content-Length: 455
Content-Type: application/x-www-form-urlencoded
Api-Version: ~8

{
  "image": "2b683a82-a066-11e3-97ab-2faa44701c5a",
  "package": "7b17343c-94af-6266-e0e8-893a3b9993d0"
}
</code></pre>
<h3 id="example-response_34">Example Response</h3>
<pre><code>HTTP/1.1 201 Created
Location: /my/machines/e8622950-af78-486c-b682-dd147c938dc6
Content-Type: application/json
Content-Length: 1151
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: POST, GET, HEAD
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Content-MD5: s5ROP0dBDWlf5X1drujDvg==
Date: Thu, 21 Jan 2016 12:57:52 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: 9283ba80-c03e-11e5-b1b7-65fab9169f0e
Response-Time: 4655

{
  "id": "e8622950-af78-486c-b682-dd147c938dc6",
  "name": "e8622950",
  "type": "smartmachine",
  "brand": "joyent",
  "state": "provisioning",
  "image": "2b683a82-a066-11e3-97ab-2faa44701c5a",
  "ips": [],
  "memory": 128,
  "disk": 12288,
  "metadata": {
    "root_authorized_keys": "..."
  },
  "tags": {},
  "created": "2016-01-21T12:57:52.759Z",
  "updated": "2016-01-21T12:57:52.979Z",
  "networks": [],
  "firewall_enabled": false,
  "compute_node": null,
  "package": "sdc_128"
}
</code></pre>
<h3 id="more-examples">More Examples</h3>
<p>Create instance with multiple nics</p>
<pre><code>$ triton instance create --network=42325ea0-eb62-44c1-8eb6-0af3e2f83abc --network=c8cde927-6277-49ca-82a3-741e8b23b02f 2b683a82-a066-11e3-97ab-2faa44701c5a 7b17343c-94af-6266-e0e8-893a3b9993d0
</code></pre>
<p>or</p>
<pre><code>$ sdc-createmachine --image=2b683a82-a066-11e3-97ab-2faa44701c5a --package=7b17343c-94af-6266-e0e8-893a3b9993d0 --networks=42325ea0-eb62-44c1-8eb6-0af3e2f83abc --networks=c8cde927-6277-49ca-82a3-741e8b23b02f
</code></pre>
<p>Create instance with tags</p>
<pre><code>$ triton instance create -t foo=bar -t group=test 2b683a82-a066-11e3-97ab-2faa44701c5a 7b17343c-94af-6266-e0e8-893a3b9993d0
</code></pre>
<p>or</p>
<pre><code>$ sdc-createmachine --image=2b683a82-a066-11e3-97ab-2faa44701c5a --package=7b17343c-94af-6266-e0e8-893a3b9993d0 -t foo=bar -t group=test
</code></pre>
<h3 id="network-objects">Network objects</h3>
<p>As of CloudAPI v8.5.0 the networks parameter to CreateMachine takes an array of
network objects to add flexibility and more control. It is also still possible
to pass in an array of network UUID strings instead of the new network object
format.</p>
<p>At a minimum the network object must contain an <code>ipv4_uuid</code> parameter that is
the UUID of the network you wish the machine to have a NIC on. In addition you
may pass in a <code>ipv4_ips</code> property that is an array made up of a single IP on
that network's subnet.</p>
<p>When specifying an <code>ipv4_ips</code> array, the <code>ipv4_uuid</code> cannot be the UUID of a
network pool, or a public network.</p>
<p>Here are some examples of possible network objects:</p>
<pre><code>[
  {
    "ipv4_uuid": "f65153df-edf5-11e7-bb45-54e1adb5aaf3",
    "ipv4_ips": [
      "10.0.1.50"
    ]
  },
  {
    "ipv4_uuid": "6fa58531-edf6-11e7-bb45-54e1adb5aaf3"
  }
]
</code></pre>
<h3 id="affinity-rules">Affinity rules</h3>
<p>As of CloudAPI v8.3.0 an "affinity" field can be specified with CreateMachine.
It is an array of "affinity rules" to specify rules (or hints, "soft rules") for
placement of the new instance.</p>
<p>By default, Triton makes a reasonable attempt to spread all containers (and
non-Docker containers and VMs) owned by a single account across separate
physical servers.</p>
<p>Affinity rules are of one of the following forms:</p>
<pre><code>instance&lt;op&gt;&lt;value&gt;
container&lt;op&gt;&lt;value&gt;
&lt;tagName&gt;&lt;op&gt;&lt;value&gt;
</code></pre>
<p><op> is one of:</p>
<ul>
<li><code>==</code>: The new instance must be on the same node as the instance(s) identified
  by <value>.</li>
<li><code>!=</code>: The new instance must be on a different node to the instance(s)
  identified by <value>.</li>
<li><code>==~</code>: The new instance should be on the same node as the instance(s)
  identified by <value>. I.e. this is a best effort or "soft" rule.</li>
<li><code>!=~</code>: The new instance should be on a different node to the instance(s)
  identified by <value>. I.e. this is a best effort or "soft" rule.</li>
</ul>
<p><value> is an exact string, simple *-glob, or regular expression to match
against instance names or IDs, or against the named tag's value. Some examples:</p>
<pre><code># Run on the same node as instance silent_bob.
triton instance create -a instance==silent_bob ...

# Run on a different node to all instances tagged with 'role=database'.
triton instance create -a 'role!=database' ...

# Run on a different node to all instances with names starting with "foo".
triton instance create -a 'instance!=foo*' ...

# Same, using a regular expression.
triton instance create -a 'instance!=/^foo/' ...
</code></pre>
<h3 id="locality-hints">Locality hints</h3>
<p>(Deprecated in CloudAPI v8.3.0.)</p>
<p>You may want this instance to be placed on the same server as another
instance you have, or have it placed on an entirely different server from your
existing instances so that you can spread them out. In either case, you can
provide locality hints to CloudAPI.</p>
<p>Here is an example of a locality hint:</p>
<pre><code>"locality": {
  "strict": false,
  "near": ["af7ebb74-59be-4481-994f-f6e05fa53075"],
  "far": ["da568166-9d93-42c8-b9b2-bce9a6bb7e0a", "d45eb2f5-c80b-4fea-854f-32e4a9441e53"]
}
</code></pre>
<p>UUIDs provided should be the ids of instances belonging to you. If there is only
a single UUID entry in an array, you can omit the array and provide the UUID
string directly as the value to a near/far key.</p>
<p><code>strict</code> defaults to false, meaning that Triton will attempt to meet all the
<code>near</code> and/or <code>far</code> criteria but will still provision the instance when no
server fits all the requirements. If <code>strict</code> is set to true, the creation of
the new instance will fail if the affinity criteria cannot be met.</p>
<h3 id="user-script">User-script</h3>
<p>The special value <code>metadata.user-script</code> can be specified to provide a custom
script which will be executed by the instance right after creation, and on every
instance reboot.  This script can be specified using the command-line option
<code>--script</code>, which should be an absolute path to the file you want to upload to
the instance.</p>
<h2 id="stopmachine-post-loginmachinesidactionstop">StopMachine (POST /:login/machines/:id?action=stop)</h2>
<p>Allows you to shut down an instance.  POST to the instance name with an <code>action</code>
of <code>stop</code>.</p>
<p>You can poll on <a href="#GetMachine">GetMachine</a> until the state is <code>stopped</code>.</p>
<h3 id="inputs_41">Inputs</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>action</td>
<td>String</td>
<td>Use the exact string "stop"</td>
</tr>
</tbody>
</table>
<h3 id="returns_41">Returns</h3>
<ul>
<li>None</li>
</ul>
<h3 id="errors_41">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> or <code>:id</code> does not exist</td>
</tr>
<tr>
<td>InvalidState</td>
<td>The instance is in the wrong state to be stopped</td>
</tr>
<tr>
<td>InvalidArgument</td>
<td>If <code>action</code> was invalid</td>
</tr>
<tr>
<td>MissingParameter</td>
<td>If <code>action</code> wasn't provided</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_41">CLI Command</h3>
<pre><code>$ triton instance stop c2855c3a-a91d-46b8-9da6-6d7ab1bc6962
</code></pre>
<p>or</p>
<pre><code>$ sdc-stopmachine c2855c3a-a91d-46b8-9da6-6d7ab1bc6962
</code></pre>
<h3 id="example-request_35">Example Request</h3>
<pre><code>POST /my/machines/c2855c3a-a91d-46b8-9da6-6d7ab1bc6962 HTTP/1.1
Host: api.example.com
Authorization: ...
Accept: application/json
Content-Length: 12
Content-Type: application/x-www-form-urlencoded
Api-Version: ~8

action=stop
</code></pre>
<h3 id="example-response_35">Example Response</h3>
<pre><code>HTTP/1.1 202 Accepted
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: POST, GET, HEAD, DELETE, PUT
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Date: Thu, 21 Jan 2016 13:05:58 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: b49ae1b0-c03f-11e5-a7d2-fdf229d32220
Response-Time: 3175
Transfer-Encoding: chunked
</code></pre>
<h2 id="startmachine-post-loginmachinesidactionstart">StartMachine (POST /:login/machines/:id?action=start)</h2>
<p>Allows you to boot up an instance.  POST to the instance name with an <code>action</code>
of <code>start</code>.</p>
<p>You can poll on <a href="#GetMachine">GetMachine</a> until the state is <code>running</code>.</p>
<h3 id="inputs_42">Inputs</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>action</td>
<td>String</td>
<td>Use the exact string "start"</td>
</tr>
</tbody>
</table>
<h3 id="returns_42">Returns</h3>
<ul>
<li>None</li>
</ul>
<h3 id="errors_42">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> or <code>:id</code> does not exist</td>
</tr>
<tr>
<td>InvalidState</td>
<td>The instance is in the wrong state to be started</td>
</tr>
<tr>
<td>InvalidArgument</td>
<td>If <code>action</code> was invalid</td>
</tr>
<tr>
<td>MissingParameter</td>
<td>If <code>action</code> wasn't provided</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_42">CLI Command</h3>
<pre><code>$ triton instance start c2855c3a-a91d-46b8-9da6-6d7ab1bc6962
</code></pre>
<p>or</p>
<pre><code>$ sdc-startmachine c2855c3a-a91d-46b8-9da6-6d7ab1bc6962
</code></pre>
<h3 id="example-request_36">Example Request</h3>
<pre><code>POST /my/machines/c2855c3a-a91d-46b8-9da6-6d7ab1bc6962 HTTP/1.1
Host: api.example.com
Authorization: ...
Accept: application/json
Content-Length: 12
Content-Type: application/x-www-form-urlencoded
Api-Version: ~8

action=start
</code></pre>
<h3 id="example-response_36">Example Response</h3>
<pre><code>HTTP/1.1 202 Accepted
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: POST, GET, HEAD, DELETE, PUT
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Date: Thu, 21 Jan 2016 13:07:24 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: e7fda2e0-c03f-11e5-a64c-d133f917673f
Response-Time: 3487
Transfer-Encoding: chunked
</code></pre>
<h2 id="rebootmachine-post-loginmachinesidactionreboot">RebootMachine (POST /:login/machines/:id?action=reboot)</h2>
<p>Allows you to reboot an instance.  POST to the instance name with an <code>action</code> of
<code>reboot</code>.</p>
<p>You can poll on <a href="#GetMachine">GetMachine</a> until the state is <code>running</code>.</p>
<h3 id="inputs_43">Inputs</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>action</td>
<td>String</td>
<td>Use the exact string "reboot"</td>
</tr>
</tbody>
</table>
<h3 id="returns_43">Returns</h3>
<ul>
<li>None</li>
</ul>
<h3 id="errors_43">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> or <code>:id</code> does not exist</td>
</tr>
<tr>
<td>InvalidState</td>
<td>The instance is in the wrong state to be stopped</td>
</tr>
<tr>
<td>InvalidArgument</td>
<td>If <code>action</code> was invalid</td>
</tr>
<tr>
<td>MissingParameter</td>
<td>If <code>action</code> wasn't provided</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_43">CLI Command</h3>
<pre><code>$ triton instance reboot c2855c3a-a91d-46b8-9da6-6d7ab1bc6962
</code></pre>
<p>or</p>
<pre><code>$ sdc-rebootmachine c2855c3a-a91d-46b8-9da6-6d7ab1bc6962
</code></pre>
<h3 id="example-request_37">Example Request</h3>
<pre><code>POST /my/machines/c2855c3a-a91d-46b8-9da6-6d7ab1bc6962 HTTP/1.1
Host: api.example.com
Authorization: ...
Accept: application/json
Content-Length: 12
Content-Type: application/x-www-form-urlencoded
Api-Version: ~8

action=reboot
</code></pre>
<h3 id="example-response_37">Example Response</h3>
<pre><code>HTTP/1.1 202 Accepted
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: POST, GET, HEAD, DELETE, PUT
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Date: Thu, 21 Jan 2016 13:09:34 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: 35679950-c040-11e5-b1b7-65fab9169f0e
Response-Time: 3124
Transfer-Encoding: chunked
</code></pre>
<h2 id="resizemachine-post-loginmachinesidactionresize">ResizeMachine (POST /:login/machines/:id?action=resize)</h2>
<p>Resize an instance to a new <a href="#packages">package</a> (a.k.a. instance type).</p>
<p>Resizing is only supported for containers (instances which are not hardware
virtual machines -- they have <code>brand=kvm</code> or <code>brand=bhyve</code>). Hardware virtual
machines cannot be resized.</p>
<p>Resizing is not guaranteed to work, especially when resizing upwards in
resources. It is best-effort, and may fail. Resizing downwards will usually
succeed.</p>
<h3 id="inputs_44">Inputs</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>action</td>
<td>String</td>
<td>Use the exact string "resize"</td>
</tr>
<tr>
<td>package</td>
<td>String</td>
<td>A package id, as returned from <a href="#ListPackages">ListPackages</a></td>
</tr>
</tbody>
</table>
<h3 id="returns_44">Returns</h3>
<ul>
<li>None</li>
</ul>
<h3 id="errors_44">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> or <code>:id</code> does not exist</td>
</tr>
<tr>
<td>InvalidState</td>
<td>The instance is in the wrong state to be resized</td>
</tr>
<tr>
<td>InvalidArgument</td>
<td>If <code>action</code> was invalid, or <code>package</code> wasn't a valid id or name</td>
</tr>
<tr>
<td>MissingParameter</td>
<td>If <code>action</code> or <code>package</code> wasn't provided</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_44">CLI Command</h3>
<pre><code>$ sdc-resizemachine --package=7041ccc7-3f9e-cf1e-8c85-a9ee41b7f968 c2855c3a-a91d-46b8-9da6-6d7ab1bc6962
</code></pre>
<h3 id="example-request_38">Example Request</h3>
<pre><code>POST /my/machines/c2855c3a-a91d-46b8-9da6-6d7ab1bc6962 HTTP/1.1
Host: api.example.com
Authorization: ...
Accept: application/json
Content-Length: 12
Content-Type: application/x-www-form-urlencoded
Api-Version: ~8

action=resize&amp;package=7041ccc7-3f9e-cf1e-8c85-a9ee41b7f968
</code></pre>
<h3 id="example-response_38">Example Response</h3>
<pre><code>HTTP/1.1 202 Accepted
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: POST, GET, HEAD, DELETE, PUT
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Date: Thu, 21 Jan 2016 13:12:06 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: 8fa7d8d0-c040-11e5-9100-a95edd60134e
Response-Time: 161
</code></pre>
<h2 id="renamemachine-post-loginmachinesidactionrename">RenameMachine (POST /:login/machines/:id?action=rename)</h2>
<p>Allows you to rename an instance.  POST to the instance <code>id</code> with an action of
<code>rename</code>.  You must additionally include a new name for the instance.</p>
<h3 id="inputs_45">Inputs</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>action</td>
<td>String</td>
<td>Use the exact string "rename"</td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td>The new "friendly" name for this instance</td>
</tr>
</tbody>
</table>
<h3 id="returns_45">Returns</h3>
<ul>
<li>None</li>
</ul>
<h3 id="errors_45">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> or <code>:id</code> does not exist</td>
</tr>
<tr>
<td>InvalidState</td>
<td>The instance is in the wrong state to be stopped</td>
</tr>
<tr>
<td>InvalidArgument</td>
<td>If <code>action</code> was invalid, or <code>name</code> wasn't a valid name</td>
</tr>
<tr>
<td>MissingParameter</td>
<td>If <code>action</code> or <code>name</code> wasn't provided</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_45">CLI Command</h3>
<pre><code>$ sdc-renamemachine --name=new_friendly_name c2855c3a-a91d-46b8-9da6-6d7ab1bc6962
</code></pre>
<h3 id="example-request_39">Example Request</h3>
<pre><code>POST /my/machines/c2855c3a-a91d-46b8-9da6-6d7ab1bc6962 HTTP/1.1
Host: api.example.com
Authorization: ...
Accept: application/json
Content-Length: 12
Content-Type: application/x-www-form-urlencoded
Api-Version: ~8

action=rename&amp;name=new_friendly_name
</code></pre>
<h3 id="example-response_39">Example Response</h3>
<pre><code>HTTP/1.1 202 Accepted
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: POST, GET, HEAD, DELETE, PUT
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Date: Thu, 21 Jan 2016 13:14:17 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: dda360e0-c040-11e5-a64c-d133f917673f
Response-Time: 3768
Transfer-Encoding: chunked
</code></pre>
<h2 id="enablemachinefirewall-post-loginmachinesidactionenable_firewall">EnableMachineFirewall (POST /:login/machines/:id?action=enable_firewall)</h2>
<p>Allows you to enable the firewall for an instance.</p>
<h3 id="inputs_46">Inputs</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>action</td>
<td>String</td>
<td>Use the exact string "enable_firewall"</td>
</tr>
</tbody>
</table>
<h3 id="returns_46">Returns</h3>
<ul>
<li>None</li>
</ul>
<h3 id="errors_46">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> or <code>:id</code> does not exist</td>
</tr>
<tr>
<td>InvalidState</td>
<td>The instance is in the wrong state to enable firewall</td>
</tr>
<tr>
<td>InvalidArgument</td>
<td>If <code>action</code> was invalid</td>
</tr>
<tr>
<td>MissingParameter</td>
<td>If <code>action</code> wasn't provided</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_46">CLI Command</h3>
<pre><code>$ triton instance enable-firewall c2855c3a-a91d-46b8-9da6-6d7ab1bc6962
</code></pre>
<p>or</p>
<pre><code>$ sdc-enablemachinefirewall c2855c3a-a91d-46b8-9da6-6d7ab1bc6962
</code></pre>
<h3 id="example-request_40">Example Request</h3>
<pre><code>POST /my/machines/c2855c3a-a91d-46b8-9da6-6d7ab1bc6962 HTTP/1.1
Host: api.example.com
Authorization: ...
Accept: application/json
Content-Length: 12
Content-Type: application/x-www-form-urlencoded
Api-Version: ~8

action=enable_firewall
</code></pre>
<h3 id="example-response_40">Example Response</h3>
<pre><code>HTTP/1.1 202 Accepted
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: POST, GET, HEAD, DELETE, PUT
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Date: Thu, 21 Jan 2016 13:16:00 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: 1b1e83a0-c041-11e5-b1b7-65fab9169f0e
Response-Time: 3594
Transfer-Encoding: chunked
</code></pre>
<h2 id="disablemachinefirewall-post-loginmachinesidactiondisable_firewall">DisableMachineFirewall (POST /:login/machines/:id?action=disable_firewall)</h2>
<p>Allows you to completely disable the firewall of an instance.</p>
<h3 id="inputs_47">Inputs</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>action</td>
<td>String</td>
<td>Use the exact string "disable_firewall"</td>
</tr>
</tbody>
</table>
<h3 id="returns_47">Returns</h3>
<ul>
<li>None</li>
</ul>
<h3 id="errors_47">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> or <code>:id</code> does not exist</td>
</tr>
<tr>
<td>InvalidState</td>
<td>The instance is in the wrong state to disable firewall</td>
</tr>
<tr>
<td>InvalidArgument</td>
<td>If <code>action</code> was invalid</td>
</tr>
<tr>
<td>MissingParameter</td>
<td>If <code>action</code> wasn't provided</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_47">CLI Command</h3>
<pre><code>$ triton instance disable-firewall c2855c3a-a91d-46b8-9da6-6d7ab1bc6962
</code></pre>
<p>or</p>
<pre><code>$ sdc-disablemachinefirewall c2855c3a-a91d-46b8-9da6-6d7ab1bc6962
</code></pre>
<h3 id="example-request_41">Example Request</h3>
<pre><code>POST /my/machines/c2855c3a-a91d-46b8-9da6-6d7ab1bc6962 HTTP/1.1
Host: api.example.com
Authorization: ...
Accept: application/json
Content-Length: 12
Content-Type: application/x-www-form-urlencoded
Api-Version: ~8

action=disable_firewall
</code></pre>
<h3 id="example-response_41">Example Response</h3>
<pre><code>HTTP/1.1 202 Accepted
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: POST, GET, HEAD, DELETE, PUT
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Date: Thu, 21 Jan 2016 13:23:39 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: 2c74e120-c042-11e5-9100-a95edd60134e
Response-Time: 4178
Transfer-Encoding: chunked
</code></pre>
<h2 id="enablemachinedeletionprotection-post-loginmachinesidactionenable_deletion_protection">EnableMachineDeletionProtection (POST /:login/machines/:id?action=enable_deletion_protection)</h2>
<p>Enable <a href="#deletion-protection">Deletion Protection</a> on an instance. An instance
can no longer be destroyed until the protection is disabled.</p>
<h3 id="inputs_48">Inputs</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>action</td>
<td>String</td>
<td>Use the exact string "enable_deletion_protection"</td>
</tr>
</tbody>
</table>
<h3 id="returns_48">Returns</h3>
<ul>
<li>None</li>
</ul>
<h3 id="errors_48">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> or <code>:id</code> does not exist</td>
</tr>
<tr>
<td>InvalidState</td>
<td>The instance is in the wrong state to enable firewall</td>
</tr>
<tr>
<td>InvalidArgument</td>
<td>If <code>action</code> was invalid</td>
</tr>
<tr>
<td>MissingParameter</td>
<td>If <code>action</code> wasn't provided</td>
</tr>
</tbody>
</table>
<h3 id="example-request_42">Example Request</h3>
<pre><code>POST /my/machines/c2855c3a-a91d-46b8-9da6-6d7ab1bc6962 HTTP/1.1
Host: api.example.com
Authorization: ...
Accept: application/json
Content-Length: 12
Content-Type: application/x-www-form-urlencoded
Api-Version: ~8

action=enable_deletion_protection
</code></pre>
<h3 id="example-response_42">Example Response</h3>
<pre><code>HTTP/1.1 202 Accepted
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: POST, GET, HEAD, DELETE, PUT
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Date: Thu, 21 Jan 2017 13:16:00 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: 1b1e83a0-c041-11e5-b1b7-65fab9169f0e
Response-Time: 3594
Transfer-Encoding: chunked
</code></pre>
<h2 id="disablemachinedeletionprotection-post-loginmachinesidactiondisable_deletion_protection">DisableMachineDeletionProtection (POST /:login/machines/:id?action=disable_deletion_protection)</h2>
<p>Disable <a href="#deletion-protection">Deletion Protection</a> on an instance. An instance
can be destroyed after it is disabled.</p>
<h3 id="inputs_49">Inputs</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>action</td>
<td>String</td>
<td>Use the exact string "disable_deletion_protection"</td>
</tr>
</tbody>
</table>
<h3 id="returns_49">Returns</h3>
<ul>
<li>None</li>
</ul>
<h3 id="errors_49">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> or <code>:id</code> does not exist</td>
</tr>
<tr>
<td>InvalidState</td>
<td>The instance is in the wrong state to disable firewall</td>
</tr>
<tr>
<td>InvalidArgument</td>
<td>If <code>action</code> was invalid</td>
</tr>
<tr>
<td>MissingParameter</td>
<td>If <code>action</code> wasn't provided</td>
</tr>
</tbody>
</table>
<h3 id="example-request_43">Example Request</h3>
<pre><code>POST /my/machines/c2855c3a-a91d-46b8-9da6-6d7ab1bc6962 HTTP/1.1
Host: api.example.com
Authorization: ...
Accept: application/json
Content-Length: 12
Content-Type: application/x-www-form-urlencoded
Api-Version: ~8

action=disable_deletion_protection
</code></pre>
<h3 id="example-response_43">Example Response</h3>
<pre><code>HTTP/1.1 202 Accepted
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: POST, GET, HEAD, DELETE, PUT
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Date: Thu, 21 Jan 2016 13:23:39 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: 2c74e120-c042-11e5-9100-a95edd60134e
Response-Time: 4178
Transfer-Encoding: chunked
</code></pre>
<h2 id="createmachinesnapshot-post-loginmachinesidsnapshots">CreateMachineSnapshot (POST /:login/machines/:id/snapshots)</h2>
<p>Allows you to take a snapshot of an instance.  Once you have one or more
snapshots, you can boot the instance from a previous snapshot.</p>
<p>Snapshots are not usable with other instances; they are a point-in-time snapshot
of the current instance. Snapshots can also only be taken of instances that are
<em>not</em> of brand 'kvm' or 'bhyve'.</p>
<p>Since instance instances use a copy-on-write filesystem, snapshots take up
increasing amounts of space as the filesystem changes over time. There is a
limit to how much space snapshots are allowed to take. Plan your snapshots
accordingly.</p>
<p>You can poll on <a href="#GetMachineSnapshot">GetMachineSnapshot</a> until the <code>state</code> is
<code>created</code>.</p>
<h3 id="inputs_50">Inputs</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>String</td>
<td>The name to assign to the new snapshot</td>
</tr>
</tbody>
</table>
<h3 id="returns_50">Returns</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>String</td>
<td>The name of this snapshot</td>
</tr>
<tr>
<td>state</td>
<td>String</td>
<td>The current state of the snapshot</td>
</tr>
</tbody>
</table>
<h3 id="errors_50">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> or <code>:id</code> does not exist</td>
</tr>
<tr>
<td>InvalidArgument</td>
<td>If <code>name</code> was invalid</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_48">CLI Command</h3>
<pre><code>$ triton instance snapshot create 5e42cd1e-34bb-402f-8796-bf5a2cae47db
</code></pre>
<p>or</p>
<pre><code>$ sdc-createmachinesnapshot --name=just-booted 5e42cd1e-34bb-402f-8796-bf5a2cae47db
</code></pre>
<h3 id="example-request_44">Example Request</h3>
<pre><code>POST /my/machines/5e42cd1e-34bb-402f-8796-bf5a2cae47db/snapshots HTTP/1.1
Authorization: ...
Host: api.example.com
Accept: application/json
Content-Length: 12
Content-Type: application/x-www-form-urlencoded
Api-Version: ~8

name=just-booted
</code></pre>
<h3 id="example-response_44">Example Response</h3>
<pre><code>HTTP/1.1 201 Created
Location: /mark/machines/5e42cd1e-34bb-402f-8796-bf5a2cae47db/snapshots/just-booted
Access-Control-Allow-Origin: *
Access-Control-Allow-Methods: GET, POST
Connection: close
Date: Tue, 05 Jul 2011 17:19:26 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: 4bcf467e-4b88-4ab4-b7ab-65fad7464de9
Response-Time: 754
Content-Type: application/json
Content-MD5: qKVbfrhXVqh7Oni6Pub9Pw==
Content-Length: 116

{
  "name": "just-booted",
  "state": "queued",
  "created": "2011-07-05T17:19:26+00:00",
  "updated": "2011-07-05T17:19:26+00:00"
}
</code></pre>
<h2 id="startmachinefromsnapshot-post-loginmachinesidsnapshotsname">StartMachineFromSnapshot (POST /:login/machines/:id/snapshots/:name)</h2>
<p>If an instance is in the 'stopped' state, you can choose to start the instance
from the referenced snapshot. This is effectively a means to roll back instance
state.</p>
<h3 id="inputs_51">Inputs</h3>
<ul>
<li>None</li>
</ul>
<h3 id="returns_51">Returns</h3>
<ul>
<li>None</li>
</ul>
<h3 id="errors_51">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code>, <code>:id</code> or <code>:name</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_49">CLI Command</h3>
<pre><code>$ triton instance start --snapshot=just-booted 5e42cd1e-34bb-402f-8796-bf5a2cae47db
</code></pre>
<p>or</p>
<pre><code>$ sdc-startmachinefromsnapshot --snapshot=just-booted 5e42cd1e-34bb-402f-8796-bf5a2cae47db
</code></pre>
<h3 id="example-request_45">Example Request</h3>
<pre><code>POST /my/machines/5e42cd1e-34bb-402f-8796-bf5a2cae47db/snapshots/just-booted HTTP/1.1
Authorization: ...
Host: api.example.com
Accept: application/json
Content-Length: 0
Content-Type: application/x-www-form-urlencoded
Api-Version: ~8
</code></pre>
<h3 id="example-response_45">Example Response</h3>
<pre><code>HTTP/1.1 202 Accepted
Access-Control-Allow-Origin: *
Access-Control-Allow-Methods: GET, POST, DELETE
Connection: close
Date: Tue, 05 Jul 2011 17:26:56 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: af79d9cd-68c5-4002-95c6-af4c3ff0f1e4
Response-Time: 297
Content-Length: 0
</code></pre>
<h2 id="listmachinesnapshots-get-loginmachinesidsnapshots">ListMachineSnapshots (GET /:login/machines/:id/snapshots)</h2>
<p>Lists all snapshots taken for a given instance.  There are no filtration
parameters for this API.</p>
<h3 id="inputs_52">Inputs</h3>
<ul>
<li>None</li>
</ul>
<h3 id="returns_52">Returns</h3>
<p>An array of snapshots:</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>String</td>
<td>The name of this snapshot</td>
</tr>
<tr>
<td>state</td>
<td>String</td>
<td>The current state of the snapshot</td>
</tr>
<tr>
<td>size</td>
<td>Number</td>
<td>The size of the snapshot (MiB)</td>
</tr>
</tbody>
</table>
<h3 id="errors_52">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> or <code>:id</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_50">CLI Command</h3>
<pre><code>$ triton instance snapshot list 5e42cd1e-34bb-402f-8796-bf5a2cae47db
</code></pre>
<p>or</p>
<pre><code>$ sdc-listmachinesnapshots 5e42cd1e-34bb-402f-8796-bf5a2cae47db
</code></pre>
<h3 id="example-request_46">Example Request</h3>
<pre><code>GET /my/machines/5e42cd1e-34bb-402f-8796-bf5a2cae47db/snapshots HTTP/1.1
Authorization: ...
Host: api.example.com
Accept: application/json
Content-Length: 0
Content-Type: application/x-www-form-urlencoded
Api-Version: ~8
</code></pre>
<h3 id="example-response_46">Example Response</h3>
<pre><code>HTTP/1.1 200 Ok
Access-Control-Allow-Origin: *
Access-Control-Allow-Methods: GET, POST
Connection: close
Date: Tue, 05 Jul 2011 17:19:26 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: 06a57272-9238-4276-951b-4123fbfdb948
Response-Time: 66
Content-Type: application/json
Content-MD5: UYdtqgRjRZVikfCM5Uf4XQ==
Content-Length: 119

[
  {
    "name": "just-booted",
    "state": "queued",
    "created": "2011-07-05T17:19:26+00:00",
    "updated": "2011-07-05T17:19:26+00:00"
  }
]
</code></pre>
<h2 id="getmachinesnapshot-get-loginmachinesidsnapshotsname">GetMachineSnapshot (GET /:login/machines/:id/snapshots/:name)</h2>
<p>Gets the state of the named snapshot.</p>
<h3 id="inputs_53">Inputs</h3>
<ul>
<li>None</li>
</ul>
<h3 id="returns_53">Returns</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>String</td>
<td>The name of this snapshot</td>
</tr>
<tr>
<td>state</td>
<td>String</td>
<td>The current state of the snapshot (poll until it's "created")</td>
</tr>
</tbody>
</table>
<h3 id="errors_53">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code>, <code>:id</code> or <code>:name</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_51">CLI Command</h3>
<pre><code>$ triton instance snapshot get 5e42cd1e-34bb-402f-8796-bf5a2cae47db just-booted
</code></pre>
<p>or</p>
<pre><code>$ sdc-getmachinesnapshot --snapshot=just-booted 5e42cd1e-34bb-402f-8796-bf5a2cae47db
</code></pre>
<h3 id="example-request_47">Example Request</h3>
<pre><code>GET /my/machines/5e42cd1e-34bb-402f-8796-bf5a2cae47db/snapshots/just-booted HTTP/1.1
Authorization: ...
Host: api.example.com
Accept: application/json
Content-Length: 0
Content-Type: application/x-www-form-urlencoded
Api-Version: ~8
</code></pre>
<h3 id="example-response_47">Example Response</h3>
<pre><code>HTTP/1.1 200 OK
Access-Control-Allow-Origin: *
Access-Control-Allow-Methods: GET, POST, DELETE
Connection: close
Date: Tue, 05 Jul 2011 17:26:56 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: af79d9cd-68c5-4002-95c6-af4c3ff0f1e4
Response-Time: 297
Content-Type: application/json
Content-MD5: VoPeS9cac4YMBIs8gUkd/A==
Content-Length: 117

{
  "name": "just-booted",
  "state": "queued",
  "created": "2011-07-05T17:19:26+00:00",
  "updated": "2011-07-05T17:19:26+00:00"
}
</code></pre>
<h2 id="deletemachinesnapshot-delete-loginmachinesidsnapshotsname">DeleteMachineSnapshot (DELETE /:login/machines/:id/snapshots/:name)</h2>
<p>Deletes the specified snapshot of an instance.</p>
<h3 id="inputs_54">Inputs</h3>
<ul>
<li>None</li>
</ul>
<h3 id="returns_54">Returns</h3>
<ul>
<li>None</li>
</ul>
<h3 id="errors_54">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code>, <code>:id</code> or <code>:name</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_52">CLI Command</h3>
<pre><code>$ triton instance snapshot delete 5e42cd1e-34bb-402f-8796-bf5a2cae47db just-booted
</code></pre>
<p>or</p>
<pre><code>$ sdc-deletemachinesnapshot --snapshot=just-booted 5e42cd1e-34bb-402f-8796-bf5a2cae47db
</code></pre>
<h3 id="example-request_48">Example Request</h3>
<pre><code>DELETE /my/machines/5e42cd1e-34bb-402f-8796-bf5a2cae47db/snapshots/just-booted HTTP/1.1
Authorization: ...
Host: api.example.com
Accept: application/json
Content-Length: 0
Content-Type: application/x-www-form-urlencoded
Api-Version: ~8
</code></pre>
<h3 id="example-response_48">Example Response</h3>
<pre><code>HTTP/1.1 204 No Content
Access-Control-Allow-Origin: *
Access-Control-Allow-Methods: GET, POST, DELETE
Connection: close
Date: Tue, 05 Jul 2011 17:26:56 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: af79d9cd-68c5-4002-95c6-af4c3ff0f1e4
Response-Time: 297
Content-Length: 0
</code></pre>
<h2 id="createmachinedisk-post-loginmachinesiddisks">CreateMachineDisk (POST /:login/machines/:id/disks)</h2>
<p><strong>Interface is experimental; details may change in the future</strong></p>
<p>Create a new disk for a bhyve VM.</p>
<p>The sum of all disk sizes on a VM is limited by flexible disk space. This
operation only applies for VMs that are currently stopped.</p>
<h3 id="inputs_55">Inputs</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>pci_slot</td>
<td>String</td>
<td>Optional, PCI slot that the disk will fill</td>
</tr>
<tr>
<td>size</td>
<td>Number</td>
<td>Size in MiB, or the string "remaining" to use up all remaining available space</td>
</tr>
</tbody>
</table>
<h3 id="returns_55">Returns</h3>
<p>If no <code>pci_slot</code> argument was provided, then only a 202 (and no object) will
be returned. You will need to poll <a href="#list-machine-disks">ListMachineDisks</a>
until a new disk appears (if successful). <code>pci_slot</code> will be automatically
assigned in this case.</p>
<p>If a <code>pci_slot</code> argument was provided, the <code>Location</code> header will be set, and
200 (with object) will be returned:</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>String</td>
<td>This disk's UUID</td>
</tr>
<tr>
<td>pci_slot</td>
<td>String</td>
<td>This disk's PCI slot</td>
</tr>
<tr>
<td>size</td>
<td>Number</td>
<td>Size in MiB (before resize)</td>
</tr>
<tr>
<td>boot</td>
<td>Boolean</td>
<td>If this is the VM's boot disk</td>
</tr>
<tr>
<td>state</td>
<td>String</td>
<td>Current state of disk (i.e. 'creating')</td>
</tr>
</tbody>
</table>
<h3 id="errors_55">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> or <code>:id</code>  does not exist</td>
</tr>
<tr>
<td>InvalidArgument</td>
<td>If <code>size</code> or <code>pci_slot</code> was invalid</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_53">CLI Command</h3>
<pre><code>$ triton cloudapi /my/machines/5e42cd1e-34bb-402f-8796-bf5a2cae47db/disks \
  -X POST -d '{"pci_slot":"0:4:1", "size": 1024}'
</code></pre>
<h3 id="example-request_49">Example Request</h3>
<pre><code>POST /my/machines/5e42cd1e-34bb-402f-8796-bf5a2cae47db/disks HTTP/1.1
Authorization: ...
Host: api.example.com
Accept: application/json
Content-Length: 12
Content-Type: application/x-www-form-urlencoded
Api-Version: ~9

pci_slot=0:4:1
size=1024
</code></pre>
<h3 id="example-response_49">Example Response</h3>
<pre><code>HTTP/1.1 200 OK
Access-Control-Allow-Origin: *
Access-Control-Allow-Methods: GET, POST
Connection: close
Date: Tue, 05 Dec 2018 17:19:26 GMT
Server: Joyent Triton 9.4.0
Api-Version: 9.0.0
Request-Id: 4bcf467e-4b88-4ab4-b7ab-65fad7464de9
Response-Time: 754
Content-Type: application/json
Content-Length: 0

{
  "id": "21f04764-1db8-47dc-acfd-2215f2b842e9",
  "pci_slot": "0:4:1",
  "size": 1024,
  "boot": false,
  "state": "creating"
}
</code></pre>
<h2 id="resizemachinedisk-post-loginmachinesiddisksdisk_id">ResizeMachineDisk (POST /:login/machines/:id/disks/:disk_id)</h2>
<p><strong>Interface is experimental; details may change in the future</strong></p>
<p>Asynchronously resize an existing disk on a bhyve VM.</p>
<p>The sum of all disk sizes on a VM is limited by flexible disk space. This
operation only applies for VMs that are currently stopped.</p>
<p>When resizing down, <code>dangerous_allow_shrink</code> must be set to <code>true</code> otherwise
the resize will be rejected. Since shrinking a disk truncates any data within
that disk, it can cause filesystem corruption and data loss if the guest
operating system does not handle it appropriately and data on the disk hasn't
been prepared properly beforehand.</p>
<p>Since this is an asynchronous operation, resizing may take several seconds.
Check the disk's state using <a href="#GetMachineDisk">GetMachineDisk</a>.</p>
<h3 id="inputs_56">Inputs</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>size</td>
<td>Number</td>
<td>Size in MiB</td>
</tr>
<tr>
<td>dangerous_allow_shrink</td>
<td>Boolean</td>
<td>Optional, whether a disk can reduce size</td>
</tr>
</tbody>
</table>
<h3 id="returns_56">Returns</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>String</td>
<td>This disk's UUID</td>
</tr>
<tr>
<td>pci_slot</td>
<td>String</td>
<td>This disk's PCI slot</td>
</tr>
<tr>
<td>size</td>
<td>Number</td>
<td>Size in MiB (before resize)</td>
</tr>
<tr>
<td>boot</td>
<td>Boolean</td>
<td>If this is the VM's boot disk</td>
</tr>
<tr>
<td>state</td>
<td>String</td>
<td>Current state of disk (i.e. 'resizing')</td>
</tr>
</tbody>
</table>
<h3 id="errors_56">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code>, <code>:id</code>, or <code>:disk_id</code> does not exist</td>
</tr>
<tr>
<td>InvalidArgument</td>
<td>If <code>size</code> or <code>dangerous_allow_shrink</code> was invalid</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_54">CLI Command</h3>
<pre><code>$ triton cloudapi /my/machines/5e42cd1e-34bb-402f-8796-bf5a2cae47db/disks/21f04764-1db8-47dc-acfd-2215f2b842e9 \
  -X POST -d '{"size": 2048}'
</code></pre>
<h3 id="example-request_50">Example Request</h3>
<pre><code>POST /my/machines/5e42cd1e-34bb-402f-8796-bf5a2cae47db/disks/21f04764-1db8-47dc-acfd-2215f2b842e9 HTTP/1.1
Authorization: ...
Host: api.example.com
Accept: application/json
Content-Length: 12
Content-Type: application/x-www-form-urlencoded
Api-Version: ~9

size=2048
</code></pre>
<h3 id="example-response_50">Example Response</h3>
<pre><code>HTTP/1.1 200 OK
Access-Control-Allow-Origin: *
Access-Control-Allow-Methods: GET, POST
Connection: close
Date: Tue, 05 Dec 2018 17:19:26 GMT
Server: Joyent Triton 9.4.0
Api-Version: 9.0.0
Request-Id: 4bcf467e-4b88-4ab4-b7ab-65fad7464de9
Response-Time: 754
Content-Type: application/json
Content-MD5: qKVbfrhXVqh7Oni6Pub9Pw==
Content-Length: 70

{
  "id": "21f04764-1db8-47dc-acfd-2215f2b842e9",
  "pci_slot": "0:4:1",
  "size": 1024,
  "boot": false,
  "state": "resizing"
}
</code></pre>
<h2 id="getmachinedisk-get-loginmachinesiddisksdisk_id">GetMachineDisk (GET /:login/machines/:id/disks/:disk_id)</h2>
<p><strong>Interface is experimental; details may change in the future</strong></p>
<p>Fetch a specific disk on a bhyve VM.</p>
<h3 id="inputs_57">Inputs</h3>
<ul>
<li>None</li>
</ul>
<h3 id="returns_57">Returns</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>String</td>
<td>This disk's UUID</td>
</tr>
<tr>
<td>pci_slot</td>
<td>String</td>
<td>This disk's PCI slot</td>
</tr>
<tr>
<td>size</td>
<td>Number</td>
<td>Size in MiB</td>
</tr>
<tr>
<td>boot</td>
<td>Boolean</td>
<td>If this is the VM's boot disk</td>
</tr>
<tr>
<td>state</td>
<td>String</td>
<td>Current state of disk</td>
</tr>
</tbody>
</table>
<h3 id="errors_57">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code>, <code>:id</code>, or <code>:disk_id</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_55">CLI Command</h3>
<pre><code>$ triton cloudapi /my/machines/5e42cd1e-34bb-402f-8796-bf5a2cae47db/disks/21f04764-1db8-47dc-acfd-2215f2b842e9
</code></pre>
<h3 id="example-request_51">Example Request</h3>
<pre><code>GET /my/machines/5e42cd1e-34bb-402f-8796-bf5a2cae47db/disks/21f04764-1db8-47dc-acfd-2215f2b842e9 HTTP/1.1
Authorization: ...
Host: api.example.com
Accept: application/json
Content-Length: 12
Content-Type: application/x-www-form-urlencoded
Api-Version: ~9
</code></pre>
<h3 id="example-response_51">Example Response</h3>
<pre><code>HTTP/1.1 200 OK
Access-Control-Allow-Origin: *
Access-Control-Allow-Methods: GET, POST
Connection: close
Date: Tue, 05 Dec 2018 17:19:26 GMT
Server: Joyent Triton 9.4.0
Api-Version: 9.0.0
Request-Id: 4bcf467e-4b88-4ab4-b7ab-65fad7464de9
Response-Time: 754
Content-Type: application/json
Content-MD5: qKVbfrhXVqh7Oni6Pub9Pw==
Content-Length: 74

{
  "id": "21f04764-1db8-47dc-acfd-2215f2b842e9",
  "pci_slot": "0:4:1",
  "size": 2048,
  "boot": false,
  "state": "running",
}
</code></pre>
<h2 id="listmachinedisks-get-loginmachinesiddisks">ListMachineDisks (GET /:login/machines/:id/disks)</h2>
<p><strong>Interface is experimental; details may change in the future</strong></p>
<p>List all disk on a bhyve VM.</p>
<h3 id="inputs_58">Inputs</h3>
<ul>
<li>None</li>
</ul>
<h3 id="returns_58">Returns</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>String</td>
<td>This disk's UUID</td>
</tr>
<tr>
<td>pci_slot</td>
<td>String</td>
<td>This disk's PCI slot</td>
</tr>
<tr>
<td>size</td>
<td>Number</td>
<td>Size in MiB</td>
</tr>
<tr>
<td>boot</td>
<td>Boolean</td>
<td>If this is the VM's boot disk</td>
</tr>
<tr>
<td>state</td>
<td>String</td>
<td>Current state of disk</td>
</tr>
</tbody>
</table>
<h3 id="errors_58">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> or <code>:id</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_56">CLI Command</h3>
<pre><code>$ triton cloudapi /my/machines/5e42cd1e-34bb-402f-8796-bf5a2cae47db/disks
</code></pre>
<h3 id="example-request_52">Example Request</h3>
<pre><code>GET /my/machines/5e42cd1e-34bb-402f-8796-bf5a2cae47db/disks HTTP/1.1
Authorization: ...
Host: api.example.com
Accept: application/json
Content-Length: 12
Content-Type: application/x-www-form-urlencoded
Api-Version: ~9
</code></pre>
<h3 id="example-response_52">Example Response</h3>
<pre><code>HTTP/1.1 200 OK
Access-Control-Allow-Origin: *
Access-Control-Allow-Methods: GET, POST
Connection: close
Date: Tue, 05 Dec 2018 17:19:26 GMT
Server: Joyent Triton 9.4.0
Api-Version: 9.0.0
Request-Id: 4bcf467e-4b88-4ab4-b7ab-65fad7464de9
Response-Time: 754
Content-Type: application/json
Content-MD5: qKVbfrhXVqh7Oni6Pub9Pw==
Content-Length: 74

[
  {
    "id": "2bb08ea6-1da0-11e9-adaa-23f0e1aab5d7",
    "pci_slot": "0:4:0",
    "size": 10240,
    "boot": true,
    "state": "running",
  },
  {
    "id": "21f04764-1db8-47dc-acfd-2215f2b842e9",
    "pci_slot": "0:4:1",
    "size": 2048,
    "boot": false,
    "state": "running",
  }
]
</code></pre>
<h2 id="deletemachinedisk-delete-loginmachinesiddisksdisk_id">DeleteMachineDisk (DELETE /:login/machines/:id/disks/:disk_id)</h2>
<p><strong>Interface is experimental; details may change in the future</strong></p>
<p>Asynchronously delete a disk off a bhyve VM.</p>
<p>Since this is an asynchronous operation, deletion may take several seconds.
You can check the disk's state using <a href="#GetMachineDisk">GetMachineDisk</a>.</p>
<h3 id="inputs_59">Inputs</h3>
<ul>
<li>None</li>
</ul>
<h3 id="returns_59">Returns</h3>
<ul>
<li>None</li>
</ul>
<h3 id="errors_59">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code>, <code>:id</code> or <code>:disk_id</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_57">CLI Command</h3>
<pre><code>$ triton cloudapi /my/machines/5e42cd1e-34bb-402f-8796-bf5a2cae47db/disks/21f04764-1db8-47dc-acfd-2215f2b842e9 -X DELETE
</code></pre>
<h3 id="example-request_53">Example Request</h3>
<pre><code>DELETE /my/machines/5e42cd1e-34bb-402f-8796-bf5a2cae47db/disks/21f04764-1db8-47dc-acfd-2215f2b842e9 HTTP/1.1
Authorization: ...
Host: api.example.com
Accept: application/json
Content-Length: 12
Content-Type: application/x-www-form-urlencoded
Api-Version: ~9
</code></pre>
<h3 id="example-response_53">Example Response</h3>
<pre><code>HTTP/1.1 204 No Content
Access-Control-Allow-Origin: *
Access-Control-Allow-Methods: GET, POST
Connection: close
Date: Tue, 05 Dec 2018 17:19:26 GMT
Server: Joyent Triton 9.4.0
Api-Version: 9.0.0
Request-Id: 4bcf467e-4b88-4ab4-b7ab-65fad7464de9
Response-Time: 754
</code></pre>
<h2 id="updatemachinemetadata-post-loginmachinesidmetadata">UpdateMachineMetadata (POST /:login/machines/:id/metadata)</h2>
<p>Allows you to update the metadata for a given instance.  Note that updating the
metadata via CloudAPI will result in the metadata being updated in the running
instance.</p>
<p>The semantics of this call are subtly different that the AddMachineTags call --
any metadata keys passed in here are created if they do not exist, and
overwritten if they do.</p>
<h3 id="inputs_60">Inputs</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>$key</td>
<td>String</td>
<td>You can assign any number of metadata keys in this call; the string can be either a plain string, or a JSON-encoded object</td>
</tr>
</tbody>
</table>
<h3 id="returns_60">Returns</h3>
<p>Returns the current set of tags.</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>$key</td>
<td>Object</td>
<td>Your value(s)</td>
</tr>
</tbody>
</table>
<h3 id="errors_60">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> or <code>:id</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_58">CLI Command</h3>
<pre><code>$ sdc-updatemachinemetadata -m foo=bar -m group=test cf055959-d776-482e-bd71-ca510a04bdd7
</code></pre>
<h3 id="example-request_54">Example Request</h3>
<pre><code>POST /my/machines/cf055959-d776-482e-bd71-ca510a04bdd7/metadata HTTP/1.1
Authorization: ...
Host: api.example.com
Accept: application/json
Content-Length: 12
Content-Type: application/x-www-form-urlencoded
Api-Version: ~8

foo=bar&amp;group=test
</code></pre>
<h3 id="example-response_54">Example Response</h3>
<pre><code>HTTP/1.1 200 Ok
Access-Control-Allow-Origin: *
Access-Control-Allow-Methods: GET, POST
Connection: close
Date: Tue, 05 Jul 2011 17:19:26 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: 4bcf467e-4b88-4ab4-b7ab-65fad7464de9
Response-Time: 754
Content-Type: application/json
Content-MD5: qKVbfrhXVqh7Oni6Pub9Pw==
Content-Length: 116

{
  "foo": "bar",
  "group": "test"
}
</code></pre>
<h2 id="listmachinemetadata-get-loginmachinesidmetadata">ListMachineMetadata (GET /:login/machines/:id/metadata)</h2>
<p>Returns the complete set of metadata associated with this instance.</p>
<h3 id="inputs_61">Inputs</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>credentials</td>
<td>Boolean</td>
<td>Whether or not to return instance credentials. Defaults to false</td>
</tr>
</tbody>
</table>
<h3 id="returns_61">Returns</h3>
<p>Returns the current metadata object</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>$name</td>
<td>Object</td>
<td>Your metadata</td>
</tr>
</tbody>
</table>
<h3 id="errors_61">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> or <code>:id</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_59">CLI Command</h3>
<pre><code>$ sdc-listmachinemetadata cf055959-d776-482e-bd71-ca510a04bdd7
</code></pre>
<h3 id="example-request_55">Example Request</h3>
<pre><code>GET /my/machines/cf055959-d776-482e-bd71-ca510a04bdd7/metadata?credentials=true HTTP/1.1
Authorization: ...
Host: api.example.com
Accept: application/json
Api-Version: ~8
</code></pre>
<h3 id="example-response_55">Example Response</h3>
<pre><code>HTTP/1.1 200 Ok
Access-Control-Allow-Origin: *
Access-Control-Allow-Methods: GET, POST
Connection: close
Date: Tue, 05 Jul 2011 17:19:26 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: 4bcf467e-4b88-4ab4-b7ab-65fad7464de9
Response-Time: 754
Content-Type: application/json
Content-MD5: qKVbfrhXVqh7Oni6Pub9Pw==
Content-Length: 116

{
  "foo": "bar",
  "group": "test",
  "credentials": {
    "root": "s8v9kuht5e",
    "admin": "mf4bteqhpy"
  }
}
</code></pre>
<h2 id="getmachinemetadata-get-loginmachinesidmetadatakey">GetMachineMetadata (GET /:login/machines/:id/metadata/:key)</h2>
<p>Returns a single metadata entry associated with this instance.</p>
<h3 id="inputs_62">Inputs</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>key</td>
<td>String</td>
<td>Name of metadata value to retrieve</td>
</tr>
</tbody>
</table>
<h3 id="returns_62">Returns</h3>
<p>Returns metadata value as string.</p>
<h3 id="errors_62">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code>, <code>:id</code> or <code>:key</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_60">CLI Command</h3>
<pre><code>$ sdc-getmachinemetadata --metadataId=foo cf055959-d776-482e-bd71-ca510a04bdd7
</code></pre>
<h3 id="example-request_56">Example Request</h3>
<pre><code>GET /my/machines/cf055959-d776-482e-bd71-ca510a04bdd7/metadata/foo HTTP/1.1
Authorization: ...
Host: api.example.com
Accept: application/json
Api-Version: ~8
</code></pre>
<h3 id="example-response_56">Example Response</h3>
<pre><code>HTTP/1.1 200 Ok
Access-Control-Allow-Origin: *
Access-Control-Allow-Methods: GET, POST
Connection: close
Date: Tue, 05 Jul 2014 17:19:26 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: 4bcf467e-4b88-4ab4-b7ab-65fad7464de9
Response-Time: 754
Content-Type: application/json
Content-MD5: qKVbfrhXVqh7Oni6Pub9Pw==
Content-Length: 4

bar
</code></pre>
<h2 id="deletemachinemetadata-delete-loginmachinesidmetadatakey">DeleteMachineMetadata (DELETE /:login/machines/:id/metadata/:key)</h2>
<p>Deletes a single metadata key from this instance.</p>
<h3 id="inputs_63">Inputs</h3>
<ul>
<li>None</li>
</ul>
<h3 id="returns_63">Returns</h3>
<ul>
<li>None</li>
</ul>
<h3 id="errors_63">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code>, <code>:id</code> or <code>:key</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_61">CLI Command</h3>
<pre><code>$ sdc-deletemachinemetadata --metadata=foo cf055959-d776-482e-bd71-ca510a04bdd7
</code></pre>
<h3 id="example-request_57">Example Request</h3>
<pre><code>DELETE /my/machines/cf055959-d776-482e-bd71-ca510a04bdd7/metadata/foo HTTP/1.1
Authorization: ...
Host: api.example.com
Accept: application/json
Api-Version: ~8
</code></pre>
<h3 id="example-response_57">Example Response</h3>
<pre><code>HTTP/1.1 204 No Content
Access-Control-Allow-Origin: *
Access-Control-Allow-Methods: GET, POST
Connection: close
Date: Tue, 05 Jul 2011 17:19:26 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: 4bcf467e-4b88-4ab4-b7ab-65fad7464de9
Response-Time: 754
Content-Type: application/json
Content-MD5: qKVbfrhXVqh7Oni6Pub9Pw==
Content-Length: 0
</code></pre>
<h2 id="deleteallmachinemetadata-delete-loginmachinesidmetadata">DeleteAllMachineMetadata (DELETE /:login/machines/:id/metadata)</h2>
<p>Deletes all metadata keys from this instance.</p>
<h3 id="inputs_64">Inputs</h3>
<ul>
<li>None</li>
</ul>
<h3 id="returns_64">Returns</h3>
<ul>
<li>None</li>
</ul>
<h3 id="errors_64">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> or <code>:id</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_62">CLI Command</h3>
<pre><code>$ sdc-deletemachinemetadata --metadata='*' cf055959-d776-482e-bd71-ca510a04bdd7
</code></pre>
<p>If you're running in a Unix-like environment, you may need to quote the wildcard
to keep the shell from matching files in the current directory.</p>
<h3 id="example-request_58">Example Request</h3>
<pre><code>DELETE /my/machines/cf055959-d776-482e-bd71-ca510a04bdd7/metadata HTTP/1.1
Authorization: ...
Host: api.example.com
Accept: application/json
Api-Version: ~8
</code></pre>
<h3 id="example-response_58">Example Response</h3>
<pre><code>HTTP/1.1 204 No Content
Access-Control-Allow-Origin: *
Access-Control-Allow-Methods: GET, POST
Connection: close
Date: Tue, 05 Jul 2011 17:19:26 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: 4bcf467e-4b88-4ab4-b7ab-65fad7464de9
Response-Time: 754
Content-Type: application/json
Content-MD5: qKVbfrhXVqh7Oni6Pub9Pw==
Content-Length: 0
</code></pre>
<h2 id="addmachinetags-post-loginmachinesidtags">AddMachineTags (POST /:login/machines/:id/tags)</h2>
<p>Set tags on the given instance. A pre-existing tag with the same name as one
given will be overwritten.</p>
<p>Note: This action is asynchronous. You can poll on <code>ListMachineTags</code> to wait for
the update to be complete (the <code>triton instance tag set -w,--wait</code> option does
this).</p>
<h3 id="inputs_65">Inputs</h3>
<p>Tag name/value pairs. Input data is typically as a application/json POST body.
However, query params or <code>application/x-www-form-urlencoded</code>-encoded body also
works. Tag values may be strings, numbers or booleans.</p>
<h3 id="returns_65">Returns</h3>
<p>Returns the resultant set of tags as a JSON object.</p>
<h3 id="errors_65">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> or <code>:id</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_63">CLI Command</h3>
<p>Using node-triton:</p>
<pre><code>$ triton instance tag set -w 5e42cd1e foo=bar group=test
</code></pre>
<p>Using node-smartdc:</p>
<pre><code>$ sdc-addmachinetags --tag='foo=bar' --tag='group=test' 5e42cd1e-34bb-402f-8796-bf5a2cae47db
</code></pre>
<h3 id="example-request_59">Example Request</h3>
<pre><code>POST /my/machines/5e42cd1e-34bb-402f-8796-bf5a2cae47db/tags HTTP/1.1
Host: us-east-3b.api.joyent.com
date: Thu, 11 Feb 2016 18:03:46 GMT
authorization: ...
accept: application/json
content-type: application/json
accept-version: ~8||~7
content-length: 28

{"foo":"bar","group":"test"}
</code></pre>
<h3 id="example-response_59">Example Response</h3>
<pre><code>HTTP/1.1 200 OK
server: Joyent Triton 8.0.0
request-id: cb65c530-d0e9-11e5-ac0c-090497b36c30
date: Thu, 11 Feb 2016 18:03:46 GMT
response-time: 91
...
api-version: 8.0.0
content-length: 48

{"foo":"bar","group":"test","preexiting":"blah"}
</code></pre>
<h2 id="replacemachinetags-put-loginmachinesidtags">ReplaceMachineTags (PUT /:login/machines/:id/tags)</h2>
<p>Fully replace all tags on an instance with the given tags.</p>
<p>Note: This action is asynchronous. You can poll on <code>ListMachineTags</code> to wait for
the update to be complete (the <code>triton instance tag replace-all -w,--wait</code>
option does this).</p>
<h3 id="inputs_66">Inputs</h3>
<p>Input data is typically as a application/json POST body. However, query params
or <code>application/x-www-form-urlencoded</code>-encoded body also works. Tag values
may be strings, numbers or booleans.</p>
<h3 id="returns_66">Returns</h3>
<p>Returns the resultant set of tags as a JSON object.</p>
<h3 id="errors_66">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> or <code>:id</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_64">CLI Command</h3>
<p>Using node-triton:</p>
<pre><code>$ triton instance tag replace-all -w 5e42cd1e foo=bar group=test
</code></pre>
<p>Using node-smartdc:</p>
<pre><code>$ sdc-replacemachinetags --tag='foo=bar' --tag='group=test' 5e42cd1e-34bb-402f-8796-bf5a2cae47db
</code></pre>
<h3 id="example-request_60">Example Request</h3>
<pre><code>POST /my/machines/5e42cd1e-34bb-402f-8796-bf5a2cae47db/tags HTTP/1.1
Host: us-east-3b.api.joyent.com
date: Thu, 11 Feb 2016 18:03:46 GMT
authorization: ...
accept: application/json
content-type: application/json
accept-version: ~8||~7
content-length: 28

{"foo":"bar","group":"test"}
</code></pre>
<h3 id="example-response_60">Example Response</h3>
<pre><code>HTTP/1.1 200 OK
server: Joyent Triton 8.0.0
request-id: cb65c530-d0e9-11e5-ac0c-090497b36c30
date: Thu, 11 Feb 2016 18:03:46 GMT
response-time: 91
...
api-version: 8.0.0
content-length: 28

{"foo":"bar","group":"test"}
</code></pre>
<h2 id="listmachinetags-get-loginmachinesidtags">ListMachineTags (GET /:login/machines/:id/tags)</h2>
<p>Returns the complete set of tags associated with this instance.</p>
<h3 id="inputs_67">Inputs</h3>
<p>None.</p>
<h3 id="returns_67">Returns</h3>
<p>Returns the current set of tags as a JSON object.</p>
<h3 id="errors_67">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> or <code>:id</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_65">CLI Command</h3>
<p>Using node-triton:</p>
<pre><code>$ triton instance tag list 5e42cd1e
{
    "foo": "bar",
    "group": "test"
}
$ triton instance tags 5e42cd1e    # shortcut
{
    "foo": "bar",
    "group": "test"
}
</code></pre>
<p>Using node-smartdc:</p>
<pre><code>$ sdc-listmachinetags 5e42cd1e-34bb-402f-8796-bf5a2cae47db
</code></pre>
<h3 id="example-request_61">Example Request</h3>
<pre><code>GET /my/machines/5e42cd1e-34bb-402f-8796-bf5a2cae47db/tags HTTP/1.1
Host: api.example.com
authorization: ...
accept: application/json
accept-version: ~8||~7
</code></pre>
<h3 id="example-response_61">Example Response</h3>
<pre><code>HTTP/1.1 200 OK
server: Joyent Triton 8.0.0
request-id: 4bcf467e-4b88-4ab4-b7ab-65fad7464de9
date: Thu, 11 Feb 2016 18:03:46 GMT
response-time: 91
...
api-version: 8.0.0
content-length: 28

{"foo":"bar","group":"test"}
</code></pre>
<h2 id="getmachinetag-get-loginmachinesidtagstag">GetMachineTag (GET /:login/machines/:id/tags/:tag)</h2>
<p>Returns the value for a single tag on this instance.</p>
<p>Typically one calls CloudAPI endpoints with <code>Accept: application/json</code>. This
endpoint can be called that way, or alternatively with <code>Accept: text/plain</code>
to get the non-JSON value in the response.</p>
<h3 id="inputs_68">Inputs</h3>
<p>None.</p>
<h3 id="returns_68">Returns</h3>
<p>The tag value.</p>
<h3 id="errors_68">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code>, <code>:id</code> or <code>:tag</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_66">CLI Command</h3>
<p>Using node-triton:</p>
<pre><code>$ triton instance tag get 5e42cd1e foo
bar
$ triton instance tag get --json 5e42cd1e foo   # encoded as JSON
"bar"
</code></pre>
<p>Using node-smartdc:</p>
<pre><code>$ sdc-getmachinetag --tag=foo 5e42cd1e-34bb-402f-8796-bf5a2cae47db
bar
</code></pre>
<h3 id="example-requestresponse">Example Request/Response</h3>
<p>Using <code>application/json</code>, the request:</p>
<pre><code>GET /my/machines/5e42cd1e-34bb-402f-8796-bf5a2cae47db/tags/foo HTTP/1.1
Host: api.example.com
authorization: ...
accept: application/json
accept-version: ~8||~7
</code></pre>
<p>the response:</p>
<pre><code>HTTP/1.1 200 OK
...
content-type: application/json
content-length: 5

"bar"
</code></pre>
<p>Using <code>text/plain</code>, the request:</p>
<pre><code>GET /my/machines/5e42cd1e-34bb-402f-8796-bf5a2cae47db/tags/foo HTTP/1.1
Host: api.example.com
authorization: ...
accept: text/plain
accept-version: ~8||~7
</code></pre>
<p>the response:</p>
<pre><code>HTTP/1.1 200 OK
...
content-type: text/plain
content-length: 3

bar
</code></pre>
<h2 id="deletemachinetag-delete-loginmachinesidtagstag">DeleteMachineTag (DELETE /:login/machines/:id/tags/:tag)</h2>
<p>Deletes a single tag from this instance.</p>
<p>Note: This action is asynchronous. You can poll on <code>ListMachineTags</code> to wait for
the update to be complete (the <code>triton instance tag delete -w,--wait</code> option
does this).</p>
<h3 id="inputs_69">Inputs</h3>
<ul>
<li>None</li>
</ul>
<h3 id="returns_69">Returns</h3>
<ul>
<li>None</li>
</ul>
<h3 id="errors_69">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code>, <code>:id</code> or <code>:tag</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_67">CLI Command</h3>
<p>Using node-triton:</p>
<pre><code>$ triton instance tag delete -w 5e42cd1e foo
</code></pre>
<p>Using node-smartdc:</p>
<pre><code>$ sdc-deletemachinetag --tag=foo 5e42cd1e-34bb-402f-8796-bf5a2cae47db
</code></pre>
<h3 id="example-request_62">Example Request</h3>
<pre><code>DELETE /my/machines/5e42cd1e-34bb-402f-8796-bf5a2cae47db/tags/foo HTTP/1.1
Host: api.example.com
authorization: ...
accept: text/plain
accept-version: ~8||~7
</code></pre>
<h3 id="example-response_62">Example Response</h3>
<pre><code>HTTP/1.1 204 No Content
...
</code></pre>
<h2 id="deletemachinetags-delete-loginmachinesidtags">DeleteMachineTags (DELETE /:login/machines/:id/tags)</h2>
<p>Deletes all tags from an instance.</p>
<p>Note: This action is asynchronous. You can poll on <code>ListMachineTags</code> to wait for
the update to be complete (the <code>triton instance tag delete -w,--wait</code> option
does this).</p>
<h3 id="inputs_70">Inputs</h3>
<ul>
<li>None</li>
</ul>
<h3 id="returns_70">Returns</h3>
<ul>
<li>None</li>
</ul>
<h3 id="errors_70">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> or <code>:id</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_68">CLI Command</h3>
<p>Using node-triton:</p>
<pre><code>$ triton instance tag delete -w --all 5e42cd1e
</code></pre>
<p>Using node-smartdc:</p>
<pre><code># Remember to quote the `*` to avoid shell expansion.
$ sdc-deletemachinetag --tag='*' 5e42cd1e-34bb-402f-8796-bf5a2cae47db
</code></pre>
<h3 id="example-request_63">Example Request</h3>
<pre><code>DELETE /my/machines/5e42cd1e-34bb-402f-8796-bf5a2cae47db/tags HTTP/1.1
Host: api.example.com
authorization: ...
accept: text/plain
accept-version: ~8||~7
</code></pre>
<h3 id="example-response_63">Example Response</h3>
<pre><code>HTTP/1.1 204 No Content
...
</code></pre>
<h2 id="deletemachine-delete-loginmachinesid">DeleteMachine (DELETE /:login/machines/:id)</h2>
<p>Allows you to completely destroy an instance.</p>
<p>An instance cannot be destroyed so long as <a href="#deletion-protection">Deletion
Protection</a> is enabled on that instance.</p>
<h3 id="inputs_71">Inputs</h3>
<ul>
<li>None</li>
</ul>
<h3 id="returns_71">Returns</h3>
<ul>
<li>None</li>
</ul>
<h3 id="errors_71">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> or <code>:id</code> does not exist</td>
</tr>
<tr>
<td>InvalidState</td>
<td>The instance is in the wrong state to be deleted</td>
</tr>
<tr>
<td>CannotDestroyMachine</td>
<td><a href="#deletion-protection">Deletion Protection</a> is enabled on this instance</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_69">CLI Command</h3>
<pre><code>$ triton instance delete 75cfe125-a5ce-49e8-82ac-09aa31ffdf26
</code></pre>
<p>or</p>
<pre><code>$ sdc-deletemachine 75cfe125-a5ce-49e8-82ac-09aa31ffdf26
</code></pre>
<h3 id="example-request_64">Example Request</h3>
<pre><code>DELETE /my/machines/75cfe125-a5ce-49e8-82ac-09aa31ffdf26 HTTP/1.1
Authorization: ...
Host: api.example.com
Accept: application/json
Api-Version: ~8
</code></pre>
<h4 id="example-response_64">Example Response</h4>
<pre><code>HTTP/1.1 204 No Content
Access-Control-Allow-Origin: *
Access-Control-Allow-Methods: GET, POST, DELETE
Server: Joyent Triton 8.0.0
Connection: close
Date: Wed, 13 Apr 2011 23:38:03 GMT
Api-Version: 8.0.0
Request-Id: 762C3F37-8ACA-4A49-AF10-84CEC8137B1D
Response-Time: 72
Content-Length: 0
</code></pre>
<h2 id="machineaudit-get-loginmachinesidaudit">MachineAudit (GET /:login/machines/:id/audit)</h2>
<p>Provides a list of an instance's accomplished actions. Results are sorted from
newest to oldest action.</p>
<p>Note that the complete audit trail is returned only if the instance history and
job records have not been purged from Triton.</p>
<h3 id="inputs_72">Inputs</h3>
<ul>
<li>None</li>
</ul>
<h3 id="returns_72">Returns</h3>
<ul>
<li>An array of action objects, which contain:</li>
</ul>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>action</td>
<td>String</td>
<td>The name of the action</td>
</tr>
<tr>
<td>success</td>
<td>String</td>
<td>Either "yes" or "no", depending on the action's success</td>
</tr>
<tr>
<td>caller</td>
<td>Object</td>
<td>Account requesting the action</td>
</tr>
<tr>
<td>time</td>
<td>Date (ISO8601)</td>
<td>When the action finished</td>
</tr>
</tbody>
</table>
<p>Depending on the account requesting the action, <code>caller</code> can have the following
members:</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>type</td>
<td>String</td>
<td>Authentication type for the action request. One of "basic", "operator", "signature" or "token"</td>
</tr>
<tr>
<td>user</td>
<td>String</td>
<td>When the authentication type is "basic", this member will be present and include user login</td>
</tr>
<tr>
<td>ip</td>
<td>String</td>
<td>The IP addresses this from which the action was requested. Not present if type is "operator"</td>
</tr>
<tr>
<td>keyId</td>
<td>String</td>
<td>When authentication type is either "signature" or "token", SSH key identifier</td>
</tr>
</tbody>
</table>
<h3 id="errors_72">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> or <code>:id</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_70">CLI Command</h3>
<pre><code>$ triton instance audit 75cfe125-a5ce-49e8-82ac-09aa31ffdf26
</code></pre>
<p>or</p>
<pre><code>$ sdc-getmachineaudit 75cfe125-a5ce-49e8-82ac-09aa31ffdf26
</code></pre>
<h3 id="example-request_65">Example Request</h3>
<pre><code>GET /my/machines/75cfe125-a5ce-49e8-82ac-09aa31ffdf26/audit HTTP/1.1
Authorization: ...
Host: api.example.com
Accept: application/json
Api-Version: ~8
</code></pre>
<h4 id="example-response_65">Example Response</h4>
<pre><code>HTTP/1.1 200 OK
content-type: application/json
content-length: 191
access-control-allow-origin: *
access-control-allow-headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
access-control-allow-methods: GET
access-control-expose-headers: Api-Version, Request-Id, Response-Time
connection: Keep-Alive
content-md5: GRmOq/dAdKZJ4wVpEelRrQ==
date: Fri, 22 Feb 2013 15:19:37 GMT
server: Joyent Triton 8.0.0
api-version: 8.0.0
request-id: 453aee00-7d03-11e2-8048-5195b6159808
response-time: 34

[{
    "success": "yes",
    "time": "2013-02-22T15:19:32.522Z",
    "action": "provision",
    "caller": {
      "type": "signature",
      "ip": "127.0.0.1",
      "keyId": "/:login/keys/:fingerprint"
    }
  }, ...]
</code></pre>
<h2 id="deletion-protection">Deletion Protection</h2>
<p>If you want to decrease the risk of accidental instance destruction, it is
possible to make instance destruction (e.g. through
<a href="#DeleteMachine">DeleteMachine</a>) a two-step process.</p>
<p>Instances that have the attribute <code>deletion_protection</code> set to boolean <code>true</code>
cannot be deleted, either through CloudAPI or SDC Docker. In order to delete
such an instance, the above attribute needs to be set to false first.</p>
<p>The attribute can be set during instance creation (see
<a href="#CreateMachine">CreateMachine</a>), or added later (see
<a href="#EnableMachineDeletionProtection">EnableMachineDeletionProtection</a>). The
instance then cannot be destroyed until the attribute is set to false, although
all other operations will still work. To destroy the instance, first call
<a href="#DisableMachineDeletionProtection">DisableMachineDeletionProtection</a>) on the
instance.</p>
<h3 id="cli-commands">CLI Commands</h3>
<pre><code>$ triton instance create 62aaa296 0ea54d9d --deletion-protection

$ triton instance disable-deletion-protection 9985bc81

$ triton instance enable-deletion-protection 9985bc81
</code></pre>
<h1 id="migrations">Migrations</h1>
<p>Triton supports <em>incremental offline migrations</em> starting with CloudAPI version 9.6.0.</p>
<p>It is possible to migrate (move a VM) to another CN using these APIs. See <a href="https://github.com/joyent/rfd/blob/master/rfd/0034/README.md">RFD 34</a>
for the background on how and why instance migration works the way it does.</p>
<p>VM migration operates in three distinct phases, the <code>begin</code> phase creates a hidden target
placeholder vm for which to migrate into, the <code>sync</code> phase will synchronize the underlying
filesystems and the <code>switch</code> phase will shutdown the original source vm, perform a final
filesystem synchronization, hide the original source VM and then enable and restart the target VM.</p>
<p>A migration can be set to run all of these phases in one (<em>automatic</em> migration) or
these phases can each be run manually (<em>on demand</em> migration).</p>
<p>For any migration action (e.g. <code>begin</code>, <code>sync</code>, <code>switch</code> or <code>abort</code>) you can use the
migration <code>watch</code> endpoint to show progress information for the running migration action</p>
<h2 id="migrate-post-loginmachinesidmigrate">Migrate  (POST /:login/machines/:id/migrate)</h2>
<h3 id="inputs_73">Inputs</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>action</td>
<td>String</td>
<td>One of "begin", "sync", "switch", "automatic", "pause", "abort" or "watch".</td>
</tr>
<tr>
<td>affinity</td>
<td>Array</td>
<td>Optional array of <a href="#affinity-rules">affinity rules</a>. Only apply when actions are "begin" or "automatic".</td>
</tr>
</tbody>
</table>
<h3 id="returns_73">Returns</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>machine</td>
<td>UUID</td>
<td>UUID of the instance being migrated.</td>
</tr>
<tr>
<td>automatic</td>
<td>Boolean</td>
<td>All the migration phases will run consecutively without user intervention.</td>
</tr>
<tr>
<td>created_timestamp</td>
<td>String</td>
<td>ISO timestamp for the creation of the migration request.</td>
</tr>
<tr>
<td>phase</td>
<td>String</td>
<td>Current migration phase. One of "begin", "sync", "switch" or "finished". See <a href="#migration-phases">Migration phases</a> below.</td>
</tr>
<tr>
<td>state</td>
<td>String</td>
<td>Current migration state. See migration state below.</td>
</tr>
<tr>
<td>progress_history</td>
<td>Array</td>
<td>array of completed JSON progress events. See <a href="#progress-Events">Progress Events</a> section for details.</td>
</tr>
<tr>
<td>error</td>
<td>String</td>
<td>If a migration fails - this is the error message of why it failed.</td>
</tr>
</tbody>
</table>
<p>If the action is <code>watch</code> the response will return instead a collection of <a href="#progress-Events">Progress Events</a>.</p>
<h3 id="progress-events">Progress Events</h3>
<p>Progress events are sent when something important occurs during the migration.
There are actually two styles of progress events - one for major events (and/or warnings) and one to show the sync progress (<code>bandwidth</code> and <code>eta</code>).</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>type</td>
<td>String</td>
<td>Type is "progress".</td>
</tr>
<tr>
<td>phase</td>
<td>String</td>
<td>Current phase. See <a href="#migration-phases">Migration phases</a>.</td>
</tr>
<tr>
<td>state</td>
<td>String</td>
<td>State is "running".</td>
</tr>
<tr>
<td>current_progress</td>
<td>Number</td>
<td>This is how much progress has been made. For the sync phase, this is the number of bytes that have been sent to the target.</td>
</tr>
<tr>
<td>total_progress</td>
<td>Number</td>
<td>This is total possible progress. For the sync phase, this is the number of bytes that will need to be sent to the target.</td>
</tr>
<tr>
<td>message</td>
<td>String (optional)</td>
<td>Additional description message for this task.</td>
</tr>
<tr>
<td>error</td>
<td>String (optional)</td>
<td>Error occurred in this task - this is the description for that error.</td>
</tr>
<tr>
<td>started_timestamp</td>
<td>String (optional)</td>
<td>The ISO timestamp when the phase was started.</td>
</tr>
<tr>
<td>duration_ms</td>
<td>Number (optional)</td>
<td>The number of milliseconds the phase has taken.</td>
</tr>
<tr>
<td>eta_ms</td>
<td>Number (optional)</td>
<td>Estimate of the number of milliseconds until the task is completed.</td>
</tr>
<tr>
<td>transfer_bytes_second</td>
<td>Number (optional)</td>
<td>The number of bytes being sent per second between the source and target instances during the "sync" phase.</td>
</tr>
</tbody>
</table>
<h3 id="migration-state">Migration state</h3>
<p>The state the migration operation is currently in. It can be one of
the following states:</p>
<table>
<thead>
<tr>
<th><strong>State</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>running</td>
<td>Migration running, see also <code>progress_history</code>.</td>
</tr>
<tr>
<td>paused</td>
<td>The "begin" phase (and possibly "sync" phase) has been run - now waiting for a call to "sync" or the final call to "switch".</td>
</tr>
<tr>
<td>aborted</td>
<td>User or operator aborted the migration attempt.</td>
</tr>
<tr>
<td>failed</td>
<td>Migration operation could not complete, see "error".</td>
</tr>
<tr>
<td>successful</td>
<td>Migration was successfully completed.</td>
</tr>
</tbody>
</table>
<h3 id="migration-phases">Migration phases</h3>
<p>The workflow stage that the migration is currently running, one of:</p>
<table>
<thead>
<tr>
<th><strong>Phase</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>begin</td>
<td>This phase starts the migration process, creates a new migration database entry and provisions the target instance.</td>
</tr>
<tr>
<td>sync</td>
<td>This phase synchronizes the zfs datasets of the source instance with the zfs datasets in the target instance (without stopping the instance).</td>
</tr>
<tr>
<td>switch</td>
<td>This phase stops the instance from running, synchronizes the zfs datasets of the source instance with the zfs datasets in the target instance, moves the NICs from the source to the target instance, moves control to the target instance and then restarts the target instance.</td>
</tr>
<tr>
<td>abort</td>
<td>This phase is used when aborting a migration.</td>
</tr>
</tbody>
</table>
<h3 id="errors_73">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> or <code>:id</code> does not exist</td>
</tr>
<tr>
<td>InvalidState</td>
<td>The migration is in the wrong <code>state</code> to perform the requested <code>action</code></td>
</tr>
<tr>
<td>InvalidArgument</td>
<td>If <code>action</code> was invalid, or <code>affinity</code> wasn't valid</td>
</tr>
<tr>
<td>MissingParameter</td>
<td>If <code>action</code> wasn't provided</td>
</tr>
</tbody>
</table>
<h3 id="cli-commands_1">CLI Commands</h3>
<pre><code>$ triton instance migration begin eaabc951 -w
running: 1% reserving instance
Done - begin finished in 28.35352 seconds

$ triton instance migration list
SHORTID   PHASE   STATE       AGE
eaabc951  begin   paused      48s

$ triton instance migration sync eaabc951 -w
running: 1% syncing data
running: 100% 10.5MB/s
Done - sync finished in 12.25971 seconds

$ triton instance migration switch eaabc951 -w
running: 3% stopping the instance
running: 1% syncing data
running: 1% switching instances
running: 65% setting up the target filesystem
running: 75% hiding the original instance
running: 85% promoting the migrated instance
running: 90% removing sync snapshots
running: 95% starting the migrated instance
Done - switch finished in 40.28621 seconds

$ triton instance migration list
SHORTID   PHASE   STATE       AGE
eaabc951  switch  successful  26m
</code></pre>
<h3 id="example-request_66">Example Request</h3>
<pre><code>POST /my/machines/eaabc951-7b16-421f-ff2b-ba67b12bb4bd/migrate HTTP/1.1
Host: api.example.com
date: Wed, 27 Mar 2019 20:10:25 GMT
authorization: ...
accept: application/json
content-type: application/json
user-agent: triton/7.0.1 (x64-darwin; node/6.10.3)
accept-version: ~9||~8
content-length: 18

{"action": "begin"}
</code></pre>
<h3 id="example-response_66">Example Response</h3>
<pre><code>HTTP/1.1 201 Created
content-type: application/json
content-length: 171
access-control-allow-origin: *
access-control-allow-headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
access-control-allow-methods: GET, POST
access-control-expose-headers: Api-Version, Request-Id, Response-Time
connection: Keep-Alive
date: Wed, 27 Mar 2019 20:10:26 GMT
server: cloudapi/9.6.0
api-version: 9.0.0
request-id: e5fd786d-094a-4e99-a3bb-3b09f7193232
response-time: 440
x-request-processing-time: 443

{
  "automatic":false,
  "created_timestamp":"2019-03-27T20:10:26.101Z",
  "phase":"begin",
  "state":"running",
  "vm_uuid":"eaabc951-7b16-421f-ff2b-ba67b12bb4bd",
  "progress_history":[]
}
</code></pre>
<h3 id="example-watch-request">Example watch Request</h3>
<pre><code>POST /my/machines/eaabc951-7b16-421f-ff2b-ba67b12bb4bd/migrate?action=watch HTTP/1.1
Host: api.example.com
date: Wed, 27 Mar 2019 20:10:26 GMT
authorization: ...
accept: application/json
content-type: application/json
user-agent: triton/7.0.1 (x64-darwin; node/6.10.3)
accept-version: ~9||~8
</code></pre>
<h3 id="example-watch-response">Example watch Response</h3>
<pre><code>HTTP/1.1 200 OK
access-control-allow-origin: *
access-control-allow-headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
access-control-allow-methods: GET, POST
access-control-expose-headers: Api-Version, Request-Id, Response-Time
connection: Keep-Alive
date: Wed, 27 Mar 2019 20:10:26 GMT
server: cloudapi/9.6.0
api-version: 9.0.0
request-id: 2deba1bf-df9b-4a70-9bd9-d5d93cf8b4dc
response-time: 249
content-type: application/x-json-stream
transfer-encoding: chunked
x-request-received: 1553717426381
x-request-processing-time: 4330

{"type":"progress","current_progress":1,"message":"reserving instance","phase":"begin","state":"running","started_timestamp":"2019-03-27T20:10:30.265Z","total_progress":100,"duration_ms":441}

{"type":"end","phase":"begin","state":"paused"}
</code></pre>
<h2 id="listmigrations-get-loginmigrations">ListMigrations  (GET /:login/migrations)</h2>
<p>Retrieve a list of migrations</p>
<h3 id="inputs_74">Inputs</h3>
<ul>
<li>None</li>
</ul>
<h3 id="returns_74">Returns</h3>
<p>A list of migration objects. See <a href="#Migrate">Migrate</a>.</p>
<h3 id="errors_74">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<h3 id="cli-example">CLI example</h3>
<pre><code>$ triton inst migration list
</code></pre>
<h3 id="example-request_67">Example Request</h3>
<pre><code>GET /my/migrations HTTP/1.1
Host: api.example.com
date: Thu, 28 Mar 2019 11:18:44 GMT
authorization: ...
accept: application/json
user-agent: triton/7.0.1 (x64-darwin; node/6.10.3)
accept-version: ~9||~8
</code></pre>
<h3 id="example-response_67">Example Response</h3>
<pre><code>HTTP/1.1 200 OK
content-type: application/json
content-length: 5315
access-control-allow-origin: *
access-control-allow-headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
access-control-allow-methods: GET
access-control-expose-headers: Api-Version, Request-Id, Response-Time
connection: Keep-Alive
content-md5: e9l3E/czYSTWo7RkCU47yw==
date: Thu, 28 Mar 2019 11:18:44 GMT
server: cloudapi/9.6.0
api-version: 9.0.0
request-id: 6154097a-3155-4de4-8dfc-63dfefaaa6ff
response-time: 207
x-request-received: 1553771924532
x-request-processing-time: 230

[
  {
    "automatic": true,
    "created_timestamp": "2019-03-25T19:21:29.336Z",
    "duration_ms": 25134,
    "finished_timestamp": "2019-03-25T19:22:40.948Z",
    "phase": "switch",
    "state": "successful",
    "progress_history": [
      {
        "type": "progress",
        "current_progress": 100,
        "duration_ms": 16077,
        "finished_timestamp": "2019-03-25T19:21:51.959Z",
        "message": "reserving instance",
        "phase": "begin",
        "state": "successful",
        "started_timestamp": "2019-03-25T19:21:35.882Z",
        "total_progress": 100
      },
      {
        "type": "progress",
        "current_progress": 100,
        "duration_ms": 3676,
        "finished_timestamp": "2019-03-25T19:21:58.485Z",
        "message": "syncing data",
        "phase": "sync",
        "state": "successful",
        "started_timestamp": "2019-03-25T19:21:54.809Z",
        "total_progress": 100
      },
      {
        "type": "progress",
        "current_progress": 100,
        "duration_ms": 2694,
        "finished_timestamp": "2019-03-25T19:22:02.722Z",
        "message": "syncing data",
        "phase": "sync",
        "state": "successful",
        "started_timestamp": "2019-03-25T19:22:00.028Z",
        "total_progress": 100
      },
      {
        "type": "progress",
        "current_progress": 100,
        "duration_ms": 2687,
        "finished_timestamp": "2019-03-25T19:22:33.427Z",
        "message": "syncing data",
        "phase": "sync",
        "state": "successful",
        "started_timestamp": "2019-03-25T19:22:30.740Z",
        "total_progress": 100
      },
      {
        "type": "progress",
        "current_progress": 100,
        "duration_ms": 5571,
        "finished_timestamp": "2019-03-25T19:22:40.948Z",
        "message": "switching instances",
        "phase": "switch",
        "state": "successful",
        "started_timestamp": "2019-03-25T19:22:35.377Z",
        "total_progress": 100
      }
    ],
    "machine": "40c3c6ec-8be5-476a-ca35-c0ea2b0858e3"
  },
  ... more migration objects ...
]
</code></pre>
<h2 id="getmigration-get-loginmigrationsid">GetMigration  (GET /:login/migrations/:id)</h2>
<h3 id="inputs_75">Inputs</h3>
<p>None</p>
<h3 id="returns_75">Returns</h3>
<p>Migration object with the following fields:</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>machine</td>
<td>UUID</td>
<td>UUID of the instance being migrated.</td>
</tr>
<tr>
<td>automatic</td>
<td>Boolean</td>
<td>All the migration phases will run consecutively without user intervention.</td>
</tr>
<tr>
<td>created_timestamp</td>
<td>String</td>
<td>ISO timestamp for the creation of the migration request.</td>
</tr>
<tr>
<td>scheduled_timestamp</td>
<td>String</td>
<td>ISO timestamp for when the migration should commence.</td>
</tr>
<tr>
<td>phase</td>
<td>String</td>
<td>Current migration phase. One of "begin", "sync", "switch" or "finished". See <a href="#migration-phases">Migration phases</a> below.</td>
</tr>
<tr>
<td>state</td>
<td>String</td>
<td>Current migration state. See migration state below.</td>
</tr>
<tr>
<td>progress_history</td>
<td>Array</td>
<td>array of completed JSON progress events. See <a href="#progress-Events">Progress Events</a> section for details.</td>
</tr>
<tr>
<td>error</td>
<td>String</td>
<td>If a migration fails - this is the error message of why it failed.</td>
</tr>
</tbody>
</table>
<h3 id="errors_75">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<h3 id="cli-example_1">CLI example</h3>
<pre><code>$ triton inst migration get
</code></pre>
<h3 id="example-request_68">Example Request</h3>
<pre><code>GET /my/migrations/40c3c6ec-8be5-476a-ca35-c0ea2b0858e3 HTTP/1.1
Host: api.example.com
date: Thu, 28 Mar 2019 11:18:44 GMT
authorization: ...
accept: application/json
user-agent: triton/7.0.1 (x64-darwin; node/6.10.3)
accept-version: ~9||~8
</code></pre>
<h3 id="example-response_68">Example Response</h3>
<pre><code>HTTP/1.1 200 OK
content-type: application/json
date: Thu, 28 Mar 2019 11:18:44 GMT
server: cloudapi/9.6.0
api-version: 9.0.0
request-id: 6154097a-3155-4de4-8dfc-63dfefaaa6ff
...

{
  "automatic": true,
  "created_timestamp": "2019-03-25T19:21:29.336Z",
  "duration_ms": 25134,
  "finished_timestamp": "2019-03-25T19:22:40.948Z",
  "phase": "switch",
  "state": "successful",
  "progress_history": [
    {
      "type": "progress",
      "current_progress": 100,
      "duration_ms": 16077,
      "finished_timestamp": "2019-03-25T19:21:51.959Z",
      "message": "reserving instance",
      "phase": "begin",
      "state": "successful",
      "started_timestamp": "2019-03-25T19:21:35.882Z",
      "total_progress": 100
    },
    {
      "type": "progress",
      "current_progress": 100,
      "duration_ms": 3676,
      "finished_timestamp": "2019-03-25T19:21:58.485Z",
      "message": "syncing data",
      "phase": "sync",
      "state": "successful",
      "started_timestamp": "2019-03-25T19:21:54.809Z",
      "total_progress": 100
    },
    {
      "type": "progress",
      "current_progress": 100,
      "duration_ms": 2694,
      "finished_timestamp": "2019-03-25T19:22:02.722Z",
      "message": "syncing data",
      "phase": "sync",
      "state": "successful",
      "started_timestamp": "2019-03-25T19:22:00.028Z",
      "total_progress": 100
    },
    {
      "type": "progress",
      "current_progress": 100,
      "duration_ms": 2687,
      "finished_timestamp": "2019-03-25T19:22:33.427Z",
      "message": "syncing data",
      "phase": "sync",
      "state": "successful",
      "started_timestamp": "2019-03-25T19:22:30.740Z",
      "total_progress": 100
    },
    {
      "type": "progress",
      "current_progress": 100,
      "duration_ms": 5571,
      "finished_timestamp": "2019-03-25T19:22:40.948Z",
      "message": "switching instances",
      "phase": "switch",
      "state": "successful",
      "started_timestamp": "2019-03-25T19:22:35.377Z",
      "total_progress": 100
    }
  ],
  "machine": "40c3c6ec-8be5-476a-ca35-c0ea2b0858e3"
}
</code></pre>
<h1 id="firewallrules">FirewallRules</h1>
<p>You can manage Firewall Rules for your instances through CloudAPI.</p>
<h2 id="firewall-rule-syntax">Firewall Rule Syntax</h2>
<p>In general, the firewall rule is composed of the following pieces:</p>
<pre><code>FROM &lt;target a&gt; TO &lt;target b&gt; &lt;action&gt; &lt;protocol&gt; &lt;port&gt; [&lt;priority&gt;]
</code></pre>
<p>where</p>
<ul>
<li><code>target</code> will be one of <code>any</code>, <code>all vms</code>, <code>ip</code>, <code>subnet</code>, <code>tag</code> or <code>vm</code></li>
<li><code>action</code> is either <code>ALLOW</code> or <code>BLOCK</code></li>
<li><code>protocol</code> will be one of <code>tcp</code>, <code>udp</code> or <code>icmp</code></li>
<li><code>port</code> is a valid port number or range (e.g. <code>port 22</code>, <code>ports 8000 - 8999</code>)</li>
<li><code>priority</code> is a number between 0 and 100 (default is 0, the lowest priority)</li>
</ul>
<p>The use of <code>priority</code> is available only with fwapi <code>FWRULE_VERSION</code> 4 or above. See
fwapi <a href="https://github.com/joyent/sdc-fwapi/blob/master/docs/index.md">documentation</a>
for more information.</p>
<p>The rule should have <code>tag</code>, <code>vm</code> or <code>all vms</code> in the FROM or TO target. The
following are some possibilities:</p>
<h3 id="allow-incoming-http-traffic-to-an-instance">Allow incoming HTTP traffic to an instance:</h3>
<pre><code>FROM any TO vm 0abeae82-c040-4080-ac60-b60d3e3890a7 ALLOW tcp port 80
</code></pre>
<h3 id="block-outgoing-smtp-traffic-from-an-instance-to-a-subnet">Block outgoing SMTP traffic from an instance to a subnet:</h3>
<pre><code>FROM vm 0abeae82-c040-4080-ac60-b60d3e3890a7 TO subnet 10.99.99.0/24 BLOCK tcp port 25
</code></pre>
<h3 id="block-incoming-tcp-traffic-from-all-instances-to-a-certain-range-of-ports">Block incoming TCP traffic from all instances to a certain range of ports:</h3>
<pre><code>FROM any TO vm 0abeae82-c040-4080-ac60-b60d3e3890a7 BLOCK tcp ports 40000 - 65535
</code></pre>
<h3 id="allow-an-ip-http-and-https-access-to-all-instances-tagged-www-or-testwww">Allow an IP HTTP and HTTPS access to all instances tagged www or testwww:</h3>
<pre><code>FROM ip 10.99.99.7 TO (tag www OR tag testwww) ALLOW tcp (port 80 AND port 443)
</code></pre>
<h3 id="allow-syslog-traffic-from-instances-tagged-with-groupweb-to-instances-tagged-with-groupmon">Allow syslog traffic from instances tagged with group=web to instances tagged with group=mon:</h3>
<pre><code>FROM tag group=www TO tag group=mon ALLOW udp port 514
</code></pre>
<h3 id="allow-traffic-from-anyone-but-102030024-to-access-an-mta">Allow traffic from anyone but 10.20.30.0/24 to access an MTA:</h3>
<pre><code>FROM any TO tag mta ALLOW tcp PORT 25
FROM subnet 10.20.30.0/24 TO tag mta BLOCK tcp PORT 25 PRIORITY 1
</code></pre>
<h3 id="block-all-outbound-traffic-overriding-the-default-outbound-policy-except-for-ssh">Block all outbound traffic, overriding the default outbound policy, except for SSH:</h3>
<pre><code>FROM all vms TO any BLOCK tcp PORT all
FROM all vms TO any ALLOW tcp PORT 22 PRIORITY 1
</code></pre>
<h2 id="listfirewallrules-get-loginfwrules">ListFirewallRules (GET /:login/fwrules)</h2>
<p>List all firewall rules for the current account.</p>
<h3 id="inputs_76">Inputs</h3>
<ul>
<li>None</li>
</ul>
<h3 id="returns_76">Returns</h3>
<p>An array of firewall rule objects.  Firewall Rules are:</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>String</td>
<td>Unique identifier for this rule</td>
</tr>
<tr>
<td>enabled</td>
<td>Boolean</td>
<td>Indicates if the rule is enabled</td>
</tr>
<tr>
<td>rule</td>
<td>String</td>
<td>Firewall rule text</td>
</tr>
<tr>
<td>global</td>
<td>Boolean</td>
<td>Indicates if the rule is global (optional)</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>Human-readable description for the rule (optional)</td>
</tr>
</tbody>
</table>
<h3 id="errors_76">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_71">CLI Command</h3>
<pre><code>$ triton fwrule list
</code></pre>
<p>or</p>
<pre><code>$ sdc-listfirewallrules
</code></pre>
<h4 id="example-request_69">Example Request</h4>
<pre><code>GET /login/fwrules HTTP/1.1
authorization: Signature keyId="...
accept: application/json
accept-version: ~8
host: api.example.com
connection: keep-alive
</code></pre>
<h4 id="example-response_69">Example Response</h4>
<pre><code>HTTP/1.1 200 OK
content-type: application/json
content-length: 158
access-control-allow-origin: *
access-control-allow-headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
access-control-allow-methods: GET
access-control-expose-headers: Api-Version, Request-Id, Response-Time
connection: Keep-Alive
content-md5: v6s92rl/nTS2Ts5CNDcgQw==
server: Joyent Triton 8.0.0
api-version: 8.0.0
request-id: 35147710-7f49-11e2-8585-bd5fc323c72c
response-time: 134

[
  {
    "id": "38de17c4-39e8-48c7-a168-0f58083de860",
    "rule": "FROM vm 3d51f2d5-46f2-4da5-bb04-3238f2f64768 TO subnet 10.99.99.0/24 BLOCK tcp PORT 25",
    "enabled": true
  }
]
</code></pre>
<h2 id="getfirewallrule-get-loginfwrulesid">GetFirewallRule (GET /:login/fwrules/:id)</h2>
<p>Retrieves an individual firewall rule.</p>
<h3 id="inputs_77">Inputs</h3>
<ul>
<li>None</li>
</ul>
<h3 id="returns_77">Returns</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>String</td>
<td>Unique identifier for this rule</td>
</tr>
<tr>
<td>enabled</td>
<td>Boolean</td>
<td>Indicates if the rule is enabled</td>
</tr>
<tr>
<td>rule</td>
<td>String</td>
<td>Firewall rule text</td>
</tr>
<tr>
<td>global</td>
<td>Boolean</td>
<td>Indicates if the rule is global (optional)</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>Human-readable description for the rule (optional)</td>
</tr>
</tbody>
</table>
<h3 id="errors_77">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_72">CLI Command</h3>
<pre><code>$ triton fwrule get 38de17c4-39e8-48c7-a168-0f58083de860
</code></pre>
<p>or</p>
<pre><code>$ sdc-getfirewallrule 38de17c4-39e8-48c7-a168-0f58083de860
</code></pre>
<h4 id="example-request_70">Example Request</h4>
<pre><code>GET /login/fwrules/38de17c4-39e8-48c7-a168-0f58083de860 HTTP/1.1
authorization: Signature keyId="...
accept: application/json
accept-version: ~8
host: api.example.com
</code></pre>
<h4 id="example-response_70">Example Response</h4>
<pre><code>HTTP/1.1 200 OK
content-type: application/json
content-length: 156
access-control-allow-origin: *
access-control-allow-headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
access-control-allow-methods: GET
access-control-expose-headers: Api-Version, Request-Id, Response-Time
server: Joyent Triton 8.0.0
api-version: 8.0.0
request-id: cf1c1340-7f49-11e2-8585-bd5fc323c72c
response-time: 203

{
  "id": "38de17c4-39e8-48c7-a168-0f58083de860",
  "rule": "FROM vm 3d51f2d5-46f2-4da5-bb04-3238f2f64768 TO subnet 10.99.99.0/24 BLOCK tcp PORT 25",
  "enabled": true
}
</code></pre>
<h2 id="createfirewallrule-post-loginfwrules">CreateFirewallRule (POST /:login/fwrules)</h2>
<p>Adds a new firewall rule for the specified account.  This rule will be added to
all the account's instances where it may be necessary.</p>
<h3 id="inputs_78">Inputs</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>enabled</td>
<td>Boolean</td>
<td>Indicates if the rule is enabled (optional, false by default)</td>
</tr>
<tr>
<td>rule</td>
<td>String</td>
<td>Firewall rule text</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>Human-readable description for the rule (optional)</td>
</tr>
</tbody>
</table>
<h3 id="returns_78">Returns</h3>
<p>Firewall rule object.</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>String</td>
<td>Unique identifier for this rule</td>
</tr>
<tr>
<td>enabled</td>
<td>Boolean</td>
<td>Indicates if the rule is enabled</td>
</tr>
<tr>
<td>rule</td>
<td>String</td>
<td>Firewall rule text</td>
</tr>
<tr>
<td>global</td>
<td>Boolean</td>
<td>Indicates if the rule is global (optional)</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>Human-readable description for the rule (optional)</td>
</tr>
</tbody>
</table>
<h3 id="errors_78">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>InvalidArgument</td>
<td>If rule is invalid</td>
</tr>
<tr>
<td>MissingParameter</td>
<td>If rule wasn't provided</td>
</tr>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_73">CLI Command</h3>
<pre><code>$ triton fwrule create '...'
</code></pre>
<p>or</p>
<pre><code>$ sdc-createfirewallrule --rule='...' --enabled=true
</code></pre>
<h4 id="example-request_71">Example Request</h4>
<pre><code>POST /login/fwrules HTTP/1.1
authorization: Signature keyId="...
accept: application/json
content-type: application/json
accept-version: ~8
content-length: 112
host: api.example.com
</code></pre>
<h4 id="example-response_71">Example Response</h4>
<pre><code>HTTP/1.1 201 Created
content-type: application/json
content-length: 156
access-control-allow-origin: *
access-control-allow-headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
access-control-allow-methods: GET
access-control-expose-headers: Api-Version, Request-Id, Response-Time
server: Joyent Triton 8.0.0
api-version: 8.0.0
request-id: 2c0a2a20-7f49-11e2-8585-bd5fc323c72c
response-time: 36

{
  "id": "38de17c4-39e8-48c7-a168-0f58083de860",
  "rule": "FROM vm 3d51f2d5-46f2-4da5-bb04-3238f2f64768 TO subnet 10.99.99.0/24 BLOCK tcp PORT 25",
  "enabled": true
}
</code></pre>
<h2 id="updatefirewallrule-post-loginfwrulesid">UpdateFirewallRule (POST /:login/fwrules/:id)</h2>
<p>Updates the given rule record and -- depending on rule contents --
adds/removes/updates the rule on all the required instances.</p>
<h3 id="inputs_79">Inputs</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>rule</td>
<td>String</td>
<td>Firewall rule text (optional)</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>Human-readable description for the rule (optional)</td>
</tr>
<tr>
<td>enabled</td>
<td>Boolean</td>
<td>Indicates if the rule is enabled (optional)</td>
</tr>
</tbody>
</table>
<h3 id="returns_79">Returns</h3>
<p>Firewall rule object.</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>String</td>
<td>Unique identifier for this rule</td>
</tr>
<tr>
<td>enabled</td>
<td>Boolean</td>
<td>Indicates if the rule is enabled</td>
</tr>
<tr>
<td>rule</td>
<td>String</td>
<td>Firewall rule text</td>
</tr>
<tr>
<td>global</td>
<td>Boolean</td>
<td>Indicates if the rule is global (optional)</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>Human-readable description for the rule (optional)</td>
</tr>
</tbody>
</table>
<h3 id="errors_79">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>InvalidArgument</td>
<td>If rule is invalid, or trying to modify a global rule</td>
</tr>
<tr>
<td>MissingParameter</td>
<td>If rule wasn't present</td>
</tr>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> or <code>:id</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_74">CLI Command</h3>
<pre><code>$ triton fwrule update 38de17c4-39e8-48c7-a168-0f58083de860 rule='...'
</code></pre>
<p>or</p>
<pre><code>$ sdc-updatefirewallrule --rule='...' 38de17c4-39e8-48c7-a168-0f58083de860
</code></pre>
<h4 id="example-request_72">Example Request</h4>
<pre><code>POST /login/fwrules/38de17c4-39e8-48c7-a168-0f58083de860 HTTP/1.1
authorization: Signature keyId="...
accept: application/json
content-type: application/json
accept-version: ~8
content-length: 111
host: api.example.com

...
</code></pre>
<h4 id="example-response_72">Example Response</h4>
<pre><code>HTTP/1.1 200 OK
content-type: application/json
content-length: 170
access-control-allow-origin: *
access-control-allow-headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
access-control-allow-methods: GET
access-control-expose-headers: Api-Version, Request-Id, Response-Time
server: Joyent Triton 8.0.0
api-version: 8.0.0
request-id: 284907d0-7f67-11e2-8585-bd5fc323c72c
response-time: 225

{
  "id": "38de17c4-39e8-48c7-a168-0f58083de860",
  "rule": "FROM vm 3d51f2d5-46f2-4da5-bb04-3238f2f64768 TO subnet 10.99.99.0/24 BLOCK tcp (PORT 25 AND PORT 80)",
  "enabled": true
}
</code></pre>
<h2 id="enablefirewallrule-post-loginfwrulesidenable">EnableFirewallRule (POST /:login/fwrules/:id/enable)</h2>
<p>Enables the given firewall rule if it is disabled.</p>
<h3 id="inputs_80">Inputs</h3>
<ul>
<li>None</li>
</ul>
<h3 id="returns_80">Returns</h3>
<p>Firewall rule object.</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>String</td>
<td>Unique identifier for this rule</td>
</tr>
<tr>
<td>enabled</td>
<td>Boolean</td>
<td>Indicates if the rule is enabled</td>
</tr>
<tr>
<td>rule</td>
<td>String</td>
<td>Firewall rule text</td>
</tr>
<tr>
<td>global</td>
<td>Boolean</td>
<td>Indicates if the rule is global (optional)</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>Human-readable description for the rule (optional)</td>
</tr>
</tbody>
</table>
<h3 id="errors_80">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> or <code>:id</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_75">CLI Command</h3>
<pre><code>$ triton fwrule enable 38de17c4-39e8-48c7-a168-0f58083de860
</code></pre>
<p>or</p>
<pre><code>$ sdc-enablefirewallrule 38de17c4-39e8-48c7-a168-0f58083de860
</code></pre>
<h4 id="example-request_73">Example Request</h4>
<pre><code>POST /login/fwrules/38de17c4-39e8-48c7-a168-0f58083de860/enable HTTP/1.1
authorization: Signature keyId="...
accept: application/json
content-type: application/json
accept-version: ~8
content-length: 2
host: api.example.com
</code></pre>
<h4 id="example-response_73">Example Response</h4>
<pre><code>HTTP/1.1 200 OK
content-type: application/json
content-length: 170
access-control-allow-origin: *
access-control-allow-headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
access-control-allow-methods: GET
access-control-expose-headers: Api-Version, Request-Id, Response-Time
connection: Keep-Alive
server: Joyent Triton 8.0.0
api-version: 8.0.0
request-id: 1ebe23c0-7f68-11e2-8585-bd5fc323c72c
response-time: 232

{
  "id": "38de17c4-39e8-48c7-a168-0f58083de860",
  "rule": "FROM vm 3d51f2d5-46f2-4da5-bb04-3238f2f64768 TO subnet 10.99.99.0/24 BLOCK tcp (PORT 25 AND PORT 80)",
  "enabled": true
}
</code></pre>
<h2 id="disablefirewallrule-post-loginfwrulesiddisable">DisableFirewallRule (POST /:login/fwrules/:id/disable)</h2>
<p>Disables the given firewall rule if it is enabled.</p>
<h3 id="inputs_81">Inputs</h3>
<ul>
<li>None</li>
</ul>
<h3 id="returns_81">Returns</h3>
<p>Firewall rule object.</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>Unique id for this firewall rule</td>
</tr>
<tr>
<td>enabled</td>
<td>Boolean</td>
<td>Indicates if the rule is enabled</td>
</tr>
<tr>
<td>rule</td>
<td>String</td>
<td>Firewall rule text</td>
</tr>
<tr>
<td>global</td>
<td>Boolean</td>
<td>Indicates if the rule is global (optional)</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>Human-readable description for the rule (optional)</td>
</tr>
</tbody>
</table>
<h3 id="errors_81">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> or <code>:id</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_76">CLI Command</h3>
<pre><code>$ triton fwrule disable 38de17c4-39e8-48c7-a168-0f58083de860
</code></pre>
<p>or</p>
<pre><code>$ sdc-disablefirewallrule 38de17c4-39e8-48c7-a168-0f58083de860
</code></pre>
<h4 id="example-request_74">Example Request</h4>
<pre><code>POST /login/fwrules/38de17c4-39e8-48c7-a168-0f58083de860/disable HTTP/1.1
authorization: Signature keyId="...
accept: application/json
content-type: application/json
accept-version: ~8
content-length: 2
host: api.example.com
</code></pre>
<h4 id="example-response_74">Example Response</h4>
<pre><code>HTTP/1.1 200 OK
content-type: application/json
content-length: 171
access-control-allow-origin: *
access-control-allow-headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
access-control-allow-methods: GET
access-control-expose-headers: Api-Version, Request-Id, Response-Time
content-md5: E7I47cYr/F7S4J68NbK1AQ==
server: Joyent Triton 8.0.0
api-version: 8.0.0
request-id: 8a2d7490-7f67-11e2-8585-bd5fc323c72c
response-time: 234

{
  "id": "38de17c4-39e8-48c7-a168-0f58083de860",
  "rule": "FROM vm 3d51f2d5-46f2-4da5-bb04-3238f2f64768 TO subnet 10.99.99.0/24 BLOCK tcp (PORT 25 AND PORT 80)",
  "enabled": false
}
</code></pre>
<h2 id="deletefirewallrule-delete-loginfwrulesid">DeleteFirewallRule (DELETE /:login/fwrules/:id)</h2>
<p>Removes the given firewall rule from all the required instances.</p>
<h3 id="inputs_82">Inputs</h3>
<ul>
<li>None</li>
</ul>
<h3 id="returns_82">Returns</h3>
<ul>
<li>None</li>
</ul>
<h3 id="errors_82">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> or <code>:id</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_77">CLI Command</h3>
<pre><code>$ triton fwrule delete 38de17c4-39e8-48c7-a168-0f58083de860
</code></pre>
<p>or</p>
<pre><code>$ sdc-deletefirewallrule 38de17c4-39e8-48c7-a168-0f58083de860
</code></pre>
<h4 id="example-request_75">Example Request</h4>
<pre><code>DELETE /login/fwrules/38de17c4-39e8-48c7-a168-0f58083de860 HTTP/1.1
authorization: Signature keyId="...
accept: application/json
accept-version: ~8
host: api.example.com
</code></pre>
<h4 id="example-response_75">Example Response</h4>
<pre><code>HTTP/1.1 204 No Content
access-control-allow-origin: *
access-control-allow-headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
access-control-allow-methods: GET
access-control-expose-headers: Api-Version, Request-Id, Response-Time
connection: Keep-Alive
server: Joyent Triton 8.0.0
api-version: 8.0.0
request-id: 50a78b60-7f68-11e2-8585-bd5fc323c72c
response-time: 219
</code></pre>
<h2 id="listmachinefirewallrules-get-loginmachinesinstance_idfwrules">ListMachineFirewallRules (GET /:login/machines/:instance_id/fwrules)</h2>
<p>This has exactly the same input and output format as
<a href="#ListFirewallRules">List Firewall Rules</a>, but just for the rules affecting the
given <code>:instance_id</code>.</p>
<h2 id="listfirewallrulemachines-get-loginfwrulesidmachines">ListFirewallRuleMachines (GET /:login/fwrules/:id/machines)</h2>
<p>Lists all instances a firewall rule is applied to, in the same format as
<a href="#ListMachines">List Machines</a>.</p>
<h3 id="inputs_83">Inputs</h3>
<ul>
<li>None</li>
</ul>
<h3 id="returns_83">Returns</h3>
<p>An array of instance objects, which contain:</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>Unique id for this instance</td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td>The "friendly" name for this instance</td>
</tr>
<tr>
<td>type</td>
<td>String</td>
<td>(deprecated) The type of instance (virtualmachine or smartmachine)</td>
</tr>
<tr>
<td>brand</td>
<td>String</td>
<td>(v8.0+) The type of instance (e.g. lx)</td>
</tr>
<tr>
<td>state</td>
<td>String</td>
<td>The current state of this instance (e.g. running)</td>
</tr>
<tr>
<td>image</td>
<td>String</td>
<td>The image id this instance was provisioned with</td>
</tr>
<tr>
<td>memory</td>
<td>Number</td>
<td>The amount of RAM this instance has (in MiB)</td>
</tr>
<tr>
<td>disk</td>
<td>Number</td>
<td>The amount of disk this instance has (in MiB)</td>
</tr>
<tr>
<td>metadata</td>
<td>Object[String =&gt; String]</td>
<td>Any additional metadata this instance has</td>
</tr>
<tr>
<td>tags</td>
<td>Object[String =&gt; String]</td>
<td>Any tags this instance has</td>
</tr>
<tr>
<td>created</td>
<td>ISO8601 date</td>
<td>When this instance was created</td>
</tr>
<tr>
<td>updated</td>
<td>ISO8601 date</td>
<td>When this instance's details was last updated</td>
</tr>
<tr>
<td>docker</td>
<td>Boolean</td>
<td>Whether this instance is a Docker container, if present</td>
</tr>
<tr>
<td>ips</td>
<td>Array[String]</td>
<td>The IP addresses this instance has</td>
</tr>
<tr>
<td>networks</td>
<td>Array[String]</td>
<td>The network UUIDs of the nics this instance has</td>
</tr>
<tr>
<td>primaryIp</td>
<td>String</td>
<td>IP address of the primary nic of this instance</td>
</tr>
<tr>
<td>firewall_enabled</td>
<td>Boolean</td>
<td>Whether firewall rules are enforced on this instance</td>
</tr>
<tr>
<td>compute_node</td>
<td>String</td>
<td>UUID of the server on which the instance is located</td>
</tr>
<tr>
<td>package</td>
<td>String</td>
<td>The id or name of the package used to create this instance</td>
</tr>
</tbody>
</table>
<h3 id="errors_83">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> does not exist</td>
</tr>
<tr>
<td>InvalidArgument</td>
<td>If one of the input parameters was invalid</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_78">CLI Command</h3>
<pre><code>$ triton fwrule instances 38de17c4-39e8-48c7-a168-0f58083de860
</code></pre>
<p>or</p>
<pre><code>$ sdc-listfirewallrulemachines 38de17c4-39e8-48c7-a168-0f58083de860
</code></pre>
<h3 id="example-request_76">Example Request</h3>
<pre><code>GET /my/fwrules/38de17c4-39e8-48c7-a168-0f58083de860/machines HTTP/1.1
Authorization: ...
Host: api.example.com
Accept: application/json
Api-Version: ~8
</code></pre>
<h3 id="example-response_76">Example Response</h3>
<pre><code>HTTP/1.1 200 OK
x-query-limit: 1000
x-resource-count: 1
Content-Type: application/json
Content-Length: 1310
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: POST, GET, HEAD
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Content-MD5: w5wJLKlhDzPpC6zKjtqaCw==
Date: Thu, 21 Jan 2016 10:55:25 GMT
Server: Joyent Triton 8.0.0
Api-Version: 8.0.0
Request-Id: 779b5cc0-c02d-11e5-a7d2-fdf229d32220
Response-Time: 3444

[
  {
    "id": "b6979942-7d5d-4fe6-a2ec-b812e950625a",
    "name": "test",
    "type": "smartmachine",
    "brand": "joyent",
    "state": "running",
    "image": "2b683a82-a066-11e3-97ab-2faa44701c5a",
    "ips": [
      "10.88.88.26",
      "192.168.128.5"
    ],
    "memory": 128,
    "disk": 12288,
    "metadata": {
      "root_authorized_keys": "..."
    },
    "tags": {},
    "created": "2016-01-04T12:55:50.539Z",
    "updated": "2016-01-21T08:56:59.000Z",
    "networks": [
      "a9c130da-e3ba-40e9-8b18-112aba2d3ba7",
      "45607081-4cd2-45c8-baf7-79da760fffaa"
    ],
    "primaryIp": "10.88.88.26",
    "firewall_enabled": false,
    "compute_node": "564d0b8e-6099-7648-351e-877faf6c56f6",
    "package": "sdc_128"
  }
]
</code></pre>
<h1 id="fabrics">Fabrics</h1>
<p>CloudAPI provides a way to create and manipulate a fabric. On the fabric you can
create VLANs, and then under that create layer three networks.</p>
<p>A fabric is the basis for building your own private networks that cannot be
accessed by any other user. It represents the physical infrastructure
that makes up a network; however, you don't have to cable or program it. Every
account has its own unique <code>fabric</code> in every datacenter.</p>
<p>On a fabric, you can create your own VLANs and layer-three IPv4 networks. You
can create any VLAN from 0-4095, and you can create any number of IPv4 networks
on top of the VLANs, with all of the traditional IPv4 private addresses spaces
-- <code>10.0.0.0/8</code>, <code>192.168.0.0/16</code>, and <code>172.16.0.0/12</code> -- available for use.</p>
<p>You can create networks on your fabrics to create most network topologies. For
example, you could create a single isolated private network that nothing else
could reach, or you could create a traditional configuration where you have a
database network, a web network, and a load balancer network, each on their own
VLAN.</p>
<h2 id="listfabricvlans-get-loginfabricsdefaultvlans">ListFabricVLANs (GET /:login/fabrics/default/vlans)</h2>
<h3 id="inputs_84">Inputs</h3>
<ul>
<li>None</li>
</ul>
<h3 id="returns_84">Returns</h3>
<p>An array of VLAN objects that exist on the fabric. Each VLAN object has the
following properties:</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>String</td>
<td>A unique name to identify the VLAN</td>
</tr>
<tr>
<td>vlan_id</td>
<td>Integer</td>
<td>A number from 0-4095 that indicates the VLAN's id</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>An optional description of the VLAN</td>
</tr>
</tbody>
</table>
<h3 id="errors_84">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_79">CLI Command</h3>
<pre><code>$ sdc-fabric vlan list
</code></pre>
<h4 id="example-request_77">Example Request</h4>
<pre><code>GET /login/fabrics/default/vlans HTTP/1.1
Authorization: Basic ...
Host: api.example.com
Accept: application/json
Accept-version: ~7.3
</code></pre>
<h4 id="example-response_77">Example Response</h4>
<pre><code>HTTP/1.1 200 OK
Content-Type: application/json
Server: Joyent Triton 7.3.0
Api-Version: 7.3.0

[
  {
    "name": "default",
    "vlan_id": 2
  }
]
</code></pre>
<h2 id="createfabricvlan-post-loginfabricsdefaultvlans">CreateFabricVLAN (POST /:login/fabrics/default/vlans)</h2>
<p>Creates a new VLAN on the fabric.</p>
<h3 id="inputs_85">Inputs</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>String</td>
<td>A unique name to identify the VLAN</td>
</tr>
<tr>
<td>vlan_id</td>
<td>Integer</td>
<td>A number from 0-4095 that indicates the VLAN's id</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>An optional description of the VLAN</td>
</tr>
</tbody>
</table>
<h3 id="returns_85">Returns</h3>
<p>A VLAN Object.</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>String</td>
<td>A unique name to identify the VLAN</td>
</tr>
<tr>
<td>vlan_id</td>
<td>Integer</td>
<td>A number from 0-4095 that indicates the VLAN's id</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>An optional description of the VLAN</td>
</tr>
</tbody>
</table>
<h3 id="errors_85">Errors</h3>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> does not exist</td>
</tr>
<tr>
<td>MissingParameter</td>
<td>If you didn't send a required field</td>
</tr>
<tr>
<td>InvalidArgument</td>
<td><code>vlan_id</code> or <code>name</code> are in use, or <code>vlan_id</code> is outside the valid range</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_80">CLI Command</h3>
<pre><code>$ sdc-fabric vlan create
</code></pre>
<h4 id="example-request_78">Example Request</h4>
<pre><code>POST /login/fabrics/default/vlans HTTP/1.1
Authorization: Basic ...
Host: api.example.com
Accept: application/json
Accept-version: ~7.3

{
  "name": "new",
  "description": "my description",
  "vlan_id": 100
}
</code></pre>
<h4 id="example-response_78">Example Response</h4>
<pre><code>HTTP/1.1 201 Created
Content-Type: application/json
Server: Joyent Triton 7.3.0
Api-Version: 7.3.0

{
  "name": "new",
  "description": "my description",
  "vlan_id": 100
}
</code></pre>
<h2 id="getfabricvlan-get-loginfabricsdefaultvlansvlan_id">GetFabricVLAN (GET /:login/fabrics/default/vlans/:vlan_id)</h2>
<h3 id="inputs_86">Inputs</h3>
<ul>
<li>None</li>
</ul>
<h3 id="returns_86">Returns</h3>
<p>A VLAN Object.</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>String</td>
<td>A unique name to identify the VLAN</td>
</tr>
<tr>
<td>vlan_id</td>
<td>Integer</td>
<td>A number from 0-4095 that indicates the VLAN's id</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>An optional description of the VLAN</td>
</tr>
</tbody>
</table>
<h3 id="errors_86">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> or <code>:vlan_id</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_81">CLI Command</h3>
<pre><code>$ sdc-fabric vlan get 2
</code></pre>
<h4 id="example-request_79">Example Request</h4>
<pre><code>GET /login/fabrics/default/vlans/2 HTTP/1.1
Authorization: Basic ...
Host: api.example.com
Accept: application/json
Accept-version: ~7.3
</code></pre>
<h4 id="example-response_79">Example Response</h4>
<pre><code>HTTP/1.1 200 OK
Content-Type: application/json
Server: Joyent Triton 7.3.0
Api-Version: 7.3.0

{
  "name": "default",
  "vlan_id": 2
}
</code></pre>
<h2 id="updatefabricvlan-put-loginfabricsdefaultvlansvlan_id">UpdateFabricVLAN (PUT /:login/fabrics/default/vlans/:vlan_id)</h2>
<p>Updates a fabric VLAN.</p>
<h3 id="inputs_87">Inputs</h3>
<p>All inputs are optional.</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>String</td>
<td>A unique name to identify the VLAN</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>An optional description of the VLAN</td>
</tr>
</tbody>
</table>
<h3 id="returns_87">Returns</h3>
<p>A VLAN Object.</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>String</td>
<td>A unique name to identify the VLAN</td>
</tr>
<tr>
<td>vlan_id</td>
<td>Integer</td>
<td>A number from 0-4095 that indicates the VLAN's id</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>An optional description of the VLAN</td>
</tr>
</tbody>
</table>
<h3 id="errors_87">Errors</h3>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> or <code>:vlan_id</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_82">CLI Command</h3>
<pre><code>$ sdc-fabric vlan update 2 --description="new description"
</code></pre>
<h4 id="example-request_80">Example Request</h4>
<pre><code>POST /login/fabrics/default/vlans HTTP/1.1
Authorization: Basic ...
Host: api.example.com
Accept: application/json
Accept-version: ~7.3

{
  "description": "new description"
}
</code></pre>
<h4 id="example-response_80">Example Response</h4>
<pre><code>HTTP/1.1 202 Accepted
Content-Type: application/json
Server: Joyent Triton 7.3.0
Api-Version: 7.3.0

{
  "name": "new",
  "description": "new description",
  "vlan_id": 100
}
</code></pre>
<h2 id="deletefabricvlan-delete-loginfabricsdefaultvlansvlan_id">DeleteFabricVLAN (DELETE /:login/fabrics/default/vlans/:vlan_id)</h2>
<p>Deletes the specified VLAN. Note there must be no networks on that VLAN in order
for the VLAN to be deleted.</p>
<h3 id="inputs_88">Inputs</h3>
<ul>
<li>None</li>
</ul>
<h3 id="returns_88">Returns</h3>
<ul>
<li>None</li>
</ul>
<h3 id="errors_88">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> or <code>:vlan_id</code> does not exist</td>
</tr>
<tr>
<td>InUseError</td>
<td>The VLAN currently has active networks on it</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_83">CLI Command</h3>
<pre><code>$ sdc-fabric vlan delete 2
</code></pre>
<h4 id="example-request_81">Example Request</h4>
<pre><code>DELETE /login/fabrics/default/vlans/2 HTTP/1.1
Authorization: Basic ...
Host: api.example.com
Accept: application/json
Accept-version: ~7.3
</code></pre>
<h4 id="example-response_81">Example Response</h4>
<pre><code>HTTP/1.1 204 No Content
Content-Type: application/json
Server: Joyent Triton 7.3.0
Api-Version: 7.3.0
</code></pre>
<h2 id="listfabricnetworks-get-loginfabricsdefaultvlansvlan_idnetworks">ListFabricNetworks (GET /:login/fabrics/default/vlans/:vlan_id/networks)</h2>
<p>Lists all of the networks in a fabric on the VLAN specified by <code>:vlan_id</code>.</p>
<h3 id="inputs_89">Inputs</h3>
<ul>
<li>None</li>
</ul>
<h3 id="returns_89">Returns</h3>
<p>Returns an array of Network Objects. Each network object has the following
information:</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>Unique id for this network</td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td>The network name</td>
</tr>
<tr>
<td>public</td>
<td>Boolean</td>
<td>Whether this a public or private (rfc1918) network</td>
</tr>
<tr>
<td>fabric</td>
<td>Boolean</td>
<td>Whether this network is created on a fabric</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>Description of this network (optional)</td>
</tr>
<tr>
<td>subnet</td>
<td>String</td>
<td>A CIDR formatted string that describes the network</td>
</tr>
<tr>
<td>provision_start_ip</td>
<td>String</td>
<td>The first IP on the network that may be assigned</td>
</tr>
<tr>
<td>provision_end_ip</td>
<td>String</td>
<td>The last IP on the network that may be assigned</td>
</tr>
<tr>
<td>gateway</td>
<td>String</td>
<td>Optional Gateway IP address</td>
</tr>
<tr>
<td>resolvers</td>
<td>String</td>
<td>Resolver IP addresses</td>
</tr>
<tr>
<td>routes</td>
<td>Routes Object</td>
<td>Optional Static routes for hosts on this network</td>
</tr>
<tr>
<td>internet_nat</td>
<td>Boolean</td>
<td>Provision internet NAT zone on gateway address</td>
</tr>
</tbody>
</table>
<h3 id="errors_89">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> or <code>:vlan_id</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_84">CLI Command</h3>
<pre><code>$ sdc-fabric network list
</code></pre>
<h4 id="example-request_82">Example Request</h4>
<pre><code>GET /login/fabrics/default/vlans/2/networks HTTP/1.1
Authorization: Basic ...
Host: api.example.com
Accept: application/json
Accept-version: ~7.3
</code></pre>
<h4 id="example-response_82">Example Response</h4>
<pre><code>HTTP/1.1 200 OK
Content-Type: application/json
Server: Joyent Triton 7.3.0
Api-Version: 7.3.0

[
  {
    "id": "7326787b-8039-436c-a533-5038f7280f04",
    "name": "default",
    "public": false,
    "fabric": true,
    "gateway": "192.168.128.1",
    "internet_nat": true,
    "provision_end_ip": "192.168.131.250",
    "provision_start_ip": "192.168.128.5",
    "resolvers": [
      "8.8.8.8",
      "8.8.4.4"
    ],
    "subnet": "192.168.128.0/22",
    "vlan_id": 2
  },
  {
    "id": "7fa999c8-0d2c-453e-989c-e897716d0831",
    "name": "newnet",
    "public": false,
    "fabric": true,
    "gateway": "10.50.1.1",
    "internet_nat": true,
    "provision_end_ip": "10.50.1.20",
    "provision_start_ip": "10.50.1.2",
    "resolvers": [
      "8.8.8.8",
      "8.8.4.4"
    ],
    "routes": {
      "10.25.1.0/21": "10.50.1.2",
      "10.27.1.0/21": "10.50.1.3"
    },
    "subnet": "10.50.1.0/24",
    "vlan_id": 2
  }
]
</code></pre>
<h2 id="createfabricnetwork-post-loginfabricsdefaultvlansvlan_idnetworks">CreateFabricNetwork (POST /:login/fabrics/default/vlans/:vlan_id/networks)</h2>
<h3 id="inputs_90">Inputs</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>String</td>
<td>The network name; must be unique</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>Description of this network (optional)</td>
</tr>
<tr>
<td>subnet</td>
<td>String</td>
<td>A CIDR formatted string that describes the network</td>
</tr>
<tr>
<td>provision_start_ip</td>
<td>String</td>
<td>The first IP on the network that may be assigned</td>
</tr>
<tr>
<td>provision_end_ip</td>
<td>String</td>
<td>The last IP on the network that may be assigned</td>
</tr>
<tr>
<td>gateway</td>
<td>String</td>
<td>Optional Gateway IP address</td>
</tr>
<tr>
<td>resolvers</td>
<td>String</td>
<td>Optional resolver IP addresses</td>
</tr>
<tr>
<td>routes</td>
<td>Routes Object</td>
<td>Optional Static routes for hosts on this network</td>
</tr>
<tr>
<td>internet_nat</td>
<td>Boolean</td>
<td>Provision internet NAT zone on gateway address, default is true</td>
</tr>
</tbody>
</table>
<h3 id="returns_90">Returns</h3>
<p>Network Object:</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>Unique id for this network</td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td>The network name</td>
</tr>
<tr>
<td>public</td>
<td>Boolean</td>
<td>Whether this a public or private (rfc1918) network</td>
</tr>
<tr>
<td>fabric</td>
<td>Boolean</td>
<td>Whether this network is created on a fabric</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>Description of this network (optional)</td>
</tr>
<tr>
<td>subnet</td>
<td>String</td>
<td>A CIDR formatted string that describes the network</td>
</tr>
<tr>
<td>provision_start_ip</td>
<td>String</td>
<td>The first IP on the network that may be assigned</td>
</tr>
<tr>
<td>provision_end_ip</td>
<td>String</td>
<td>The last IP on the network that may be assigned</td>
</tr>
<tr>
<td>gateway</td>
<td>String</td>
<td>Optional Gateway IP address</td>
</tr>
<tr>
<td>resolvers</td>
<td>String</td>
<td>Resolver IP addresses</td>
</tr>
<tr>
<td>routes</td>
<td>Routes Object</td>
<td>Optional Static routes for hosts on this network</td>
</tr>
<tr>
<td>internet_nat</td>
<td>Boolean</td>
<td>Provision internet NAT zone on gateway address</td>
</tr>
</tbody>
</table>
<h3 id="errors_90">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_85">CLI Command</h3>
<pre><code>$ sdc-fabric network create --vlan_id=2 --name="newnet" --subnet="10.50.1.0/24" --provision_start_ip="10.50.1.5" --provision_end_ip="10.50.1.20" --resolvers="8.8.8.8" --resolvers="8.8.4.4" --gateway="10.50.1.1" --routes='{"10.25.1.0/21":"10.50.1.2","10.27.1.0/21":"10.50.1.3"}'
</code></pre>
<h4 id="example-request_83">Example Request</h4>
<pre><code>POST /login/fabrics/default/vlans/2/networks HTTP/1.1
Authorization: Basic ...
Host: api.example.com
Accept: application/json
Accept-version: ~7.3

{
  "name": "newnet",
  "provision_end_ip": "10.50.1.20",
  "provision_start_ip": "10.50.1.5",
  "gateway": "10.50.1.1",
  "resolvers": [
    "8.8.8.8",
    "8.8.4.4"
  ],
  "routes": {
    "10.25.1.0/21": "10.50.1.2",
    "10.27.1.0/21": "10.50.1.3"
  },
  "subnet": "10.50.1.0/24"
}
</code></pre>
<h4 id="example-response_83">Example Response</h4>
<pre><code>HTTP/1.1 201 Created
Content-Type: application/json
Server: Joyent Triton 7.3.0
Api-Version: 7.3.0

{
  "id": "7fa999c8-0d2c-453e-989c-e897716d0831",
  "name": "newnet",
  "public": false,
  "fabric": true,
  "gateway": "10.50.1.1",
  "internet_nat": true,
  "provision_end_ip": "10.50.1.20",
  "provision_start_ip": "10.50.1.5",
  "resolvers": [
    "8.8.8.8",
    "8.8.4.4"
  ],
  "routes": {
    "10.25.1.0/21": "10.50.1.2",
    "10.27.1.0/21": "10.50.1.3"
  },
  "subnet": "10.50.1.0/24",
  "vlan_id": 2
}
</code></pre>
<h4 id="more-examples_1">More Examples</h4>
<p>Create network with no internet NAT zone</p>
<pre><code>$ sdc-fabric network create --vlan_id=2 --name="internal-net" --subnet="192.168.64.0/24" --provision_start_ip="192.168.64.2" --provision_end_ip="192.168.64.254" --resolvers="8.8.8.8" --gateway="192.168.64.1" --no_internet_nat
</code></pre>
<h2 id="getfabricnetwork-get-loginfabricsdefaultvlansvlan_idnetworksid">GetFabricNetwork (GET /:login/fabrics/default/vlans/:vlan_id/networks/:id)</h2>
<h3 id="inputs_91">Inputs</h3>
<ul>
<li>None</li>
</ul>
<h3 id="returns_91">Returns</h3>
<p>The details of the network object:</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>Unique id for this network</td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td>The network name</td>
</tr>
<tr>
<td>public</td>
<td>Boolean</td>
<td>Whether this a public or private (rfc1918) network</td>
</tr>
<tr>
<td>fabric</td>
<td>Boolean</td>
<td>Whether this network is created on a fabric</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>Description of this network (optional)</td>
</tr>
<tr>
<td>subnet</td>
<td>String</td>
<td>A CIDR formatted string that describes the network</td>
</tr>
<tr>
<td>provision_start_ip</td>
<td>String</td>
<td>The first IP on the network that may be assigned</td>
</tr>
<tr>
<td>provision_end_ip</td>
<td>String</td>
<td>The last IP on the network that may be assigned</td>
</tr>
<tr>
<td>gateway</td>
<td>String</td>
<td>Optional Gateway IP address</td>
</tr>
<tr>
<td>resolvers</td>
<td>String</td>
<td>Resolver IP addresses</td>
</tr>
<tr>
<td>routes</td>
<td>Routes Object</td>
<td>Optional Static routes for hosts on this network</td>
</tr>
<tr>
<td>internet_nat</td>
<td>Boolean</td>
<td>Provision internet NAT zone on gateway address</td>
</tr>
</tbody>
</table>
<h3 id="errors_91">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code>, <code>:vlan_id</code> or <code>:id</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_86">CLI Command</h3>
<pre><code>$ sdc-fabric network get 7fa999c8-0d2c-453e-989c-e897716d0831
</code></pre>
<h4 id="example-request_84">Example Request</h4>
<pre><code>GET /login/fabrics/default/vlans/2/networks/7fa999c8-0d2c-453e-989c-e897716d0831 HTTP/1.1
Authorization: Basic ...
Host: api.example.com
Accept: application/json
Accept-version: ~7.3
</code></pre>
<h4 id="example-response_84">Example Response</h4>
<pre><code>HTTP/1.1 200 OK
Content-Type: application/json
Server: Joyent Triton 7.3.0
Api-Version: 7.3.0

{
  "id": "7fa999c8-0d2c-453e-989c-e897716d0831",
  "name": "newnet",
  "public": false,
  "fabric": true,
  "gateway": "10.50.1.1",
  "internet_nat": true,
  "provision_end_ip": "10.50.1.20",
  "provision_start_ip": "10.50.1.5",
  "resolvers": [
    "8.8.8.8",
    "8.8.4.4"
  ],
  "routes": {
    "10.25.1.0/21": "10.50.1.2",
    "10.27.1.0/21": "10.50.1.3"
  },
  "subnet": "10.50.1.0/24",
  "vlan_id": 2
}
</code></pre>
<h2 id="updatefabricnetwork-put-loginfabricsdefaultvlansvlan_idnetworksid">UpdateFabricNetwork (PUT /:login/fabrics/default/vlans/:vlan_id/networks/:id)</h2>
<h3 id="inputs_92">Inputs</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>String</td>
<td>The network name; must be unique (optional)</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>Description of this network (optional)</td>
</tr>
<tr>
<td>provision_start_ip</td>
<td>String</td>
<td>The first IP on the network that may be assigned (optional)</td>
</tr>
<tr>
<td>provision_end_ip</td>
<td>String</td>
<td>The last IP on the network that may be assigned (optional)</td>
</tr>
<tr>
<td>resolvers</td>
<td>String</td>
<td>Resolver IP addresses (optional)</td>
</tr>
<tr>
<td>routes</td>
<td>Routes Object</td>
<td>Static routes for hosts on this network (optional)</td>
</tr>
</tbody>
</table>
<h3 id="returns_92">Returns</h3>
<p>Network Object:</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>Unique id for this network</td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td>The network name</td>
</tr>
<tr>
<td>public</td>
<td>Boolean</td>
<td>Whether this a public or private (rfc1918) network</td>
</tr>
<tr>
<td>fabric</td>
<td>Boolean</td>
<td>Whether this network is created on a fabric</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>Description of this network (optional)</td>
</tr>
<tr>
<td>subnet</td>
<td>String</td>
<td>A CIDR formatted string that describes the network</td>
</tr>
<tr>
<td>provision_start_ip</td>
<td>String</td>
<td>The first IP on the network that may be assigned</td>
</tr>
<tr>
<td>provision_end_ip</td>
<td>String</td>
<td>The last IP on the network that may be assigned</td>
</tr>
<tr>
<td>gateway</td>
<td>String</td>
<td>Optional Gateway IP address</td>
</tr>
<tr>
<td>resolvers</td>
<td>String</td>
<td>Resolver IP addresses</td>
</tr>
<tr>
<td>routes</td>
<td>Routes Object</td>
<td>Optional Static routes for hosts on this network</td>
</tr>
<tr>
<td>internet_nat</td>
<td>Boolean</td>
<td>Provision internet NAT zone on gateway address</td>
</tr>
</tbody>
</table>
<h3 id="errors_92">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_87">CLI Command</h3>
<pre><code>$sdc-fabric network update 17dbc20a-2782-4e88-90f0-4d4a1bb0501f -n "updatenet" --resolvers="8.8.4.4" --routes='{"172.16.10.1/24":"192.168.128.1"}' --description="updated description"
</code></pre>
<h4 id="example-request_85">Example Request</h4>
<pre><code>PUT /login/fabrics/default/vlans/2/networks/17dbc20a-2782-4e88-90f0-4d4a1bb0501f HTTP/1.1
Authorization: Basic ...
Host: api.example.com
Accept: application/json
Accept-version: ~7.3

{
  "name": "updatenet",
  "description": "updated description",
  "resolvers": [
    "8.8.8.8"
  ],
  "routes": {
    "172.16.10.0/24": "192.16.128.1"
  }
}
</code></pre>
<h4 id="example-response_85">Example Response</h4>
<pre><code>HTTP/1.1 201 Created
Content-Type: application/json
Server: Joyent Triton 7.3.0
Api-Version: 7.3.0

{
  "id": "17dbc20a-2782-4e88-90f0-4d4a1bb0501f",
  "name": "newnet",
  "public": false,
  "fabric": true,
  "description": "updated description",
  "gateway": "192.168.128.1",
  "internet_nat": true,
  "provision_end_ip": "192.168.131.250",
  "provision_start_ip": "192.168.128.5",
  "resolvers": [
    "8.8.4.4"
  ],
  "routes": {
    "172.16.10.1/24": "192.168.128.1"
  },
  "subnet": "192.168.128.0/22",
  "vlan_id": 2
}
</code></pre>
<h2 id="deletefabricnetwork-delete-loginfabricsdefaultvlansvlan_idnetworksid">DeleteFabricNetwork (DELETE /:login/fabrics/default/vlans/:vlan_id/networks/:id)</h2>
<p>Deletes the specified Network. Note that no instances may be provisioned on the
Network.</p>
<h3 id="inputs_93">Inputs</h3>
<ul>
<li>None</li>
</ul>
<h3 id="returns_93">Returns</h3>
<ul>
<li>None</li>
</ul>
<h3 id="errors_93">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code>, <code>:vlan_id</code> or <code>:id</code> does not exist</td>
</tr>
<tr>
<td>InUseError</td>
<td>The VLAN currently has active networks on it</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_88">CLI Command</h3>
<pre><code>$ sdc-fabric network delete 7fa999c8-0d2c-453e-989c-e897716d0831
</code></pre>
<h4 id="example-request_86">Example Request</h4>
<pre><code>DELETE /login/fabrics/default/vlans/2/networks/7fa999c8-0d2c-453e-989c-e897716d0831 HTTP/1.1
Authorization: Basic ...
Host: api.example.com
Accept: application/json
Accept-version: ~7.3
</code></pre>
<h4 id="example-response_86">Example Response</h4>
<pre><code>HTTP/1.1 204 No Content
Content-Type: application/json
Server: Joyent Triton 7.3.0
Api-Version: 7.3.0
</code></pre>
<h1 id="networks">Networks</h1>
<p>CloudAPI provides a way to get details on public and customer-specific networks
in a datacenter. This also includes all of the networks available in your
fabric. Your fabric networks are exclusive to your account. All other networks
may be usable by other tenants.</p>
<h2 id="listnetworks-get-loginnetworks">ListNetworks (GET /:login/networks)</h2>
<p>List all the networks which can be used by the given account. If a network was
created on a fabric, then additional information will be shown:</p>
<h3 id="inputs_94">Inputs</h3>
<ul>
<li>None</li>
</ul>
<h3 id="returns_94">Returns</h3>
<p>An array of network objects.  Networks are:</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>Unique id for this network</td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td>The network name</td>
</tr>
<tr>
<td>public</td>
<td>Boolean</td>
<td>Whether this a public or private (rfc1918) network</td>
</tr>
<tr>
<td>fabric</td>
<td>Boolean</td>
<td>Whether this network is created on a fabric</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>Description of this network (optional)</td>
</tr>
</tbody>
</table>
<p>Each object returned may be an individual network, or a network pool. A network
pool is a logical grouping of one or more networks that share the same
routability characteristics. See <a href="#AddNic">AddNic</a> about the behavior of
provisioning with a network pool. This also means that the network id(s)
returned by GetMachine or GetNic will not be in the list of networks returned
by ListNetworks if it was originally provisioned using a pool.</p>
<p>If the network is on a fabric, the following additional fields are included:</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>subnet</td>
<td>String</td>
<td>A CIDR formatted string that describes the network</td>
</tr>
<tr>
<td>provision_start_ip</td>
<td>String</td>
<td>The first IP on the network that may be assigned</td>
</tr>
<tr>
<td>provision_end_ip</td>
<td>String</td>
<td>The last IP on the network that may be assigned</td>
</tr>
<tr>
<td>gateway</td>
<td>String</td>
<td>Optional Gateway IP address</td>
</tr>
<tr>
<td>resolvers</td>
<td>String</td>
<td>Optional Resolver IP addresses</td>
</tr>
<tr>
<td>routes</td>
<td>Routes Object</td>
<td>Optional Static routes for hosts on this network</td>
</tr>
<tr>
<td>internet_nat</td>
<td>Boolean</td>
<td>Provision internet NAT zone on gateway address</td>
</tr>
</tbody>
</table>
<h3 id="errors_94">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_89">CLI Command</h3>
<pre><code>$ triton network list
</code></pre>
<p>or</p>
<pre><code>$ sdc-listnetworks
</code></pre>
<h4 id="example-request_87">Example Request</h4>
<pre><code>GET /my/networks HTTP/1.1
authorization: Signature keyId="...
accept: application/json
accept-version: ~8
host: api.example.com
connection: keep-alive
</code></pre>
<h4 id="example-response_87">Example Response</h4>
<pre><code>HTTP/1.1 200 OK
content-type: application/json
content-length: 158
access-control-allow-origin: *
access-control-allow-headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
access-control-allow-methods: GET, HEAD
access-control-expose-headers: Api-Version, Request-Id, Response-Time
connection: Keep-Alive
content-md5: v6s92rl/nTS2Ts5CNDcgQw==
server: Joyent Triton 8.0.0
api-version: 8.0.0
request-id: 35147710-7f49-11e2-8585-bd5fc323c72c
response-time: 134

[
  {
    "id": "daeb93a2-532e-4bd4-8788-b6b30f10ac17",
    "name": "external",
    "public": true
  }
]
</code></pre>
<h2 id="getnetwork-get-loginnetworksid">GetNetwork (GET /:login/networks/:id)</h2>
<p>Retrieves information about an individual network.</p>
<h3 id="inputs_95">Inputs</h3>
<ul>
<li>None</li>
</ul>
<h3 id="returns_95">Returns</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>Unique id for this network</td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td>The network name</td>
</tr>
<tr>
<td>public</td>
<td>Boolean</td>
<td>Whether this a public or private (rfc1918) network</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>Description of this network (optional)</td>
</tr>
</tbody>
</table>
<h3 id="errors_95">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> or <code>:id</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_90">CLI Command</h3>
<pre><code>$ triton network get daeb93a2-532e-4bd4-8788-b6b30f10ac17
</code></pre>
<p>or</p>
<pre><code>$ sdc-getnetwork daeb93a2-532e-4bd4-8788-b6b30f10ac17
</code></pre>
<h4 id="example-request_88">Example Request</h4>
<pre><code>GET /my/networks/daeb93a2-532e-4bd4-8788-b6b30f10ac17 HTTP/1.1
authorization: Signature keyId="...
accept: application/json
accept-version: ~8
host: api.example.com
</code></pre>
<h4 id="example-response_88">Example Response</h4>
<pre><code>HTTP/1.1 200 OK
content-type: application/json
content-length: 156
access-control-allow-origin: *
access-control-allow-headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
access-control-allow-methods: GET, HEAD
access-control-expose-headers: Api-Version, Request-Id, Response-Time
server: Joyent Triton 8.0.0
api-version: 8.0.0
request-id: cf1c1340-7f49-11e2-8585-bd5fc323c72c
response-time: 203

{
  "id": "daeb93a2-532e-4bd4-8788-b6b30f10ac17",
  "name": "external",
  "public": true
}
</code></pre>
<h2 id="listnetworkips-get-loginnetworksidips">ListNetworkIPs (GET /:login/networks/:id/ips)</h2>
<p>List a network's IPs. On a public network only IPs owned by the user will be
returned.  On a private network all IPs that are either reserved or allocated
will be returned.</p>
<p>Note that not every network from <a href="#ListNetworks">ListNetworks</a> will work. Some
UUIDs are for pools which are not supported at this time.  However, every
network UUID from <a href="#GetMachine">GetMachine</a> and <a href="#GetNic">GetNic</a> will work, as
they are UUIDs for a specific network.</p>
<p>The <code>reserved</code> field determines if the IP can be used automatically when
provisioning a new instance. If <code>reserved</code> is set to true, then the IP will not
be given out.</p>
<p>The <code>managed</code> field in the IP object tells you if the IP is manged by Triton
itself. An example of this is the gateway and broadcast IPs on a network.</p>
<p>If the IP is associated with an instance then <code>owner_uuid</code> will be shown as
well, so that on shared private networks it is clear who is using the IP.  The
<code>belongs_to_uuid</code> field will tell you which instance owns the IP if any, and
will only be present if that instance is owned by you.</p>
<p>You can paginate this API by passing in <code>offset</code> and <code>limit</code>.  HTTP responses
will contain the additional headers <code>x-resource-count</code> and <code>x-query-limit</code>.  If
<code>x-resource-count</code> is less than <code>x-query-limit</code>, you're done, otherwise call the
API again with <code>offset</code> set to <code>offset</code> + <code>limit</code> to fetch additional instances.</p>
<h3 id="inputs_96">Inputs</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>limit</td>
<td>Number</td>
<td>Return a max of N IPs; default is 1000 (which is also the maximum allowable result set size)</td>
</tr>
<tr>
<td>offset</td>
<td>Number</td>
<td>Get a <code>limit</code> number of IPs starting at this <code>offset</code></td>
</tr>
</tbody>
</table>
<h3 id="returns_96">Returns</h3>
<p>An array of IP objects.  IPs are:</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ip</td>
<td>String</td>
<td>IP Address</td>
</tr>
<tr>
<td>reserved</td>
<td>Boolean</td>
<td>Whether this IP is reserved or not</td>
</tr>
<tr>
<td>managed</td>
<td>Boolean</td>
<td>True if the user cannot modify the IP via UpdateNetworkIP (example broadcast and gateway IPs)</td>
</tr>
<tr>
<td>owner_uuid</td>
<td>UUID</td>
<td>UUID of the owner that the instance is associated with (Optional)</td>
</tr>
<tr>
<td>belongs_to_uuid</td>
<td>UUID</td>
<td>UUID of the instance the IP is associated with (Optional)</td>
</tr>
</tbody>
</table>
<h3 id="errors_96">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> or <code>:id</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_91">CLI Command</h3>
<pre><code>$ triton network ip list daeb93a2-532e-4bd4-8788-b6b30f10ac17
</code></pre>
<h4 id="example-request_89">Example Request</h4>
<pre><code>GET /my/networks/daeb93a2-532e-4bd4-8788-b6b30f10ac17/ips HTTP/1.1
authorization: Signature keyId="...
accept: application/json
accept-version: ~8
host: api.example.com
</code></pre>
<h4 id="example-response_89">Example Response</h4>
<pre><code>HTTP/1.1 200 OK
x-query-limit: 1000
x-resource-count: 4
Content-Type: application/json
Content-Length: 331
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: GET, HEAD
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Content-MD5: +d/D0BiDjXGmeuxP93uZ5Q==
Date: Tue, 31 Oct 2017 20:49:11 GMT
Server: cloudapi/8.3.0
Api-Version: 8.0.0
Request-Id: fdbce926-fc33-456f-af3c-c39b59cd4066
Response-Time: 82

[
  {
    "ip": "192.168.128.1",
    "reserved": true,
    "managed": true
  },
  {
    "ip": "192.168.128.4",
    "reserved": true,
    "managed": false
  },
  {
    "ip": "192.168.128.5",
    "reserved": false,
    "owner_uuid": "7dfbbcda-4f62-cdf8-df31-d1e4d8d34c5e",
    "belongs_to_uuid": "272a7a08-ddc7-c4b2-97bd-ae3257fd8eb9",
    "managed": false
  },
  {
    "ip": "192.168.131.255",
    "reserved": true,
    "managed": true
  }
]
</code></pre>
<h2 id="getnetworkip-get-loginnetworksidipsip_address">GetNetworkIP (GET /:login/networks/:id/ips/:ip_address)</h2>
<p>Get a network's IP. On a public network you can only get an IP owned by you. On
private network you can get an IP owned by any of the network's shared owners,
however the <code>belongs_to_uuid</code> field will be omitted if you do not own the
instance the IP is assocaited with.</p>
<h3 id="inputs_97">Inputs</h3>
<ul>
<li>None</li>
</ul>
<h3 id="returns_97">Returns</h3>
<p>An IP object:</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ip</td>
<td>String</td>
<td>IP Address</td>
</tr>
<tr>
<td>reserved</td>
<td>Boolean</td>
<td>Whether this IP is reserved or not</td>
</tr>
<tr>
<td>managed</td>
<td>Boolean</td>
<td>True if the user cannot modify the IP via UpdateNetworkIP (example broadcast and gateway IPs)</td>
</tr>
<tr>
<td>owner_uuid</td>
<td>UUID</td>
<td>UUID of the owner that the instance is associated with (Optional)</td>
</tr>
<tr>
<td>belongs_to_uuid</td>
<td>UUID</td>
<td>UUID of the instance the IP is associated with (Optional)</td>
</tr>
</tbody>
</table>
<h3 id="errors_97">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code>, <code>:id</code>, or <code>:ip_address</code> does not exist</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_92">CLI Command</h3>
<pre><code>$ triton network ip get daeb93a2-532e-4bd4-8788-b6b30f10ac17 192.168.128.5
</code></pre>
<h4 id="example-request_90">Example Request</h4>
<pre><code>GET /my/networks/daeb93a2-532e-4bd4-8788-b6b30f10ac17/ips/192.168.128.5 HTTP/1.1
authorization: Signature keyId="...
accept: application/json
accept-version: ~8
host: api.example.com
</code></pre>
<h4 id="example-response_90">Example Response</h4>
<pre><code>HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 164
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: GET
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Content-MD5: E65nD1+bNuM3eutsB/8lPw==
Date: Tue, 31 Oct 2017 20:54:03 GMT
Server: cloudapi/8.3.0
Api-Version: 8.0.0
Request-Id: a31097ad-6154-45a3-af08-e3dfddd70d22
Response-Time: 393

{
  "ip": "192.168.128.5",
  "reserved": false,
  "owner_uuid": "7dfbbcda-4f62-cdf8-df31-d1e4d8d34c5e",
  "belongs_to_uuid": "272a7a08-ddc7-c4b2-97bd-ae3257fd8eb9",
  "managed": false
}
</code></pre>
<h2 id="updatenetworkip-put-loginnetworksidipsip_address">UpdateNetworkIP (PUT /:login/networks/:id/ips/:ip_address)</h2>
<p>Update a network's IP to toggle the <code>reserved</code> flag. If <code>reserved</code> is set to
<code>true</code> the IP will not be given out automatically at provision time. You cannot
update an IP on a public network. On private networks you can update an IP that
is already in use by an instance owned by you, or an IP that is not yet in use
as long as it's within the network's subnet.</p>
<h3 id="inputs_98">Inputs</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>reserved</td>
<td>boolean</td>
<td>If true take the IP out of the provisioning pool</td>
</tr>
</tbody>
</table>
<h3 id="returns_98">Returns</h3>
<p>An IP object:</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ip</td>
<td>String</td>
<td>IP Address</td>
</tr>
<tr>
<td>reserved</td>
<td>Boolean</td>
<td>Whether this IP is reserved or not</td>
</tr>
<tr>
<td>managed</td>
<td>Boolean</td>
<td>True if the user cannot modify the IP via UpdateNetworkIP (example broadcast and gateway IPs)</td>
</tr>
<tr>
<td>owner_uuid</td>
<td>UUID</td>
<td>UUID of the owner that the instance is associated with (Optional)</td>
</tr>
<tr>
<td>belongs_to_uuid</td>
<td>UUID</td>
<td>UUID of the instance the IP is associated with (Optional)</td>
</tr>
</tbody>
</table>
<h3 id="errors_98">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code>, <code>:id</code>, or <code>:ip_address</code> does not exist</td>
</tr>
<tr>
<td>InvalidArgument</td>
<td>If <code>:id</code> is not a UUID, or it is a public network. If <code>:ip_address</code> is in use by another user</td>
</tr>
<tr>
<td>MissingParameter</td>
<td>If the <code>reserved</code> argument isn't specefied</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_93">CLI Command</h3>
<pre><code>$ triton network ip update daeb93a2-532e-4bd4-8788-b6b30f10ac17 192.168.128.5 reserved=false
</code></pre>
<h4 id="example-request_91">Example Request</h4>
<pre><code>PUT  /my/networks/daeb93a2-532e-4bd4-8788-b6b30f10ac17/ips/192.168.128.5 HTTP/1.1
authorization: Signature keyId="...
accept: application/json
accept-version: ~8
host: api.example.com

{
  "reserved": false
}
</code></pre>
<h4 id="example-response_91">Example Response</h4>
<pre><code>HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 55
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
Access-Control-Allow-Methods: PUT, GET, HEAD
Access-Control-Expose-Headers: Api-Version, Request-Id, Response-Time
Connection: Keep-Alive
Content-MD5: DvheKXPZSZw5lav9REKHuw==
Date: Wed, 22 Nov 2017 18:53:02 GMT
Server: cloudapi/8.3.0
Api-Version: 8.0.0
Request-Id: a9715a00-6194-4053-9846-fcdf9c5476fb
Response-Time: 76

{
  "ip": "192.168.128.5",
  "reserved": false,
  "managed": false
}
</code></pre>
<h1 id="nics">Nics</h1>
<p>CloudAPI provides a way to list, add and remove NICs attached to a instance.</p>
<h2 id="listnics-get-loginmachinesidnics">ListNics (GET /:login/machines/:id/nics)</h2>
<p>List all the NICs on an instance belonging to a given account.</p>
<h3 id="inputs_99">Inputs</h3>
<ul>
<li>None</li>
</ul>
<h3 id="returns_99">Returns</h3>
<p>An array of NIC objects. NICs are:</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ip</td>
<td>String</td>
<td>NIC's IPv4 address</td>
</tr>
<tr>
<td>mac</td>
<td>String</td>
<td>NIC's MAC address</td>
</tr>
<tr>
<td>primary</td>
<td>Boolean</td>
<td>Whether this is the instance's primary NIC</td>
</tr>
<tr>
<td>netmask</td>
<td>String</td>
<td>IPv4 netmask</td>
</tr>
<tr>
<td>gateway</td>
<td>String</td>
<td>IPv4 gateway</td>
</tr>
<tr>
<td>state</td>
<td>String</td>
<td>Describes the state of the NIC (e.g. provisioning, running, or stopped)</td>
</tr>
<tr>
<td>network</td>
<td>UUID</td>
<td>The NIC's network id (see <a href="#ListNetworks">ListNetworks</a>)</td>
</tr>
</tbody>
</table>
<h3 id="errors_99">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login or</code>:id` does not exist</td>
</tr>
<tr>
<td>InvalidArgument</td>
<td>If <code>:id</code> isn't a UUID</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_94">CLI Command</h3>
<pre><code>$ sdc-nics list 76a533e9-aa3c-4fd4-a194-03fa05663e0e
</code></pre>
<h4 id="example-request_92">Example Request</h4>
<pre><code>GET /my/machine/76a533e9-aa3c-4fd4-a194-03fa05663e0e/nics HTTP/1.1
authorization: Signature keyId="...
accept: application/json
accept-version: ~7.1
host: api.example.com
connection: keep-alive
</code></pre>
<h4 id="example-response_92">Example Response</h4>
<pre><code>HTTP/1.1 200 OK
content-type: application/json
content-length: 286
date: Sat, 03 May 2014 13:37:36 GMT
access-control-allow-origin: *
access-control-allow-headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
access-control-allow-methods: POST, GET, HEAD
access-control-expose-headers: Api-Version, Request-Id, Response-Time
connection: Keep-Alive
content-md5: ahIN4rEEcEIJGltGn9cqRQ==
server: Joyent Triton 7.2.0
api-version: 7.2.0
request-id: 6b8c5170-d45a-11e3-8db6-c7649670227d
response-time: 183
x-resource-count: 1

[
    {
        "mac": "90:b8:d0:2f:b8:f9",
        "primary": true,
        "ip": "10.88.88.137",
        "netmask": "255.255.255.0",
        "gateway": "10.88.88.2",
        "state": "running",
        "network": "6b3229b6-c535-11e5-8cf9-c3a24fa96e35"
    }
]
</code></pre>
<h2 id="getnic-get-loginmachinesidnicsmac">GetNic (GET /:login/machines/:id/nics/:mac)</h2>
<p>Gets a specific NIC on an instance belonging to a given account.</p>
<p>NB: the <code>:mac</code> element in the path must have all the colons (':') stripped from
it in the request.</p>
<h3 id="inputs_100">Inputs</h3>
<ul>
<li>None</li>
</ul>
<h3 id="returns_100">Returns</h3>
<p>A NIC object:</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ip</td>
<td>String</td>
<td>NIC's IPv4 address</td>
</tr>
<tr>
<td>mac</td>
<td>String</td>
<td>NIC's MAC address</td>
</tr>
<tr>
<td>primary</td>
<td>Boolean</td>
<td>Whether this is the instance's primary NIC</td>
</tr>
<tr>
<td>netmask</td>
<td>String</td>
<td>IPv4 netmask</td>
</tr>
<tr>
<td>gateway</td>
<td>String</td>
<td>IPv4 gateway</td>
</tr>
<tr>
<td>state</td>
<td>String</td>
<td>Describes the state of the NIC (e.g. provisioning, running, or stopped)</td>
</tr>
<tr>
<td>network</td>
<td>UUID</td>
<td>The NIC's network id (see <a href="#ListNetworks">ListNetworks</a>)</td>
</tr>
</tbody>
</table>
<h3 id="errors_100">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code>, <code>:id</code>, or <code>:mac</code> does not exist</td>
</tr>
<tr>
<td>InvalidArgument</td>
<td>If <code>:id</code> isn't a UUID, or <code>:mac</code> isn't a MAC address (without colons)</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_95">CLI Command</h3>
<pre><code>$ sdc-nics get 90:b8:d0:2f:b8:f9 76a533e9-aa3c-4fd4-a194-03fa05663e0e
</code></pre>
<h4 id="example-request_93">Example Request</h4>
<pre><code>GET /my/machine/76a533e9-aa3c-4fd4-a194-03fa05663e0e/nics/90b8d02fb8f9 HTTP/1.1
authorization: Signature keyId="...
accept: application/json
accept-version: ~7.1
host: api.example.com
connection: keep-alive
</code></pre>
<h4 id="example-response_93">Example Response</h4>
<pre><code>HTTP/1.1 200 OK
content-type: application/json
content-length: 284
date: Sat, 03 May 2014 13:37:36 GMT
access-control-allow-origin: *
access-control-allow-headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
access-control-allow-methods: GET, HEAD, DELETE
access-control-expose-headers: Api-Version, Request-Id, Response-Time
connection: Keep-Alive
content-md5: ahIN4rEEcEIJGltGn9cqRQ==
server: Joyent Triton 7.2.0
api-version: 7.2.0
request-id: 6b8c5170-d45a-11e3-8db6-c7649670227d
response-time: 183
x-resource-count: 1

{
    "mac": "90:b8:d0:2f:b8:f9",
    "primary": true,
    "ip": "10.88.88.137",
    "netmask": "255.255.255.0",
    "gateway": "10.88.88.2",
    "state": "running",
    "network": "6b3229b6-c535-11e5-8cf9-c3a24fa96e35"
}
</code></pre>
<h2 id="addnic-post-loginmachinesidnics">AddNic (POST /:login/machines/:id/nics)</h2>
<p>Creates a new NIC on an instance belonging to a given account.</p>
<p><em>WARNING</em>: this causes the instance to reboot while adding the NIC.</p>
<h3 id="inputs_101">Inputs</h3>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>network</td>
<td>Object or String</td>
<td><a href="#network-objects">Network object</a> or network UUID string.</td>
</tr>
</tbody>
</table>
<h3 id="returns_101">Returns</h3>
<p>The newly-created NIC object:</p>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ip</td>
<td>String</td>
<td>NIC's IPv4 address</td>
</tr>
<tr>
<td>mac</td>
<td>String</td>
<td>NIC's MAC address</td>
</tr>
<tr>
<td>primary</td>
<td>Boolean</td>
<td>Whether this is the instance's primary NIC</td>
</tr>
<tr>
<td>netmask</td>
<td>String</td>
<td>IPv4 netmask</td>
</tr>
<tr>
<td>gateway</td>
<td>String</td>
<td>IPv4 gateway</td>
</tr>
<tr>
<td>state</td>
<td>String</td>
<td>Describes the state of the NIC (most likely 'provisioning')</td>
</tr>
<tr>
<td>network</td>
<td>String</td>
<td>The network UUID. See below.</td>
</tr>
</tbody>
</table>
<p>It also returns the Location in the headers where the new NIC lives in the HTTP
API. If a NIC already exists for that network, a 302 redirect will be returned
instead of the object.</p>
<p>As of CloudAPI v8.5.0, AddNic now accepts a <a href="#network-objects">network object</a>
for the network parameter.  It's still possible to pass in just the network UUID
string instead of using the new network object format.</p>
<p>If the input network uuid is a network pool (a logical grouping of one or more
networks that share the same routability characteristics) then a NIC will be
provisioned from one of the associated networks. The network UUID returned will
always be the UUID of the actual network assigned, not the UUID of the pool.</p>
<p>NICs do not appear on an instance immediately, so the state of the new NIC can
be checked by polling <a href="#GetNic">GetNic</a>. While the NIC is provisioning, it will
have a <code>state</code> of 'provisioning'.  Once the Nic is active on the instance the
NIC will have a <code>state</code> of 'running'.  If the provision fails, the NIC will be
removed and GetNic will start returning 404.</p>
<h3 id="errors_101">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code> or <code>:id</code> does not exist</td>
</tr>
<tr>
<td>InvalidArgument</td>
<td>If <code>:id</code> isn't a UUID, or the <code>network</code> argument isn't a valid UUID</td>
</tr>
<tr>
<td>MissingParameter</td>
<td>If the <code>network</code> argument isn't present</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_96">CLI Command</h3>
<pre><code>$ sdc-nics create 7007b198-f6aa-48f0-9843-78a3149de3d7 76a533e9-aa3c-4fd4-a194-03fa05663e0e
</code></pre>
<h4 id="example-request_94">Example Request</h4>
<pre><code>POST /my/machine/76a533e9-aa3c-4fd4-a194-03fa05663e0e/nics HTTP/1.1
authorization: Signature keyId="...
accept: application/json
accept-version: ~7.1
host: api.example.com
connection: keep-alive

{
    "network": "7007b198-f6aa-48f0-9843-78a3149de3d7"
}
</code></pre>
<h4 id="example-response_94">Example Response</h4>
<pre><code>HTTP/1.1 201 Created
content-type: application/json
content-length: 284
date: Sat, 03 May 2014 13:37:36 GMT
access-control-allow-origin: *
access-control-allow-headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
access-control-allow-methods: POST, GET, HEAD
access-control-expose-headers: Api-Version, Request-Id, Response-Time
connection: Keep-Alive
content-md5: ahIN4rEEcEIJGltGn9cqRQ==
location: /my/machines/76a533e9-aa3c-4fd4-a194-03fa05663e0e/nics/90b8d02fb8f9
server: Joyent Triton 7.2.0
api-version: 7.2.0
request-id: 6b8c5170-d45a-11e3-8db6-c7649670227d
response-time: 183
x-resource-count: 1

{
    "mac": "90:b8:d0:2f:b8:f9",
    "primary": false,
    "ip": "10.88.88.137",
    "netmask": "255.255.255.0",
    "gateway": "10.88.88.2",
    "state": "provisioning"
}
</code></pre>
<h2 id="removenic-delete-loginmachinesidnicsmac">RemoveNic (DELETE /:login/machines/:id/nics/:mac)</h2>
<p>Removes a NIC on an instance belonging to a given account.</p>
<p>Like <a href="#AddNic">AddNic</a> above, the NIC won't be removed from the instance
immediately. After the NIC is removed, it will start returning 404 through
CloudAPI.</p>
<p><em>WARNING</em>: this causes the instance to reboot while removing the NIC.</p>
<h3 id="inputs_102">Inputs</h3>
<ul>
<li>None</li>
</ul>
<h3 id="returns_102">Returns</h3>
<ul>
<li>None</li>
</ul>
<h3 id="errors_102">Errors</h3>
<p>For all possible errors, see <a href="#cloudapi-http-responses">CloudAPI HTTP Responses</a>.</p>
<table>
<thead>
<tr>
<th><strong>Error Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceNotFound</td>
<td>If <code>:login</code>, <code>:id</code> or <code>:mac</code> does not exist</td>
</tr>
<tr>
<td>InvalidArgument</td>
<td>If <code>:id</code> isn't a UUID</td>
</tr>
</tbody>
</table>
<h3 id="cli-command_97">CLI Command</h3>
<pre><code>$ sdc-nics delete 90:b8:d0:2f:b8:f9 76a533e9-aa3c-4fd4-a194-03fa05663e0e
</code></pre>
<h4 id="example-request_95">Example Request</h4>
<pre><code>DELETE /my/machine/76a533e9-aa3c-4fd4-a194-03fa05663e0e/nics/90b8d02fb8f9 HTTP/1.1
authorization: Signature keyId="...
accept: application/json
accept-version: ~7.1
host: api.example.com
connection: keep-alive
</code></pre>
<h4 id="example-response_95">Example Response</h4>
<pre><code>HTTP/1.1 204 No Content
content-type: application/json
content-length: 0
date: Sat, 03 May 2014 13:37:36 GMT
access-control-allow-origin: *
access-control-allow-headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time
access-control-allow-methods: GET, HEAD, DELETE
access-control-expose-headers: Api-Version, Request-Id, Response-Time
connection: Keep-Alive
server: Joyent Triton 7.2.0
api-version: 7.2.0
request-id: 6b8c5170-d45a-11e3-8db6-c7649670227d
response-time: 183
x-resource-count: 1
</code></pre>
<h1 id="volumes_1">Volumes</h1>
<p><em>The API endpoints documented in this section are considered experimental. There
is no guarantee on backward compatibility for them. Breaking changes can and
will be made to them. They are available only for CloudAPI services running in
datacenters for which NFS volumes support has been explicitly enabled. By
default, it is disabled.</em></p>
<h2 id="volume-objects">Volume objects</h2>
<p>Volumes are represented as objects that share a common set of properties:</p>
<p><strong>Name</strong>     | <strong>Type</strong> | <strong>Description</strong>
--------     | -------- | --------------- |
id         | String   | The UUID of the volume itself
owner_uuid | String   | The UUID of the volume's owner. In the example of a NFS shared volume, the owner is the user who created the volume
name       | String   | The volume's name. It must be unique for a given user. It must match the regular expression <code>/^[a-zA-Z0-9][a-zA-Z0-9_\.\-]+$/</code>. The maximum length for a volume's name is 256 characters. Trying to create or update a volume with a name longer than 256 characters will result in an error
type       | String   | Identifies the volume's type. There is currently one possible value for this property: <code>tritonnfs</code>. Additional types may be added in the future, and they can all have different sets of <a href="#type-specific-properties">type specific properties</a>
created    | String | A timestamp that indicates the time at which the volume was created
state      | String   | <code>creating</code>, <code>ready</code>, <code>deleting</code>, <code>deleted</code> or <code>failed</code>. Indicates in which state the volume currently is. <code>failed</code> volumes are still persisted to Moray for troubleshooting/debugging purposes. See the section <a href="#volumes-state-machine">Volumes state machine</a> for a diagram and further details about the volumes' state machine
networks   | Array of string | A list of network UUIDs that represents the networks on which this volume can be reached
refs       | Array of string | A list of VM UUIDs that reference this volume</p>
<p>Here's an example of a volume object in JSON format:</p>
<pre><code>{
  &quot;id&quot;: &quot;some-uuid&quot;,
  &quot;owner_uuid&quot;: &quot;some-uuid&quot;,
  &quot;name&quot;: &quot;foo&quot;,
  &quot;type&quot;: &quot;tritonnfs&quot;,
  &quot;created&quot;: &quot;2017-11-16T17:31:56.763Z&quot;,
  &quot;state&quot;: &quot;created&quot;,
  &quot;networks&quot;: [
    &quot;bf6960ac-97e3-47b6-9fe0-bc12c47db78a&quot;
  ],
  &quot;refs&quot;: [
    &quot;some-vm-uuid&quot;
  ]
}
</code></pre>

<h3 id="naming-constraints">Naming constraints</h3>
<h4 id="uniqueness">Uniqueness</h4>
<p>Volume names need to be <em>unique per account</em>.</p>
<h4 id="renaming">Renaming</h4>
<p>Renaming a volume is not allowed for volumes that are referenced by active VMs.</p>
<h3 id="type-specific-properties">Type-specific properties</h3>
<p>Different volume types may need to store different properties in addition to the
properties listed above. For instance, tritonnfs volumes have the following
extra properties:</p>
<ul>
<li><code>filesystem_path</code>: the path that can be used by a NFS client to mount the NFS
  remote filesystem in the host's filesystem.</li>
<li><code>size</code>: a Number representing the storage size available for this volume, in
  mebibytes.</li>
</ul>
<p>A <code>'tritonnfs'</code> volume can be represented as following:</p>
<pre><code>{
  &quot;id&quot;: &quot;some-uuid&quot;,
  &quot;owner_uuid&quot;: &quot;some-uuid&quot;,
  &quot;name&quot;: &quot;foo&quot;,
  &quot;type&quot;: &quot;tritonnfs&quot;,
  &quot;created&quot;: &quot;2017-11-16T17:31:56.763Z&quot;,
  &quot;state&quot;: &quot;created&quot;,
  &quot;size&quot;: 10240,
  &quot;networks&quot;: [
    &quot;bf6960ac-97e3-47b6-9fe0-bc12c47db78a&quot;
  ],
  &quot;refs&quot;: [
    &quot;some-vm-uuid&quot;
  ],
  &quot;filesystem_path&quot;: &quot;host:port/path&quot;,
}
</code></pre>

<h3 id="deletion-and-usage-semantics">Deletion and usage semantics</h3>
<p>A volume is considered to be "in use" if its <code>refs</code> property is a non-empty
array. When a container which mounts shared volumes is created and becomes
"active", it is added as a "reference" to those shared volumes.</p>
<p>A container is considered to be active when it's in any state except <code>failed</code> or
<code>destroyed</code> -- in other words in any state that can transition to <code>running</code>.</p>
<p>For instance, even if a <em>stopped</em> machine is the only remaining machine that
references a given shared volume, it won't be possible to delete that volume
until that machine is <em>deleted</em>.</p>
<p>Deleting a shared volume when there's still at least one active machine that
references it will result in an error.</p>
<p>A shared volume can be deleted if its only users are mounting it using something
other than Triton APIs (e.g., by using the <code>mount</code> command manually from within
a VM).</p>
<h3 id="volumes-state-machine">Volumes state machine</h3>
<p><img alt="Volumes state FSM" src="media/img/volumes-state-fsm.png" /></p>
<h2 id="listvolumes-get-loginvolumes">ListVolumes (GET /:login/volumes)</h2>
<p><em>Available only for CloudAPI services running in datacenters for which NFS
volumes support has been explicitly enabled. By default, it is disabled.</em></p>
<p>By default (if the request doesn't include the <code>state</code> and <code>predicate</code>
parameters), volumes in state === <code>'failed'</code> are not included in the response.</p>
<h3 id="input">Input</h3>
<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>String</td>
<td>Allows filtering volumes by name</td>
</tr>
<tr>
<td>predicate</td>
<td>String</td>
<td>URL-encoded JSON string representing an object that can be used to build a LDAP filter. This LDAP filter can search for volumes on arbitrary indexed properties. More details below</td>
</tr>
<tr>
<td>size</td>
<td>String</td>
<td>Allows filtering volumes by size, e.g <code>size=10240</code></td>
</tr>
<tr>
<td>state</td>
<td>String</td>
<td>Allows filtering volumes by state, e.g <code>state=failed</code></td>
</tr>
<tr>
<td>type</td>
<td>String</td>
<td>Allows filtering volumes by type, e.g <code>tritonnfs</code></td>
</tr>
</tbody>
</table>
<h4 id="searching-by-name">Searching by name</h4>
<p><code>name</code> is a string containing either a full volume name, or a partial volume
name prefixed and/or suffixed with a <code>*</code> character. For example:</p>
<ul>
<li>foo</li>
<li>foo*</li>
<li>*foo</li>
<li>*foo*</li>
</ul>
<p>are all valid <code>name=</code> searches which will match respectively:</p>
<ul>
<li>the exact name <code>foo</code></li>
<li>any name that starts with <code>foo</code> such as <code>foobar</code></li>
<li>any name that ends with <code>foo</code> such as <code>barfoo</code></li>
<li>any name that contains <code>foo</code> such as <code>barfoobar</code></li>
</ul>
<h4 id="searching-by-predicate">Searching by predicate</h4>
<p>The <code>predicate</code> parameter is a JSON string that can be used to build an LDAP
filter to search on the following indexed properties:</p>
<ul>
<li><code>name</code></li>
<li><code>billing_id</code></li>
<li><code>type</code></li>
<li><code>state</code></li>
<li><code>tags</code></li>
</ul>
<p>Important: when using a predicate, the same parameter cannot be found in both
the predicate and the non-predicate query parameters. For example, if a
predicate includes the <code>name</code> field, passing the <code>name=</code> query parameter is an
error.</p>
<h3 id="output">Output</h3>
<p>A list of volume objects of the following form:</p>
<pre><code>[
  {
    &quot;id&quot;: &quot;e435d72a-2498-8d49-a042-87b222a8b63f&quot;,
    &quot;name&quot;: &quot;my-volume&quot;,
    &quot;owner_uuid&quot;: &quot;ae35672a-9498-ed41-b017-82b221a8c63f&quot;,
    &quot;type&quot;: &quot;tritonnfs&quot;,
    &quot;filesystem_path&quot;: &quot;host:port/path&quot;,
    &quot;state&quot;: &quot;ready&quot;,
    &quot;networks&quot;: [
      &quot;1537d72a-949a-2d89-7049-17b2f2a8b634&quot;
    ],
    &quot;refs&quot;: [
      &quot;4d57d71c-1b7d-9ec1-3a21-2fdc14acb671&quot;
    ]
  }
]
</code></pre>

<h2 id="createvolume-post-loginvolumes">CreateVolume (POST /:login/volumes)</h2>
<p><em>Available only for CloudAPI services running in datacenters for which NFS
volumes support has been explicitly enabled. By default, it is disabled.</em></p>
<h3 id="input_1">Input</h3>
<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Mandatory</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>String</td>
<td>No</td>
<td>The desired name for the volume. If missing, a unique name for the current user will be generated. The maximum length of a volume name is 256 characters, trying to create a volume with a name longer than 256 characters will generate an error</td>
</tr>
<tr>
<td>size</td>
<td>Number</td>
<td>No</td>
<td>The desired minimum storage capacity for that volume in mebibytes. Default value is 10240 mebibytes (10 gibibytes)</td>
</tr>
<tr>
<td>type</td>
<td>String</td>
<td>Yes</td>
<td>The type of volume. Currently only <code>'tritonnfs'</code> is supported</td>
</tr>
<tr>
<td>networks</td>
<td>Array</td>
<td>Yes</td>
<td>A list of UUIDs representing networks on which the volume is reachable. These networks must be fabric networks owned by the user sending the request</td>
</tr>
</tbody>
</table>
<h3 id="output_1">Output</h3>
<p>A <a href="#volume-objects">volume object</a> representing the volume being created. When
the response is sent, the volume and all its resources are not yet created and
its state is <code>creating</code>. Users need to poll the newly-created volume with the
<code>GetVolume</code> API to determine when it's ready to use (its state transitions to
<code>ready</code>).</p>
<p>If the creation process fails, the volume object has its state set to <code>failed</code>.</p>
<h2 id="getvolume-get-loginvolumesid">GetVolume (GET /:login/volumes/:id)</h2>
<p><em>Available only for CloudAPI services running in datacenters for which NFS
volumes support has been explicitly enabled. By default, it is disabled.</em></p>
<p>GetVolume can be used to get data from an already-created volume, or to
determine when a volume being created is ready to be used.</p>
<h3 id="input_2">Input</h3>
<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>String</td>
<td>The UUID of the volume object</td>
</tr>
</tbody>
</table>
<h3 id="output_2">Output</h3>
<p>A <a href="#volume-objects">volume object</a> representing the volume with UUID <code>id</code>.</p>
<h2 id="deletevolume-delete-loginvolumesid">DeleteVolume (DELETE /:login/volumes/:id)</h2>
<p><em>Available only for CloudAPI services running in datacenters for which NFS
volumes support has been explicitly enabled. By default, it is disabled.</em></p>
<h3 id="input_3">Input</h3>
<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>String</td>
<td>The UUID of the volume object</td>
</tr>
</tbody>
</table>
<p>Deletion of a shared volume is not
allowed if it has at least one "active user". See the section
<a href="#deletion-and-usage-semantics">"Deletion and usage semantics"</a> for more
information.</p>
<h3 id="output_3">Output</h3>
<p>The output is empty and the status code is 204 if the deletion was scheduled
successfully.</p>
<p>A volume is always deleted asynchronously. In order to determine when the volume
is actually deleted, users need to poll the volume using the <code>GetVolume</code>
endpoint until it returns a 404 response.</p>
<p>If resources are using the volume to be deleted, the request results in a
<code>VolumeInUse</code> error.</p>
<h2 id="updatevolume-post-loginvolumesid">UpdateVolume (POST /:login/volumes/:id)</h2>
<p><em>Available only for CloudAPI services running in datacenters for which NFS
volumes support has been explicitly enabled. By default, it is disabled.</em></p>
<p>The <code>UpdateVolume</code> endpoint can be used to update the following properties of a
shared volume:</p>
<ul>
<li><code>name</code>, to rename a volume. See <a href="#renaming">the section on renaming volumes</a>
  for further details.</li>
</ul>
<h3 id="input_4">Input</h3>
<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>String</td>
<td>The UUID of the volume object</td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td>The new name of the volume with id <code>id</code>. Must be &lt;= 256 characters in length. Sending a name longer than 256 characters will generate an error</td>
</tr>
</tbody>
</table>
<p>Sending any other input parameter will result in an error. Updating other
properties of a volume, such as the networks it's attached to, must be performed
by using other separate endpoints.</p>
<h3 id="output_4">Output</h3>
<p>The output is empty and the status code is 204 if the volume was successfully
updated.</p>
<h2 id="listvolumesizes-get-loginvolumesizes">ListVolumeSizes (GET /:login/volumesizes)</h2>
<p><em>Available only for CloudAPI services running in datacenters for which NFS
volumes support has been explicitly enabled. By default, it is disabled.</em></p>
<p>The <code>ListVolumeSizes</code> endpoint can be used to determine in what sizes volumes of
a certain type are available.</p>
<h3 id="input_5">Input</h3>
<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>type</td>
<td>String</td>
<td>the type of the volume (e.g <code>tritonnfs</code>)</td>
</tr>
</tbody>
</table>
<p>Sending any other input parameter will result in an error.</p>
<h3 id="output_5">Output</h3>
<p>The response is an array of objects having two properties:</p>
<ul>
<li>
<p><code>size</code>: a number in mebibytes that represents the size of a volume</p>
</li>
<li>
<p><code>type</code>: the type of volume for which the size is available</p>
</li>
</ul>
<pre><code>[
  {
    &quot;size&quot;: 10240,
    &quot;type&quot;: &quot;tritonnfs&quot;
  },
  {
    &quot;size&quot;: 20480,
    &quot;type&quot;: &quot;tritonnfs&quot;
  },
  {
    &quot;size&quot;: 30720,
    &quot;type&quot;: &quot;tritonnfs&quot;
  },
  {
    &quot;size&quot;: 40960,
    &quot;type&quot;: &quot;tritonnfs&quot;
  },
  {
    &quot;size&quot;: 51200,
    &quot;type&quot;: &quot;tritonnfs&quot;
  },
  {
    &quot;size&quot;: 61440,
    &quot;type&quot;: &quot;tritonnfs&quot;
  },
  {
    &quot;size&quot;: 71680,
    &quot;type&quot;: &quot;tritonnfs&quot;
  },
  {
    &quot;size&quot;: 81920,
    &quot;type&quot;: &quot;tritonnfs&quot;
  },
  {
    &quot;size&quot;: 92160,
    &quot;type&quot;: &quot;tritonnfs&quot;
  },
  {
    &quot;size&quot;: 102400,
    &quot;type&quot;: &quot;tritonnfs&quot;
  },
  {
    &quot;size&quot;: 204800,
    &quot;type&quot;: &quot;tritonnfs&quot;
  },
  {
    &quot;size&quot;: 307200,
    &quot;type&quot;: &quot;tritonnfs&quot;
  },
  {
    &quot;size&quot;: 409600,
    &quot;type&quot;: &quot;tritonnfs&quot;
  },
  {
    &quot;size&quot;: 512000,
    &quot;type&quot;: &quot;tritonnfs&quot;
  },
  {
    &quot;size&quot;: 614400,
    &quot;type&quot;: &quot;tritonnfs&quot;
  },
  {
    &quot;size&quot;: 716800,
    &quot;type&quot;: &quot;tritonnfs&quot;
  },
  {
    &quot;size&quot;: 819200,
    &quot;type&quot;: &quot;tritonnfs&quot;
  },
  {
    &quot;size&quot;: 921600,
    &quot;type&quot;: &quot;tritonnfs&quot;
  },
  {
    &quot;size&quot;: 1024000,
    &quot;type&quot;: &quot;tritonnfs&quot;
  }
]
</code></pre>

<h1 id="appendix-a-machine-states">Appendix A: Machine States</h1>
<h2 id="machine-state-diagram">Machine State Diagram</h2>
<p>The following is the state diagram for a instance:</p>
<pre>
              POST /my/machines
                      |
                      |
                      V
              +----------------+                 +----------------+
              |  Provisioning  | --------------> |  Failed        |
              +----------------+                 +----------------+
                      |                                   |
                      |                                   |
                      V                                   |
              +----------------+                          |
    +-------> |     Running    | --------+                |
    |         +----------------+         |                |
    |                 |                  | DELETE         |
    | action=start    | action=stop      |                |
    |                 V                  V                |
    |         +----------------+    +----------------+    |
    |         |    Stopping    |    |  Deleted       | ---+
    |         +----------------+    +----------------+    |
    |                 |                  ^                |
    |                 |                  |               ---
    |                 V                  | DELETE         _
    |         +----------------+         |
    +-------- |     Stopped    | --------+
              +----------------+
</pre>

<p>At any point the state can also be <code>offline</code>, like if there is a network or
power event to the instance.</p>
<h2 id="polling-instance-state">Polling instance state</h2>
<p>As suggested in <a href="#CreateMachine">CreateMachine</a>, you can poll an instance's
state to check when that instance's provisioning has either successfully
completed or failed.  Consider the following code using
<a href="https://github.com/joyent/node-smartdc">node.js SDK</a>:</p>
<pre><code>var sdc = smartdc.createClient({ ... });

function checkMachineStatus(id, state, callback) {
    return sdc.getMachine(id, function (err, instance) {
        if (err) {
            if (err.statusCode === 410 &amp;&amp; state === 'deleted') {
                return callback(null, true);
            }
            return callback(err);
        }

        if ((instance.state === 'deleted' &amp;&amp; state !== 'deleted')
            instance.state === 'failed') {
            return callback(new Error('Provisioning Job failed'));
        }

        return callback(null, (instance ? instance.state === state : false));
    }, true);
}


function waitForMachine(id, state, callback) {
    return checkMachineStatus(id, state, function (err, ready) {
        if (err) {
            return callback(err);
        }
        if (!ready) {
            return setTimeout(function () {
                waitForMachine(id, state, callback);
            }, (process.env.POLL_INTERVAL || 2500));
        }
        return callback(null);
    });
}
</code></pre>
<p>With this code, you can poll when an instance with a given uuid is running by
doing:</p>
<pre><code>var instance = 'd19432ff-d921-4d6c-b5f9-6b0e4de6665c';
waitForMachine(instance, 'running', function (err) {
    if (err) {
        console.error('Exiting because instance provisioning failed');
        process.exit(1);
    }

    // ... do your stuff here, the instance is running now ...
});
</code></pre>
<h2 id="polling-instance-audit">Polling instance audit</h2>
<p>There are some cases where polling for instance state change will not work
because there won't be a state change for the requested action (e.g. "rename"),
or because the state change is short-lived thus making the transition easy to
miss (e.g. "reboot").</p>
<p>In such cases, consider polling an instance's historical of actions available
through an instance's <a href="#MachineAudit">Machine Audit</a>, wait for the desired
action to appear on that list, and check successfulness there.  Taking our
example from previous section, this is how we could check for a reboot:</p>
<pre><code>function checkMachineAction(id, action, time, cb) {
    return sdc.getMachineAudit(id, function (err, actions) {
        if (err) {
            return cb(err);
        }

        var acts = actions.filter(function (a) {
            return (a.action === action &amp;&amp; (new Date(a.time) &gt; time));
        });

        if (acts.length === 0) {
            return cb(null, false);
        }

        var act = acts[0];
        if (act.success !== 'yes') {
            return cb(action + ' failed');
        }

        return cb(null, true);  // success!
    }, true);
}


function waitForAction(id, action, time, cb) {
    console.log('Waiting for instance \'%s\' %s to complete', id, action);

    return checkMachineAction(id, action, time, function (err, ready) {
        if (err) {
            return cb(err);
        }

        if (!ready) {
            return setTimeout(function () {
                waitForAction(id, action, time, cb);
            }, (process.env.POLL_INTERVAL || 2500));
        }
        return cb(null);
    });
}
</code></pre>
<p>With this code, you can poll when an instance with a given uuid has rebooted by
doing:</p>
<pre><code>waitForAction(instance, 'reboot', (new Date()), function (err) {
    if (err) {
        // .. something failed
    } else {
        // ...all good, reboot happened successfully and instance is running
    }
});
</code></pre>
<h1 id="appendix-b-http-signature-authentication">Appendix B: HTTP Signature Authentication</h1>
<p>In addition to HTTP Basic Authentication, CloudAPI supports a new mechanism for
authenticating HTTP requests based on signing with your SSH private key.
Specific examples of using this mechanism with Triton are given here. Reference
the <code>HTTP Signature Authentication</code> specification by Joyent, Inc. for complete
details.</p>
<p>A node.js library for HTTP Signature is available with:</p>
<pre><code>$ npm install http-signature@0.9.11
</code></pre>
<h2 id="cloudapi-specific-parameters">CloudAPI Specific Parameters</h2>
<p>The <code>Signature</code> authentication scheme is based on the model that the client must
authenticate itself with a digital signature produced by the private key
associated with an SSH key under your account (see <code>/my/keys</code> above).  Currently
only RSA signatures are supported.  You generate a signature by signing the
value of the HTTP <code>Date</code> header.</p>
<p>As an example, assuming that you have associated an RSA SSH key with your
account, called 'rsa-1', the following request is what you would send for a
<code>ListMachines</code> request:</p>
<pre><code>GET /my/machines HTTP/1.1
Host: api.example.com
Date: Sat, 11 Jun 2011 23:56:29 GMT
Authorization: Signature keyId="/demo/keys/rsa-1",algorithm="rsa-sha256" &lt;Base64(rsa(sha256($Date)))&gt;
Accept: application/json
Api-Version: ~8
</code></pre>
<p>Where the signature is attached with the
<code>Base64(rsa(sha256(Sat, 11 Jun 2011 23:56:29 GMT)))</code> output.  Note that the
<code>keyId</code> parameter <strong>cannot</strong> use the <em>my</em> shortcut, as in the HTTP resource
paths. This is because CloudAPI must lookup your account to resolve the key, as
with Basic authentication.  In short, you <strong>MUST</strong> use the login name associated
to your account to specify the <code>keyId</code>.</p>
<h2 id="sample-code">Sample Code</h2>
<p>Sample code for generating the <code>Authorization</code> header (and <code>Date</code> header):</p>
<pre><code>var crypto = require('crypto');
var fs = require('fs');
var https = require('https');



/**
 * Simply pads a number &lt; 10 with a leading 0.
 *
 * @param {String} val a numeric string.
 * @return {String} a new value that may have a leading 0.
 */
function pad(val) {
  if (parseInt(val, 10) &lt; 10)
    val = '0' + val;
  return val;
}


/**
 * Generates an RFC 1123 compliant Date String
 *
 * @return {String} RFC 1123 date string.
 */
function httpDate() {
  var now = new Date();
  var months = ['Jan',
                'Feb',
                'Mar',
                'Apr',
                'May',
                'Jun',
                'Jul',
                'Aug',
                'Sep',
                'Oct',
                'Nov',
                'Dec'];
  var days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
  return days[now.getUTCDay()] + ', ' +
              pad(now.getUTCDate()) + ' ' +
              months[now.getUTCMonth()] + ' ' +
              now.getUTCFullYear() + ' ' +
              pad(now.getUTCHours()) + ':' +
              pad(now.getUTCMinutes()) + ':' +
              pad(now.getUTCSeconds()) +
              ' GMT';
}


///--- Mainline

// Read in an SSH key from the "usual" location.
var file = process.env.HOME + '/.ssh/id_rsa';
var key = fs.readFileSync(file, 'ascii');
if (!key)
  throw new Error(file + ' was not a valid RSA key');

var date = httpDate();
var signer = crypto.createSign('RSA-SHA256');
signer.update(date);
authz = 'Signature keyId="/mark/keys/rsa-1",algorithm="rsa-sha256" ' + signer.sign(key, 'base64');

var request = {
  host: 'api.example.com',
  path: '/my/machines',
  headers: {
    'api-version': '~8',
    'Date': date,
    'Authorization': authz
  }
};
https.get(request, function(res) {
  console.log('STATUS: ' + res.statusCode);
  console.log('HEADERS: ' + JSON.stringify(res.headers, null, 2));
  res.setEncoding('utf8');
  res.body = '';
  res.on('data', function(chunk) {
    res.body += chunk;
  });
  res.on('end', function() {
    console.log('BODY: ' + JSON.stringify(res.body, null, 2));
  });
}).end();
</code></pre>
<h1 id="appendix-c-cloudapi-cli-commands">Appendix C: CloudAPI CLI Commands</h1>
<table>
<thead>
<tr>
<th><strong><code>smartdc</code> Command</strong></th>
<th><strong><code>triton</code> Command</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#AddMachineTags">sdc-addmachinetags</a></td>
<td><a href="#AddMachineTags">triton instance tag set</a></td>
<td>Allows you to add additional tags, other than those set at provisioning time.</td>
</tr>
<tr>
<td><a href="#SetRoleTags">sdc-chmod</a></td>
<td>-</td>
<td>Add role tags to CloudAPI resources.</td>
</tr>
<tr>
<td><a href="#CreateFirewallRule">sdc-createfirewallrule</a></td>
<td><a href="#CreateFirewallRule">triton fwrule create</a></td>
<td>Add a new firewall rule.</td>
</tr>
<tr>
<td><a href="#CreateImageFromMachine">sdc-createimagefrommachine</a></td>
<td><a href="#CreateImageFromMachine">triton image create</a></td>
<td>Create a new custom image from an instance.</td>
</tr>
<tr>
<td><a href="#CreateKey">sdc-createkey</a></td>
<td><a href="#CreateKey">triton key add</a></td>
<td>Uploads a new OpenSSH key to Triton.</td>
</tr>
<tr>
<td><a href="#CreateMachine">sdc-createmachine</a></td>
<td><a href="#CreateMachine">triton instance create</a></td>
<td>Allows you to provision an instance.</td>
</tr>
<tr>
<td><a href="#CreateMachineSnapshot">sdc-createmachinesnapshot</a></td>
<td><a href="#CreateMachineSnapshot">triton instance snapshot create</a></td>
<td>Allows you to take a snapshot of an instance.</td>
</tr>
<tr>
<td><a href="#DeleteFirewallRule">sdc-deletefirewallrule</a></td>
<td><a href="#DeleteFirewallRule">triton fwrule delete</a></td>
<td>Removes a given firewall rule.</td>
</tr>
<tr>
<td><a href="#DeleteImage">sdc-deleteimage</a></td>
<td><a href="#DeleteImage">triton image delete</a></td>
<td>Delete a private image.</td>
</tr>
<tr>
<td><a href="#DeleteKey">sdc-deletekey</a></td>
<td><a href="#DeleteKey">triton key delete</a></td>
<td>Deletes an SSH key by name.</td>
</tr>
<tr>
<td><a href="#DeleteMachine">sdc-deletemachine</a></td>
<td><a href="#DeleteMachine">triton instance delete</a></td>
<td>Allows you to completely destroy an instance.</td>
</tr>
<tr>
<td><a href="#DeleteMachineMetadata">sdc-deletemachinemetadata</a></td>
<td>-</td>
<td>Deletes a single metadata key from this instance.</td>
</tr>
<tr>
<td><a href="#DeleteMachineSnapshot">sdc-deletemachinesnapshot</a></td>
<td><a href="#DeleteMachineSnapshot">triton instance snapshot delete</a></td>
<td>Deletes the specified snapshot of an instance.</td>
</tr>
<tr>
<td><a href="#DeleteMachineTag">sdc-deletemachinetag</a></td>
<td><a href="#DeleteMachineTag">triton instance tag delete</a></td>
<td>Deletes a single tag from this instance.</td>
</tr>
<tr>
<td><a href="#DisableFirewallRule">sdc-disablefirewallrule</a></td>
<td><a href="#DisableFirewallRule">triton fwrule disable</a></td>
<td>Disable an enabled firewall rule.</td>
</tr>
<tr>
<td><a href="#DisableMachineFirewall">sdc-disablemachinefirewall</a></td>
<td><a href="#DisableMachineFirewall">triton instance disable-firewall</a></td>
<td>Completely disable the firewall on an instance.</td>
</tr>
<tr>
<td><a href="#EnableFirewallRule">sdc-enablefirewallrule</a></td>
<td><a href="#EnableFirewallRule">triton fwrule enable</a></td>
<td>Enable a disabled firewall rule.</td>
</tr>
<tr>
<td><a href="#EnableMachineFirewall">sdc-enablemachinefirewall</a></td>
<td><a href="#EnableMachineFirewall">triton instance enable-firewall</a></td>
<td>Enable the firewall on an instance.</td>
</tr>
<tr>
<td><a href="#ExportImage">sdc-exportimage</a></td>
<td>-</td>
<td>Export an image to Manta.</td>
</tr>
<tr>
<td><a href="#fabrics">sdc-fabric</a></td>
<td>-</td>
<td>Administer fabric networks and VLANs.</td>
</tr>
<tr>
<td><a href="#GetAccount">sdc-getaccount</a></td>
<td><a href="#GetAccount">triton account get</a></td>
<td>Gets details about your account.</td>
</tr>
<tr>
<td><a href="#GetFirewallRule">sdc-getfirewallrule</a></td>
<td><a href="#GetFirewallRule">triton fwrule get</a></td>
<td>Get details about a specific firewall rule.</td>
</tr>
<tr>
<td><a href="#GetImage">sdc-getimage</a></td>
<td><a href="#GetImage">triton image get</a></td>
<td>Gets an individual image by id.</td>
</tr>
<tr>
<td><a href="#GetKey">sdc-getkey</a></td>
<td><a href="#GetKey">triton key get</a></td>
<td>Retrieves an individual key record.</td>
</tr>
<tr>
<td><a href="#GetMachine">sdc-getmachine</a></td>
<td><a href="#GetMachine">triton instance get</a></td>
<td>Gets the details for an individual instance.</td>
</tr>
<tr>
<td><a href="#MachineAudit">sdc-getmachineaudit</a></td>
<td><a href="#MachineAudit">triton instance audit</a></td>
<td>Get a historical list of actions performed on an instance.</td>
</tr>
<tr>
<td><a href="#GetMachineMetadata">sdc-getmachinemetadata</a></td>
<td>-</td>
<td>Returns the complete set of metadata associated with this instance.</td>
</tr>
<tr>
<td><a href="#GetMachineSnapshot">sdc-getmachinesnapshot</a></td>
<td><a href="#GetMachineSnapshot">triton instance snapshot get</a></td>
<td>Gets the state of the named snapshot.</td>
</tr>
<tr>
<td><a href="#GetMachineTag">sdc-getmachinetag</a></td>
<td><a href="#GetMachineTag">triton instance tag get</a></td>
<td>Returns the value for a single tag on this instance.</td>
</tr>
<tr>
<td><a href="#GetNetwork">sdc-getnetwork</a></td>
<td><a href="#GetNetwork">triton network get</a></td>
<td>Gets a network by the given id.</td>
</tr>
<tr>
<td><a href="#GetPackage">sdc-getpackage</a></td>
<td><a href="#GetPackage">triton package get</a></td>
<td>Gets a package by name.</td>
</tr>
<tr>
<td><a href="#SetRoleTags">sdc-info</a></td>
<td>-</td>
<td>List of role-tags assigned to a given resource.</td>
</tr>
<tr>
<td><a href="#ListDatacenters">sdc-listdatacenters</a></td>
<td><a href="#ListDatacenters">triton datacenters</a></td>
<td>Provides a list of all datacenters this cloud is aware of.</td>
</tr>
<tr>
<td><a href="#ListFirewallRules">sdc-listfirewallrules</a></td>
<td><a href="#ListFirewallRules">triton fwrule list</a></td>
<td>List all firewall rules applying to this account.</td>
</tr>
<tr>
<td><a href="#ListImages">sdc-listimages</a></td>
<td><a href="#ListImages">triton image list</a></td>
<td>Provides a list of images available in this datacenter.</td>
</tr>
<tr>
<td><a href="#ListKeys">sdc-listkeys</a></td>
<td><a href="#ListKeys">triton key list</a></td>
<td>Lists all public keys we have on record for the specified account.</td>
</tr>
<tr>
<td><a href="#ListMachineFirewallRules">sdc-listmachinefirewallrules</a></td>
<td><a href="#ListMachineFirewallRules">triton instance fwrules list</a></td>
<td>List firewall rules applying to a specific instance.</td>
</tr>
<tr>
<td><a href="#ListMachines">sdc-listmachines</a></td>
<td><a href="#ListMachines">triton instance list</a></td>
<td>Lists all instances on an account.</td>
</tr>
<tr>
<td><a href="#ListMachineSnapshots">sdc-listmachinesnapshots</a></td>
<td><a href="#ListMachineSnapshots">triton instance snapshot list</a></td>
<td>Lists all snapshots taken for a given instance.</td>
</tr>
<tr>
<td><a href="#ListMachineTags">sdc-listmachinetags</a></td>
<td><a href="#ListMachineTags">triton instance tag list</a></td>
<td>Returns the complete set of tags associated with this instance.</td>
</tr>
<tr>
<td><a href="#ListNetworks">sdc-listnetworks</a></td>
<td><a href="#ListNetworks">triton network list</a></td>
<td>Provides a list of networks available to the user in this datacenter.</td>
</tr>
<tr>
<td><a href="#ListPackages">sdc-listpackages</a></td>
<td><a href="#ListPackages">triton package list</a></td>
<td>Provides a list of packages available in this datacenter.</td>
</tr>
<tr>
<td><a href="#nics">sdc-nics</a></td>
<td>-</td>
<td>List, add and remove NICs attached to an instance.</td>
</tr>
<tr>
<td><a href="#policies">sdc-policy</a></td>
<td>-</td>
<td>Add, list, update and remove policies.</td>
</tr>
<tr>
<td><a href="#RebootMachine">sdc-rebootmachine</a></td>
<td><a href="#RebootMachine">triton instance reboot</a></td>
<td>Allows you to 'reboot' an instance.</td>
</tr>
<tr>
<td><a href="#RenameMachine">sdc-renamemachine</a></td>
<td>-</td>
<td>Rename an instance.</td>
</tr>
<tr>
<td><a href="#ReplaceMachineTags">sdc-replacemachinetags</a></td>
<td><a href="#ReplaceMachineTags">triton instance tag replace-all</a></td>
<td>Replace all tags on an instance.</td>
</tr>
<tr>
<td><a href="#ResizeMachine">sdc-resizemachine</a></td>
<td>-</td>
<td>Allows you to resize a container.</td>
</tr>
<tr>
<td><a href="#roles">sdc-role</a></td>
<td>-</td>
<td>Add, list, update and remove roles.</td>
</tr>
<tr>
<td><a href="#StartMachine">sdc-startmachine</a></td>
<td><a href="#StartMachine">triton instance start</a></td>
<td>Allows you to boot up an instance.</td>
</tr>
<tr>
<td><a href="#StartMachineFromSnapshot">sdc-startmachinefromsnapshot</a></td>
<td><a href="#StartMachineFromSnapshot">triton instance start</a></td>
<td>Starts a stopped instance from the referenced snapshot.</td>
</tr>
<tr>
<td><a href="#StopMachine">sdc-stopmachine</a></td>
<td><a href="#StopMachine">triton instance stop</a></td>
<td>Allows you to shut down an instance.</td>
</tr>
<tr>
<td><a href="#UpdateAccount">sdc-updateaccount</a></td>
<td><a href="#UpdateAccount">triton account update</a></td>
<td>Change details of the current account.</td>
</tr>
<tr>
<td><a href="#UpdateFirewallRule">sdc-updatefirewallrule</a></td>
<td><a href="#UpdateFirewallRule">triton fwrule update</a></td>
<td>Change a firewall rule.</td>
</tr>
<tr>
<td><a href="#UpdateImage">sdc-updateimage</a></td>
<td>-</td>
<td>Update metadata about an image.</td>
</tr>
<tr>
<td><a href="#UpdateMachineMetadata">sdc-updatemachinemetadata</a></td>
<td>-</td>
<td>Allows you to update the metadata for a given instance.</td>
</tr>
<tr>
<td><a href="#users">sdc-user</a></td>
<td>-</td>
<td>Add, update and remove account users and their keys.</td>
</tr>
<tr>
<td>-</td>
<td>trion image clone</td>
<td>Clone a shared image.</td>
</tr>
<tr>
<td>-</td>
<td><a href="#ImportImageFromDatacenter">triton image copy</a></td>
<td>Copy an image into another DC.</td>
</tr>
<tr>
<td>-</td>
<td>triton info</td>
<td>Print an account summary.</td>
</tr>
<tr>
<td>-</td>
<td>triton instance ip</td>
<td>Print the primary IP of the given instance.</td>
</tr>
<tr>
<td>-</td>
<td>triton instance ssh</td>
<td>SSH to the primary IP of an instance.</td>
</tr>
<tr>
<td>-</td>
<td>triton instance wait</td>
<td>Wait on instances changing state.</td>
</tr>
<tr>
<td>-</td>
<td>triton profile</td>
<td>List, get, create and update Triton CLI profiles.</td>
</tr>
<tr>
<td>-</td>
<td><a href="#ListServices">triton services</a></td>
<td>List available service endpoints for the datacenter.</td>
</tr>
</tbody>
</table>
<p style="min-height: 31px; margin-top: 60px; border-top: 1px solid #ccc; border-bottom: 1px solid #ccc; padding: 10px 0">
<a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/"><img alt="Creative Commons License" style="border-width:0;float:left;margin:4px 8px 0 0;" src="https://i.creativecommons.org/l/by-sa/3.0/88x31.png" /></a> <span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text" property="dct:title" rel="dct:type">Joyent CloudAPI Documentation</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="http://www.joyent.com" property="cc:attributionName" rel="cc:attributionURL">Joyent, Inc.</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-ShareAlike 3.0 Unported License</a>.
</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.245445c6.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>